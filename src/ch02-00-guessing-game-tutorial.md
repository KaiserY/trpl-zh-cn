# çŒœçŒœçœ‹

> [ch02-00-guessing-game-tutorial.md](https://github.com/rust-lang/book/blob/master/src/ch02-00-guessing-game-tutorial.md)
> <br>
> commit 7c1c935560190fcd64c0851e75dbeabf75fedd19

è®©æˆ‘ä»¬é€šè¿‡è‡ªå·±åŠ¨æ‰‹çš„æ–¹å¼ä¸€èµ·å®Œæˆä¸€ä¸ªé¡¹ç›®æ¥å¿«é€Ÿä¸Šæ‰‹ Rustï¼æœ¬ç« é€šè¿‡å±•ç¤ºå¦‚ä½•åœ¨çœŸå®çš„é¡¹ç›®ä¸­è¿ç”¨çš„æ–¹å¼å‘ä½ ä»‹ç»ä¸€äº›å¸¸ç”¨çš„ Rust æ¦‚å¿µã€‚ä½ å°†ä¼šå­¦åˆ°`let`ã€`match`ã€æ–¹æ³•ã€å…³è”å‡½æ•°ã€ä½¿ç”¨å¤–éƒ¨ crate ç­‰æ›´å¤šçš„çŸ¥è¯†ï¼æ¥ä¸‹æ¥çš„ç« èŠ‚ä¼šæ¢ç´¢è¿™äº›æ¦‚å¿µçš„ç»†èŠ‚ã€‚åœ¨è¿™ä¸€ç« ï¼Œæˆ‘ä»¬ç»ƒä¹ åŸºç¡€ã€‚

æˆ‘ä»¬ä¼šå®ç°ä¸€ä¸ªç»å…¸æ–°æ‰‹ç¼–ç¨‹é—®é¢˜ï¼šçŒœçŒœçœ‹æ¸¸æˆã€‚å®ƒæ˜¯è¿™ä¹ˆå·¥ä½œçš„ï¼šç¨‹åºå°†ä¼šéšæœºç”Ÿæˆä¸€ä¸ª 1 åˆ° 100 ä¹‹é—´çš„éšæœºæ•´æ•°ã€‚æ¥ç€å®ƒä¼šæç¤ºç©å®¶è¾“å…¥ä¸€ä¸ªçŒœæµ‹ã€‚å½“è¾“å…¥äº†ä¸€ä¸ªçŒœæµ‹åï¼Œå®ƒä¼šå‘Šè¯‰æç¤ºçŒœæµ‹æ˜¯å¤ªå¤§äº†è¿˜æ˜¯å¤ªå°äº†ã€‚çŒœå¯¹äº†ï¼Œå®ƒä¼šæ‰“å°å‡ºç¥è´ºå¹¶é€€å‡ºã€‚

## å‡†å¤‡ä¸€ä¸ªæ–°é¡¹ç›®

è¦åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼Œè¿›å…¥ä½ åœ¨ç¬¬ä¸€ç« åˆ›å»ºçš„**é¡¹ç›®**ç›®å½•ï¼Œå¹¶ä½¿ç”¨ Cargo åˆ›å»ºå®ƒï¼Œåƒè¿™æ ·ï¼š

```sh
$ cargo new guessing_game --bin
$ cd guessing_game
```

ç¬¬ä¸€ä¸ªå‘½ä»¤ï¼Œ`cargo new`ï¼Œè·å–é¡¹ç›®çš„åç§°ï¼ˆ`guessing_game`ï¼‰ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚`--bin`å‚æ•°å‘Šè¯‰ Cargo åˆ›å»ºä¸€ä¸ªäºŒè¿›åˆ¶é¡¹ç›®ï¼Œä¸ç¬¬ä¸€ç« ç±»ä¼¼ã€‚ç¬¬äºŒä¸ªå‘½ä»¤è¿›å…¥åˆ°æ–°åˆ›å»ºçš„é¡¹ç›®ç›®å½•ã€‚

çœ‹ä¸€æ ·ç”Ÿæˆçš„ *Cargo.toml* æ–‡ä»¶ï¼š

<span class="filename">Filename: Cargo.toml</span>

```toml
[package]
name = "guessing_game"
version = "0.1.0"
authors = ["Your Name <you@example.com>"]

[dependencies]
```

å¦‚æœ Cargo ä»ç¯å¢ƒä¸­è·å–çš„ä½œè€…ä¿¡æ¯ä¸æ­£ç¡®ï¼Œä¿®æ”¹è¿™ä¸ªæ–‡ä»¶å¹¶å†æ¬¡ä¿å­˜ã€‚

æ­£å¦‚ç¬¬ä¸€ç« é‚£æ ·ï¼Œ`cargo new`ç”Ÿæˆäº†ä¸€ä¸ªâ€œHello, world!â€ç¨‹åºã€‚æŸ¥çœ‹ *src/main.rs* æ–‡ä»¶ï¼š

<span class="filename">Filename: src/main.rs</span>

```rust
fn main() {
    println!("Hello, world!");
}
```

ç°åœ¨è®©æˆ‘ä»¬ä½¿ç”¨`cargo run`åœ¨ç›¸åŒçš„æ­¥éª¤ç¼–è¯‘å¹¶è¿è¡Œè¿™ä¸ªâ€œHello, world!â€ç¨‹åºï¼š


```sh
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
     Running `target/debug/guessing_game`
Hello, world!
```

`run`å‘½ä»¤åœ¨ä½ éœ€è¦å¿«é€Ÿè¿­ä»£é¡¹ç›®æ—¶å°±æ´¾ä¸Šç”¨åœºäº†ï¼Œè€Œè¿™ä¸ªæ¸¸æˆå°±æ­£æ˜¯è¿™ä¹ˆä¸€ä¸ªé¡¹ç›®ï¼šæˆ‘ä»¬éœ€è¦åœ¨è¿›è¡Œä¸‹ä¸€æ­¥ä¹‹å‰å¿«é€Ÿæµ‹è¯•æ¯æ¬¡è¿­ä»£ã€‚

é‡æ–°æ‰“å¼€ *src/main.rs* æ–‡ä»¶ã€‚æˆ‘ä»¬å°†ä¼šåœ¨è¿™ä¸ªæ–‡ä»¶ç¼–å†™å…¨éƒ¨çš„ä»£ç ã€‚

## å¤„ç†ä¸€æ¬¡çŒœæµ‹

ç¨‹åºçš„ç¬¬ä¸€éƒ¨åˆ†ä¼šè¯·æ±‚ç”¨æˆ·è¾“å…¥ï¼Œå¤„ç†è¾“å…¥ï¼Œå¹¶æ£€æŸ¥è¾“å…¥æ˜¯å¦ä¸ºæœŸæœ›çš„å½¢å¼ã€‚é¦–å…ˆï¼Œå…è®¸ç©å®¶è¾“å…¥ä¸€ä¸ªçŒœæµ‹ã€‚åœ¨ *src/main.rs* ä¸­è¾“å…¥åˆ—è¡¨ 2-1 ä¸­çš„ä»£ç ã€‚

<figure>
<span class="filename">Filename: src/main.rs</span>

```rust,ignore
use std::io;

fn main() {
    println!("Guess the number!");

    println!("Please input your guess.");

    let mut guess = String::new();

    io::stdin().read_line(&mut guess)
        .expect("Failed to read line");

    println!("You guessed: {}", guess);
}
```

<figcaption>

Listing 2-1: Code to get a guess from the user and print it out

</figcaption>
</figure>

è¿™äº›ä»£ç åŒ…å«å¾ˆå¤šä¿¡æ¯ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä¸€ç‚¹ä¸€ç‚¹åœ°è¿‡ä¸€éã€‚ä¸ºäº†è·å–ç”¨æˆ·è¾“å…¥å¹¶æ¥ç€æ‰“å°ç»“æœä½œä¸ºè¾“å‡ºï¼Œæˆ‘ä»¬éœ€è¦å°†`io`ï¼ˆè¾“å…¥/è¾“å‡ºï¼‰åº“å¼•å…¥ä½œç”¨åŸŸä¸­ã€‚`io`åº“æ¥è‡ªäºæ ‡å‡†åº“ï¼ˆä¹Ÿè¢«ç§°ä¸º`std`ï¼‰ï¼š

```rust,ignore
use std::io;
```

Rust é»˜è®¤åªåœ¨æ¯ä¸ªç¨‹åºçš„ [*prelude*][prelude]<!-- ignore --> ä¸­å¼•ç”¨å¾ˆå°‘çš„ä¸€äº›ç±»å‹ã€‚å¦‚æœæƒ³è¦ä½¿ç”¨çš„ç±»å‹å¹¶ä¸åœ¨ prelude ä¸­ï¼Œä½ å¿…é¡»ä½¿ç”¨ä¸€ä¸ª`use`è¯­å¥æ˜¾å¼çš„å°†å…¶å¼•å…¥åˆ°ä½œç”¨åŸŸä¸­ã€‚ä½¿ç”¨`std::io`åº“å°†æä¾›å¾ˆå¤š`io`ç›¸å…³çš„åŠŸèƒ½ï¼Œæ¥å—ç”¨æˆ·è¾“å…¥çš„åŠŸèƒ½ã€‚

[prelude]: https://doc.rust-lang.org/std/prelude/

æ­£å¦‚ç¬¬ä¸€ç« æ‰€è®²ï¼Œ`main`å‡½æ•°æ˜¯ç¨‹åºçš„å…¥å£ç‚¹ï¼š

```rust,ignore
fn main() {
```

`fn`è¯­æ³•å£°æ˜äº†ä¸€ä¸ªæ–°å‡½æ•°ï¼Œ`()`è¡¨æ˜æ²¡æœ‰å‚æ•°ï¼Œ`{`ä½œä¸ºå‡½æ•°ä½“çš„å¼€å§‹ã€‚

ç¬¬ä¸€ç« ä¹Ÿè®²åˆ°äº†ï¼Œ`println!`æ˜¯ä¸€ä¸ªåœ¨å±å¹•ä¸Šæ‰“å°å­—ç¬¦ä¸²çš„å®ï¼š

```rust,ignore
println!("Guess the number!");

println!("Please input your guess.");
```

è¿™äº›ä»£ç ä»…ä»…æ‰“å°ä¸€ä¸ªæç¤ºï¼Œè¯´æ˜æ¸¸æˆçš„å†…å®¹å¹¶è¯·æ±‚ç”¨æˆ·è¾“å…¥ã€‚

### ç”¨å˜é‡å‚¨å­˜å€¼

æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ªåœ°æ–¹å‚¨å­˜ç”¨æˆ·è¾“å…¥ï¼Œåƒè¿™æ ·ï¼š

```rust,ignore
let mut guess = String::new();
```

ç°åœ¨ç¨‹åºå¼€å§‹å˜å¾—æœ‰æ„æ€äº†ï¼è¿™ä¸€å°è¡Œä»£ç å‘ç”Ÿäº†å¾ˆå¤šäº‹ã€‚æ³¨æ„è¿™æ˜¯ä¸€ä¸ª`let`è¯­å¥ï¼Œç”¨æ¥åˆ›å»º**å˜é‡**ã€‚è¿™é‡Œæ˜¯å¦å¤–ä¸€ä¸ªä¾‹å­ï¼š

```rust,ignore
let foo = bar;
```

è¿™è¡Œä»£ç ä¼šåˆ›å»ºä¸€ä¸ªå«åš`foo`çš„æ–°å˜é‡å¹¶æŠŠå®ƒç»‘å®šåˆ°å€¼`bar`ä¸Šã€‚åœ¨ Rust ä¸­ï¼Œå˜é‡é»˜è®¤æ˜¯ä¸å¯å˜çš„ã€‚ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨å˜é‡åå‰ä½¿ç”¨`mut`æ¥ä½¿ä¸€ä¸ªå˜é‡å¯å˜ï¼š

```rust
let foo = 5; // immutable
let mut bar = 5; // mutable
```

> æ³¨æ„ï¼š`//` å¼€å§‹ä¸€ä¸ªæ³¨é‡Šï¼Œå®ƒæŒç»­åˆ°æœ¬è¡Œçš„ç»“å°¾ã€‚Rust å¿½ç•¥æ³¨é‡Šä¸­çš„æ‰€æœ‰å†…å®¹ã€‚

ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†`let mut guess`ä¼šå¼•å…¥ä¸€ä¸ªå«åš`guess`çš„å¯å˜å˜é‡ã€‚ç­‰å·ï¼ˆ`=`ï¼‰çš„å¦ä¸€è¾¹æ˜¯`guess`æ‰€ç»‘å®šçš„å€¼ï¼Œå®ƒæ˜¯`String::new`çš„ç»“æœï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¿”å›ä¸€ä¸ª`String`çš„æ–°å®ä¾‹ã€‚[`String`][string]<!-- ignore -->æ˜¯ä¸€ä¸ªæ ‡å‡†åº“æä¾›çš„å­—ç¬¦ä¸²ç±»å‹ï¼Œå®ƒæ˜¯å¯å¢é•¿çš„ã€UTF-8 ç¼–ç çš„æ–‡æœ¬å—ã€‚

[string]: ../std/string/struct.String.html

`::new`é‚£ä¸€è¡Œçš„`::`è¯­æ³•è¡¨æ˜`new`æ˜¯`String`ç±»å‹çš„ä¸€ä¸ª**å…³è”å‡½æ•°**ï¼ˆ*associated function*ï¼‰ã€‚å…³è”å‡½æ•°æ˜¯é’ˆå¯¹ç±»å‹å®ç°çš„ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯`String`ï¼Œè€Œä¸æ˜¯`String`çš„æŸä¸ªç‰¹å®šå®ä¾‹ã€‚ä¸€äº›è¯­è¨€ä¸­æŠŠå®ƒç§°ä¸º**é™æ€æ–¹æ³•**ï¼ˆ*static method*ï¼‰ã€‚

`new`å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç©ºçš„`String`ï¼Œä½ ä¼šåœ¨å¾ˆå¤šç±»å‹ä¸Šå‘ç°`new`å‡½æ•°ï¼Œå› ä¸ºè¿™æ˜¯åˆ›å»ºæŸä¸ªç±»å‹æ–°å€¼çš„å¸¸ç”¨å‡½æ•°åã€‚

æ€»ç»“ä¸€ä¸‹ï¼Œ`let mut guess = String::new();`è¿™ä¸€è¡Œåˆ›å»ºäº†ä¸€ä¸ªå¯å˜å˜é‡ï¼Œç›®å‰å®ƒç»‘å®šåˆ°ä¸€ä¸ª`String`æ–°çš„ã€ç©ºçš„å®ä¾‹ä¸Šã€‚å“Ÿï¼

å›å¿†ä¸€ä¸‹æˆ‘ä»¬åœ¨ç¨‹åºçš„ç¬¬ä¸€è¡Œä½¿ç”¨`use std::io;`ä»æ ‡å‡†åº“ä¸­å¼•ç”¨è¾“å…¥/è¾“å‡ºåŠŸèƒ½ã€‚ç°åœ¨åœ¨`io`ä¸Šè°ƒç”¨ä¸€ä¸ªå…³è”å‡½æ•°ï¼Œ`stdin`ï¼š

```rust,ignore
io::stdin().read_line(&mut guess)
    .expect("Failed to read line");
```

å¦‚æœæˆ‘ä»¬åœ¨ç¨‹åºçš„å¼€å¤´æ²¡æœ‰`use std::io`è¿™ä¸€è¡Œï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå‡½æ•°è°ƒç”¨å†™æˆ`std::io::stdin`è¿™æ ·ã€‚`stdin`å‡½æ•°è¿”å›ä¸€ä¸ª [`std::io::Stdin`][iostdin]<!-- ignore -->çš„å®ä¾‹ï¼Œè¿™æ˜¯ä¸€ä¸ªä»£è¡¨ç»ˆç«¯æ ‡å‡†è¾“å…¥å¥æŸ„çš„ç±»å‹ã€‚

[iostdin]: ../std/io/struct.Stdin.html

ä»£ç çš„ä¸‹ä¸€éƒ¨åˆ†ï¼Œ`.read_line(&mut guess)`ï¼Œè°ƒç”¨ [`read_line`][read_line]<!-- ignore --> æ–¹æ³•ä»æ ‡å‡†è¾“å…¥å¥æŸ„è·å–ç”¨æˆ·è¾“å…¥ã€‚æˆ‘ä»¬è¿˜å‘`read_line()`ä¼ é€’äº†ä¸€ä¸ªå‚æ•°ï¼š`&mut guess`ã€‚

[read_line]: ../std/io/struct.Stdin.html#method.read_line

`read_line`çš„å·¥ä½œæ˜¯æŠŠè·å–ä»»ä½•ç”¨æˆ·é”®å…¥åˆ°æ ‡å‡†è¾“å…¥çš„å­—ç¬¦å¹¶æ”¾å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œæ‰€ä»¥å®ƒè·å–å­—ç¬¦ä¸²ä½œä¸ºä¸€ä¸ªå‚æ•°ã€‚è¿™ä¸ªå­—ç¬¦ä¸²éœ€è¦æ˜¯å¯å˜çš„ï¼Œè¿™æ ·è¿™ä¸ªæ–¹æ³•å°±å¯ä»¥é€šè¿‡å¢åŠ ç”¨æˆ·çš„è¾“å…¥æ¥æ”¹å˜å­—ç¬¦ä¸²çš„å†…å®¹ã€‚

`&`è¡¨æ˜è¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª**å¼•ç”¨**ï¼ˆ*reference*ï¼‰ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå…è®¸å¤šä¸ªä¸åŒéƒ¨åˆ†çš„ä»£ç è®¿é—®åŒä¸€ä»½æ•°æ®è€Œä¸éœ€è¦åœ¨å†…å­˜ä¸­å¤šæ¬¡æ‹·è´çš„æ–¹æ³•ã€‚å¼•ç”¨æ˜¯ä¸€ä¸ªå¤æ‚çš„åŠŸèƒ½ï¼Œè€Œ Rust çš„ä¸€å¤§ä¼˜åŠ¿å°±æ˜¯å®ƒæ˜¯å®‰å…¨è€Œä¼˜é›…æ“çºµå¼•ç”¨ã€‚å®Œæˆè¿™ä¸ªç¨‹åºå¹¶ä¸éœ€è¦çŸ¥é“è¿™ä¹ˆå¤šç»†èŠ‚ï¼šç¬¬å››ç« ä¼šæ›´å…¨é¢çš„è§£é‡Šå¼•ç”¨ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬åªéœ€çŸ¥é“å®ƒåƒå˜é‡ä¸€æ ·ï¼Œé»˜è®¤æ˜¯ä¸å¯å˜çš„ã€‚å› æ­¤ï¼Œéœ€è¦å†™æˆ`&mut guess`è€Œä¸æ˜¯`&guess`æ¥ä½¿å…¶å¯å˜ã€‚

è¿™è¡Œä»£ç è¿˜æ²¡æœ‰åˆ†æå®Œã€‚è™½ç„¶è¿™æ˜¯å•ç‹¬ä¸€è¡Œä»£ç ï¼Œä½†å®ƒåªæ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šä»£ç è¡Œï¼ˆè™½ç„¶æ¢è¡Œäº†ä½†ä»æ˜¯ä¸€ä¸ªè¯­å¥ï¼‰çš„ç¬¬ä¸€éƒ¨åˆ†ã€‚ç¬¬äºŒéƒ¨åˆ†æ˜¯è¿™ä¸ªæ–¹æ³•ï¼š

```rust,ignore
.expect("Failed to read line");
```

å½“ä½¿ç”¨`.foo()`è¯­æ³•è°ƒç”¨æ–¹æ³•æ—¶ï¼Œæ˜æ™ºçš„é€‰æ‹©æ˜¯æ¢è¡Œå¹¶ç•™å‡ºç©ºç™½ï¼ˆç¼©è¿›ï¼‰æ¥æŠŠé•¿çš„ä»£ç è¡Œæ‹†å¼€ã€‚æˆ‘ä»¬å¯ä»¥æŠŠä»£ç å†™æˆè¿™æ ·ï¼š

```rust,ignore
io::stdin().read_line(&mut guess).expect("Failed to read line");
```

ä¸è¿‡ï¼Œè¿‡é•¿çš„ä»£ç è¡Œéš¾ä»¥é˜…è¯»ï¼Œæ‰€ä»¥æœ€å¥½æ‹†å¼€æ¥å†™ï¼Œä¸¤è¡Œä»£ç ä¸¤ä¸ªæ–¹æ³•è°ƒç”¨ã€‚ç°åœ¨æ¥çœ‹çœ‹è¿™è¡Œä»£ç å¹²äº†ä»€ä¹ˆã€‚

### ä½¿ç”¨`Result`ç±»å‹æ¥å¤„ç†æ½œåœ¨çš„é”™è¯¯

ä¹‹å‰æåˆ°è¿‡ï¼Œ`read_line`å°†ç”¨æˆ·è¾“å…¥æ”¾å…¥åˆ°ä¼ é€’ç»™å®ƒå­—ç¬¦ä¸²ä¸­ï¼Œä¸è¿‡å®ƒä¹Ÿè¿”å›ä¸€ä¸ªå€¼â€”â€”â€”â€”ä¸€ä¸ª[`io::Result`][ioresult]<!-- ignore -->ã€‚Rust æ ‡å‡†åº“ä¸­æœ‰å¾ˆå¤šå«åš`Result`çš„ç±»å‹ã€‚ä¸€ä¸ª[`Result`][result]<!-- ignore -->æ³›å‹ä»¥åŠå¯¹åº”å­æ¨¡å—çš„ç‰¹å®šç‰ˆæœ¬ï¼Œæ¯”å¦‚`io::Result`ã€‚

[ioresult]: ../std/io/type.Result.html
[result]: ../std/result/enum.Result.html

`Result`ç±»å‹æ˜¯ [*æšä¸¾*ï¼ˆ*enumerations*ï¼‰][enums]<!-- ignore -->ï¼Œé€šå¸¸ä¹Ÿå†™ä½œ *enums*ã€‚æšä¸¾æ‹¥æœ‰å›ºå®šå€¼é›†åˆçš„ç±»å‹ï¼Œè€Œè¿™äº›å€¼è¢«ç§°ä¸ºæšä¸¾çš„**æˆå‘˜**ï¼ˆ*variants*ï¼‰ã€‚ç¬¬å…­ç« ä¼šæ›´è¯¦ç»†çš„ä»‹ç»æšä¸¾ã€‚

[enums]: ch06-00-enums.html

å¯¹äº`Result`ï¼Œå®ƒçš„æˆå‘˜æ˜¯`Ok`æˆ–`Err`ï¼Œ`Ok`è¡¨æ˜æ“ä½œæˆåŠŸäº†ï¼ŒåŒæ—¶`Ok`æˆå‘˜ä¹‹ä¸­åŒ…å«æˆåŠŸç”Ÿæˆçš„å€¼ã€‚`Err`æ„å‘³ç€æ“ä½œå¤±è´¥ï¼Œ`Err`ä¹‹ä¸­åŒ…å«æ“ä½œæ˜¯ä¸ºä»€ä¹ˆæˆ–å¦‚ä½•å¤±è´¥çš„ä¿¡æ¯ã€‚

`Result`ç±»å‹çš„ä½œç”¨æ˜¯ç¼–ç é”™è¯¯å¤„ç†ä¿¡æ¯ã€‚`Result`ç±»å‹çš„å€¼ï¼Œæ­£å¦‚å…¶ä»–ä»»ä½•ç±»å‹ï¼Œæ‹¥æœ‰å®šä¹‰äºå…¶ä¸Šçš„æ–¹æ³•ã€‚`io::Result`çš„å®ä¾‹æ‹¥æœ‰[`expect`æ–¹æ³•][expect]<!-- ignore -->å¯ä¾›è°ƒç”¨ã€‚å¦‚æœ`io::Result`å®ä¾‹çš„å€¼æ˜¯`Err`ï¼Œ`expect`ä¼šå¯¼è‡´ç¨‹åºå´©æºƒå¹¶æ˜¾ç¤ºæ˜¾ç¤ºä½ ä½œä¸ºå‚æ•°ä¼ é€’ç»™`expect`çš„ä¿¡æ¯ã€‚å¦‚æœ`io::Result`å®ä¾‹çš„å€¼æ˜¯`Ok`ï¼Œ`expect`ä¼šè·å–`Ok`ä¸­çš„å€¼å¹¶åŸåŸæœ¬æœ¬çš„è¿”å›ç»™ä½ ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨å®ƒäº†ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè¿”å›å€¼æ˜¯ç”¨æˆ·è¾“å…¥åˆ°æ ‡å‡†è¾“å…¥çš„ä¸€äº›å­—ç¬¦ã€‚

[expect]: ../std/result/enum.Result.html#method.expect

å¦‚æœä¸ä½¿ç”¨`expect`ï¼Œç¨‹åºä¹Ÿèƒ½ç¼–è¯‘ï¼Œä¸è¿‡ä¼šå‡ºç°ä¸€ä¸ªè­¦å‘Šï¼š

```sh
$ cargo build
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
src/main.rs:10:5: 10:39 warning: unused result which must be used,
#[warn(unused_must_use)] on by default
src/main.rs:10     io::stdin().read_line(&mut guess);
                   ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
```

Rust è­¦å‘Šè¯´æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨`read_line`è¿”å›çš„å€¼`Result`ï¼Œè¡¨æ˜ç¨‹åºæ²¡æœ‰å¤„ç†ä¸€ä¸ªå¯èƒ½çš„é”™è¯¯ã€‚æ¶ˆé™¤è­¦å‘Šçš„æ­£ç¡®æ–¹å¼æ˜¯è€å®ç¼–å†™é”™è¯¯å¤„ç†ï¼Œä¸è¿‡å› ä¸ºæˆ‘ä»¬ä»…ä»…å¸Œæœ›ç¨‹åºå‡ºç°é—®é¢˜å°±å´©æºƒï¼Œå¯ä»¥ä½¿ç”¨`expect`ã€‚ä½ ä¼šåœ¨ç¬¬ä¹ç« å­¦ä¹ ä»é”™è¯¯ä¸­æ¢å¤ã€‚

### ä½¿ç”¨`println!`å ä½ç¬¦æ‰“å°å€¼

é™¤äº†ä½äºç»“å°¾çš„å¤§æ‹¬å·ï¼Œç›®å‰ä¸ºæ­¢ç¼–å†™çš„ä»£ç å°±åªæœ‰ä¸€è¡Œä»£ç å€¼å¾—è®¨è®ºä¸€ä¸‹äº†ï¼Œå°±æ˜¯è¿™ä¸€è¡Œï¼š

```rust,ignore
println!("You guessed: {}", guess);
```

è¿™è¡Œä»£ç æ‰“å°å‡ºå­˜å‚¨äº†ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²ã€‚è¿™å¯¹`{}`æ˜¯ä¸€ä¸ªåœ¨ç‰¹å®šä½ç½®é¢„ç•™å€¼çš„å ä½ç¬¦ã€‚å¯ä»¥ä½¿ç”¨`{}`æ‰“å°å¤šä¸ªå€¼ï¼šç¬¬ä¸€ä¸ª`{}`å¯¹åº”æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¹‹ååˆ—å‡ºçš„ç¬¬ä¸€ä¸ªå€¼ï¼Œç¬¬äºŒä¸ªå¯¹åº”ç¬¬äºŒä¸ªå€¼ï¼Œä»¥æ­¤ç±»æ¨ã€‚ç”¨ä¸€ä¸ª`println!`è°ƒç”¨æ‰“å°å¤šä¸ªå€¼åº”è¯¥çœ‹èµ·æ¥åƒè¿™æ ·ï¼š

```rust
let x = 5;
let y = 10;

println!("x = {} and y = {}", x, y);
```

è¿™è¡Œä»£ç ä¼šæ‰“å°å‡º`x = 5 and y = 10`ã€‚

### æµ‹è¯•ç¬¬ä¸€éƒ¨åˆ†ä»£ç 

è®©æˆ‘ä»¬æ¥æµ‹è¯•ä¸‹çŒœçŒœçœ‹æ¸¸æˆçš„ç¬¬ä¸€éƒ¨åˆ†ã€‚ä½¿ç”¨`cargo run`è¿è¡Œå®ƒï¼š

```sh
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
     Running `target/debug/guessing_game`
Guess the number!
Please input your guess.
6
You guessed: 6
```

è‡³æ­¤ä¸ºæ­¢ï¼Œæ¸¸æˆçš„ç¬¬ä¸€éƒ¨åˆ†å·²ç»å®Œæˆï¼šæˆ‘ä»¬ä»é”®ç›˜è·å–äº†è¾“å…¥å¹¶æ‰“å°äº†å‡ºæ¥ã€‚

## ç”Ÿæˆä¸€ä¸ªç§˜å¯†æ•°å­—

æ¥ä¸‹æ¥ï¼Œéœ€è¦ç”Ÿæˆä¸€ä¸ªç§˜å¯†æ•°å­—ï¼Œç”¨æˆ·ä¼šå°è¯•çŒœæµ‹å®ƒã€‚ç§˜å¯†æ•°å­—åº”è¯¥æ¯æ¬¡éƒ½ä¸åŒï¼Œè¿™æ ·å¤šç©å‡ æ¬¡æ‰ä¼šæœ‰æ„æ€ã€‚ç”Ÿæˆä¸€ä¸ª 1 åˆ° 100 ä¹‹é—´çš„éšæœºæ•°è¿™æ ·æ¸¸æˆä¹Ÿä¸ä¼šå¤ªéš¾ã€‚Rust æ ‡å‡†åº“ä¸­è¿˜æœªåŒ…å«éšæœºæ•°åŠŸèƒ½ã€‚ç„¶è€Œï¼ŒRust å›¢é˜Ÿç¡®å®æä¾›äº†ä¸€ä¸ª[`rand` crate][randcrate]ã€‚

[randcrate]: https://crates.io/crates/rand

## ä½¿ç”¨ crate æ¥å¢åŠ æ›´å¤šåŠŸèƒ½

è®°ä½ *crate* æ˜¯ä¸€ä¸ª Rust ä»£ç çš„åŒ…ã€‚æˆ‘ä»¬æ­£åœ¨æ„å»ºçš„é¡¹ç›®æ˜¯ä¸€ä¸ª**äºŒè¿›åˆ¶ crate**ï¼Œå®ƒç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚ `rand` crate æ˜¯ä¸€ä¸ª *åº“ crate*ï¼Œå®ƒåŒ…å«æ„åœ¨è¢«å…¶ä»–ç¨‹åºä½¿ç”¨çš„ä»£ç ã€‚

Cargo å¯¹å¤–éƒ¨ crate çš„è¿ç”¨æ˜¯å…¶çœŸæ­£é—ªå…‰çš„åœ°æ–¹ã€‚åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`rand`ç¼–å†™ä»£ç ä¹‹å‰ï¼Œéœ€è¦ç¼–è¾‘ *Cargo.toml* æ¥åŒ…å«`rand`ä½œä¸ºä¸€ä¸ªä¾èµ–ã€‚ç°åœ¨æ‰“å¼€è¿™ä¸ªæ–‡ä»¶å¹¶åœ¨`[dependencies]`éƒ¨åˆ†æ ‡é¢˜ï¼ˆCargo ä¸ºä½ åˆ›å»ºäº†å®ƒï¼‰çš„ä¸‹é¢æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š

<span class="filename">Filename: Cargo.toml</span>

```toml
[dependencies]

rand = "0.3.14"
```

åœ¨ *Cargo.toml* æ–‡ä»¶ä¸­ï¼Œä»»ä½•æ ‡é¢˜ä¹‹åçš„å†…å®¹éƒ½æ˜¯å±äºè¿™ä¸ªéƒ¨åˆ†çš„ï¼Œä¸€ç›´æŒç»­åˆ°ç›´åˆ°å¦ä¸€ä¸ªéƒ¨åˆ†å¼€å§‹ã€‚`[dependencies]`éƒ¨åˆ†å‘Šè¯‰ Cargo é¡¹ç›®ä¾èµ–äº†å“ªä¸ªå¤–éƒ¨ crate å’Œéœ€è¦çš„ crate ç‰ˆæœ¬ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬ç¬¦å·`0.3.14`æ¥æŒ‡å®š`rand`crateã€‚Cargo ç†è§£[è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆSemantic Versioningï¼‰][semver]<!-- ignore -->ï¼ˆæœ‰æ—¶ä¹Ÿç§°ä¸º *SemVer*ï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªç¼–å†™ç‰ˆæœ¬å·çš„æ ‡å‡†ã€‚ç‰ˆæœ¬å·`0.3.14`äº‹å®ä¸Šæ˜¯`^0.3.14`çš„ç¼©å†™ï¼Œå®ƒçš„æ„æ€æ˜¯â€œä»»ä½•ä¸ 0.3.14 ç‰ˆæœ¬å…¬æœ‰ API ç›¸å…¼å®¹çš„ç‰ˆæœ¬â€ã€‚

[semver]: http://semver.org

ç°åœ¨ï¼Œä¸ç”¨ä¿®æ”¹ä»»ä½•ä»£ç ï¼Œæ„å»ºé¡¹ç›®ï¼Œå¦‚åˆ—è¡¨ 2-2ï¼š

<figure>

```text
$ cargo build
    Updating registry `https://github.com/rust-lang/crates.io-index`
 Downloading rand v0.3.14
 Downloading libc v0.2.14
   Compiling libc v0.2.14
   Compiling rand v0.3.14
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
```

<figcaption>

Listing 2-2: The output from running `cargo build` after adding the rand crate
as a dependency

</figcaption>
</figure>

å¯èƒ½ä¼šå‡ºç°ä¸åŒçš„ç‰ˆæœ¬å·ï¼ˆä¸è¿‡å¤šäºäº†è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼Œå®ƒä»¬ä¸ä»£ç æ˜¯å…¼å®¹çš„ï¼ï¼‰ï¼ŒåŒæ—¶æ˜¾ç¤ºé¡ºåºä¹Ÿå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚

ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå¤–éƒ¨ä¾èµ–ï¼ŒCargo ä» *registry* ï¼ˆ[Crates.io][cratesio]ï¼‰ä¸Šè·å–äº†ä¸€ä»½ï¼ˆå…¼å®¹çš„ï¼‰æœ€æ–°ç‰ˆæœ¬ä»£ç çš„æ‹·è´ã€‚Crates.io æ˜¯ Rust ç”Ÿæ€ç¯å¢ƒä¸­çš„äººä»¬å‘ä»–äººè´¡çŒ®ä»–ä»¬çš„å¼€æº Rust é¡¹ç›®çš„åœ°æ–¹ã€‚

[cratesio]: https://crates.io

åœ¨æ›´æ–°å®Œ registry ï¼ˆç´¢å¼•ï¼‰åï¼ŒCargo æ£€æŸ¥`[dependencies]`éƒ¨åˆ†å¹¶ä¸‹è½½è¿˜ä¸å­˜åœ¨éƒ¨åˆ†ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè™½ç„¶åªåˆ—å‡ºäº†`rand`ä¸€ä¸ªä¾èµ–ï¼ŒCargo ä¹Ÿè·å–äº†ä¸€ä»½`libc`çš„æ‹·è´ï¼Œå› ä¸º`rand`ä¾èµ–`libc`æ¥æ­£å¸¸å·¥ä½œã€‚åœ¨ä¸‹è½½ä»–ä»¬ä¹‹åï¼ŒRust ç¼–è¯‘ä»–ä»¬æ¥ç€ç”¨è¿™äº›ä¾èµ–ç¼–è¯‘é¡¹ç›®ã€‚

å¦‚æœä¸åšä»»ä½•ä¿®æ”¹å°±ç«‹åˆ»å†æ¬¡è¿è¡Œ`cargo build`ï¼Œåˆ™ä¸ä¼šæœ‰ä»»ä½•è¾“å‡ºã€‚Cargo çŸ¥é“å®ƒå·²ç»ä¸‹è½½å¹¶ç¼–è¯‘äº†ä¾èµ–ï¼ŒåŒæ—¶ *Cargo.toml* æ–‡ä»¶ä¸­ä¹Ÿæ²¡æœ‰ä»»ä½•ç›¸å…³ä¿®æ”¹ã€‚Cargo ä¹ŸçŸ¥é“ä»£ç æ²¡æœ‰åšä»»ä½•ä¿®æ”¹ï¼Œæ‰€ä»¥å®ƒä¹Ÿä¸ä¼šé‡æ–°ç¼–è¯‘ä»£ç ã€‚å› ä¸ºæ— äº‹å¯åšï¼Œå®ƒç®€å•çš„é€€å‡ºäº†ã€‚å¦‚æœæ‰“å¼€ *src/main.rs* æ–‡ä»¶ï¼Œå¹¶åšä¸€äº›æ™®é€šçš„ä¿®æ”¹ï¼Œä¿å­˜å¹¶å†æ¬¡æ„å»ºï¼Œåªä¼šå‡ºç°ä¸€è¡Œè¾“å‡ºï¼š

```sh
$ cargo build
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
```

è¿™ä¸€è¡Œè¡¨æ˜ Cargo åªæ„å»ºäº†å¯¹ *src/main.rs* æ–‡ä»¶åšå‡ºçš„å¾®å°ä¿®æ”¹ã€‚ä¾èµ–æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œæ‰€ä»¥ Cargo çŸ¥é“å¯ä»¥å¤ç”¨å·²ç»ä¸ºæ­¤ä¸‹è½½å¹¶ç¼–è¯‘çš„ä»£ç ã€‚å®ƒåªæ˜¯é‡æ–°æ„å»ºäº†éƒ¨åˆ†ï¼ˆé¡¹ç›®ï¼‰ä»£ç ã€‚

#### The *Cargo.lock* æ–‡ä»¶ç¡®ä¿æ„å»ºæ˜¯å¯é‡ç°çš„

Cargo æœ‰ä¸€ä¸ªæœºåˆ¶æ¥ç¡®ä¿æ¯æ¬¡ä»»ä½•äººé‡æ–°æ„å»ºä»£ç éƒ½ä¼šç”Ÿæˆç›¸åŒçš„æˆå“ï¼šCargo åªä¼šä½¿ç”¨ä½ æŒ‡å®šçš„ä¾èµ–çš„ç‰ˆæœ¬ï¼Œé™¤éä½ åˆæ‰‹åŠ¨æŒ‡å®šäº†åˆ«çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸‹å‘¨`rand` crate çš„`v0.3.15`ç‰ˆæœ¬å‡ºæ¥äº†ï¼Œè€Œå®ƒåŒ…å«ä¸€ä¸ªé‡è¦çš„ bug ä¿®æ”¹å¹¶ä¹Ÿå«æœ‰ä¸€ä¸ªä¼šç ´åä»£ç è¿è¡Œçš„ç¼ºé™·çš„æ—¶å€™ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ

è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆæ˜¯ *Cargo.lock* æ–‡ä»¶ï¼Œå®ƒåœ¨ç¬¬ä¸€æ¬¡è¿è¡Œ`cargo build`æ—¶è¢«åˆ›å»ºå¹¶ä½äº *guessing_game* ç›®å½•ã€‚å½“ç¬¬ä¸€æ¬¡æ„å»ºé¡¹ç›®æ—¶ï¼ŒCargo è®¡ç®—å‡ºæ‰€æœ‰ç¬¦åˆè¦æ±‚çš„ä¾èµ–ç‰ˆæœ¬å¹¶æ¥ç€å†™å…¥ *Cargo.lock* æ–‡ä»¶ä¸­ã€‚å½“å°†æ¥æ„å»ºé¡¹ç›®æ—¶ï¼ŒCargo å‘ç° *Cargo.lock* å­˜åœ¨å°±ä¼šä½¿ç”¨è¿™é‡ŒæŒ‡å®šçš„ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯é‡æ–°è¿›è¡Œæ‰€æœ‰ç‰ˆæœ¬çš„è®¡ç®—ã€‚è¿™ä½¿å¾—ä½ æ‹¥æœ‰äº†ä¸€ä¸ªè‡ªåŠ¨çš„å¯é‡ç°çš„æ„å»ºã€‚æ¢å¥è¯è¯´ï¼Œé¡¹ç›®ä¼šç»§ç»­ä½¿ç”¨`0.3.14`ç›´åˆ°ä½ æ˜¾å¼å‡çº§ï¼Œå¤šäºäº† *Cargo.lock* æ–‡ä»¶ã€‚æˆ‘ä»¬å°†ä¼šåœ¨è¿™ä¸ªæ–‡ä»¶ç¼–å†™å…¨éƒ¨çš„ä»£ç ã€‚

#### æ›´æ–° crate åˆ°ä¸€ä¸ªæ–°ç‰ˆæœ¬

å½“ä½ **ç¡®å®**éœ€è¦å‡çº§ crate æ—¶ï¼ŒCargo æä¾›äº†å¦ä¸€ä¸ªå‘½ä»¤ï¼Œ`update`ï¼Œä»–ä¼šï¼š

1. å¿½ç•¥ *Cargo.lock* æ–‡ä»¶å¹¶è®¡ç®—å‡ºæ‰€æœ‰ç¬¦åˆ *Cargo.toml* ä¸­è§„æ ¼çš„æœ€æ–°ç‰ˆæœ¬ã€‚
2. å¦‚æœæˆåŠŸäº†ï¼ŒCargo ä¼šæŠŠè¿™äº›ç‰ˆæœ¬å†™å…¥ *Cargo.lock* æ–‡ä»¶ã€‚

ä¸è¿‡ï¼ŒCargo é»˜è®¤åªä¼šå¯»æ‰¾å¤§äº`0.3.0`è€Œå°äº`0.4.0`çš„ç‰ˆæœ¬ã€‚å¦‚æœ`rand` crate å‘å¸ƒäº†ä¸¤ä¸ªæ–°ç‰ˆæœ¬ï¼Œ`0.3.15`å’Œ`0.4.0`ï¼Œåœ¨è¿è¡Œ`cargo update`æ—¶ä¼šå‡ºç°å¦‚ä¸‹å†…å®¹ï¼š

```sh
$ cargo update
    Updating registry `https://github.com/rust-lang/crates.io-index`
    Updating rand v0.3.14 -> v0.3.15
```

è¿™æ—¶ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ *Cargo.lock* æ–‡ä»¶ä¸­çš„ä¸€ä¸ªæ”¹å˜ï¼Œ`rand` crate ç°åœ¨ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯`0.3.15`ã€‚

å¦‚æœæƒ³è¦ä½¿ç”¨`0.4.0`ç‰ˆæœ¬çš„`rand`æˆ–æ˜¯ä»»ä½•`0.4.x`ç³»åˆ—çš„ç‰ˆæœ¬ï¼Œå¿…é¡»åƒè¿™æ ·æ›´æ–° *Cargo.toml* æ–‡ä»¶ï¼š

```toml
[dependencies]

rand = "0.4.0"
```

ä¸‹ä¸€æ¬¡è¿è¡Œ`cargo build`æ—¶ï¼ŒCargo ä¼šæ›´æ–° registry ä¸­å¯ç”¨çš„ crate å¹¶æ ¹æ®ä½ æŒ‡å®šæ–°ç‰ˆæœ¬é‡æ–°è®¡ç®—`rand`çš„è¦æ±‚ã€‚

ç¬¬åå››ç« ä¼šè®²åˆ°[Cargo][doccargo]<!-- ignore --> å’Œ[å®ƒçš„ç”Ÿæ€ç³»ç»Ÿ][doccratesio]<!-- ignore -->çš„æ›´å¤šå†…å®¹ï¼Œä¸è¿‡ç›®å‰ä½ åªéœ€è¦äº†è§£è¿™ä¹ˆå¤šã€‚Cargo ä½¿å¾—å¤ç”¨åº“æ–‡ä»¶å˜å¾—éå¸¸å®¹æ˜“ï¼Œæ‰€ä»¥ Rustacean ä»¬èƒ½å¤Ÿé€šè¿‡ç»„åˆå¾ˆå¤šåŒ…æ¥ç¼–å†™å‡ºæ›´è½»å·§çš„é¡¹ç›®ã€‚

[doccargo]: http://doc.crates.io
[doccratesio]: http://doc.crates.io/crates-io.html

### ç”Ÿæˆä¸€ä¸ªéšæœºæ•°

è®©æˆ‘ä»¬å¼€å§‹**ä½¿ç”¨**`rand`ã€‚ä¸‹ä¸€æ­¥æ˜¯æ›´æ–° *src/main.rs*ï¼Œå¦‚åˆ—è¡¨ 2-3ï¼š

<figure>
<span class="filename">Filename: src/main.rs</span>

```rust,ignore
extern crate rand;

use std::io;
use rand::Rng;

fn main() {
    println!("Guess the number!");

    let secret_number = rand::thread_rng().gen_range(1, 101);

    println!("The secret number is: {}", secret_number);

    println!("Please input your guess.");

    let mut guess = String::new();

    io::stdin().read_line(&mut guess)
        .expect("Failed to read line");

    println!("You guessed: {}", guess);
}
```

<figcaption>

Listing 2-3: Code changes needed in order to generate a random number

</figcaption>
</figure>

æˆ‘ä»¬åœ¨é¡¶éƒ¨å¢åŠ ä¸€è¡Œ`extern crate rand;`æ¥è®© Rust çŸ¥é“æˆ‘ä»¬è¦ä½¿ç”¨å¤–éƒ¨ä¾èµ–ã€‚è¿™ä¹Ÿä¼šè°ƒç”¨ç›¸åº”çš„`use rand`ï¼Œæ‰€ä»¥ç°åœ¨å¯ä»¥ä½¿ç”¨`rand::`å‰ç¼€æ¥è°ƒç”¨`rand`ä¸­çš„ä»»ä½•å†…å®¹ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¢åŠ äº†å¦ä¸€è¡Œ`use`ï¼š`use rand::Rng`ã€‚`Rng`æ˜¯ä¸€ä¸ªå®šä¹‰äº†éšæœºæ•°ç”Ÿæˆå™¨åº”å®ç°æ–¹æ³•çš„ traitï¼Œå¦‚æœè¦ä½¿ç”¨è¿™äº›æ–¹æ³•çš„è¯è¿™ä¸ª trait å¿…é¡»åœ¨ä½œç”¨åŸŸä¸­ã€‚ç¬¬åç« ä¼šè¯¦ç»†ä»‹ç» traitã€‚

å¦å¤–ï¼Œä¸­é—´è¿˜æ–°å¢åŠ äº†ä¸¤è¡Œã€‚`rand::thread_rng`å‡½æ•°ä¼šæä¾›å…·ä½“ä¼šä½¿ç”¨çš„éšæœºæ•°ç”Ÿæˆå™¨ï¼šå®ƒä½äºå½“å‰æ‰§è¡Œçº¿ç¨‹æœ¬åœ°å¹¶ä»æ“ä½œç³»ç»Ÿè·å– seedã€‚æ¥ä¸‹æ¥ï¼Œè°ƒç”¨éšæœºæ•°ç”Ÿæˆå™¨çš„`gen_range`æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ç”±æˆ‘ä»¬ä½¿ç”¨`use rand::Rng`è¯­å¥å¼•å…¥åˆ°ä½œç”¨åŸŸçš„`Rng` trait å®šä¹‰ã€‚`gen_range`æ–¹æ³•è·å–ä¸¤ä¸ªæ•°ä½œä¸ºå‚æ•°å¹¶ç”Ÿæˆä¸€ä¸ªä¸¤è€…ä¹‹é—´çš„éšæœºæ•°ã€‚å®ƒåŒ…å«ä¸‹é™ä½†ä¸åŒ…å«ä¸Šé™ï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®š`1`å’Œ`101`æ¥è¯·æ±‚ä¸€ä¸ª`1`å’Œ`100`ä¹‹é—´çš„æ•°ã€‚

å¹¶ä¸ä»…ä»…èƒ½å¤ŸçŸ¥é“è¯¥ use å“ªä¸ª trait å’Œè¯¥ä» crate ä¸­è°ƒç”¨å“ªä¸ªæ–¹æ³•ã€‚å¦‚ä½•ä½¿ç”¨ crate çš„è¯´æ˜åœ¨æ¯ä¸ª crate çš„æ–‡æ¡£ä¸­ã€‚Cargo å¦ä¸€ä¸ªå¾ˆæ£’çš„åŠŸèƒ½æ˜¯å¯ä»¥è¿è¡Œ`cargo doc --open`å‘½ä»¤æ¥æ„å»ºæ‰€æœ‰æœ¬åœ°ä¾èµ–æä¾›çš„æ–‡æ¡£å¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å¯¹`rand` crate ä¸­çš„å…¶ä»–åŠŸèƒ½æ„Ÿå…´è¶£ï¼Œè¿è¡Œ`cargo doc --open`å¹¶ç‚¹å‡»å·¦ä¾§å¯¼èˆªæ çš„`rand`ã€‚

æ–°å¢åŠ çš„ç¬¬äºŒè¡Œä»£ç æ‰“å°å‡ºäº†ç§˜å¯†æ•°å­—ã€‚è¿™åœ¨å¼€å‘ç¨‹åºæ—¶å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥å»æµ‹è¯•å®ƒï¼Œä¸è¿‡åœ¨æœ€ç»ˆç‰ˆæœ¬æˆ‘ä»¬ä¼šåˆ æ‰å®ƒã€‚æ¸¸æˆä¸€å¼€å§‹å°±æ‰“å°å‡ºç»“æœå°±æ²¡ä»€ä¹ˆå¯ç©çš„äº†ï¼

å°è¯•è¿è¡Œç¨‹åºå‡ æ¬¡ï¼š

```sh
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
     Running `target/debug/guessing_game`
Guess the number!
The secret number is: 7
Please input your guess.
4
You guessed: 4
$ cargo run
     Running `target/debug/guessing_game`
Guess the number!
The secret number is: 83
Please input your guess.
5
You guessed: 5
```

ä½ åº”è¯¥èƒ½å¾—åˆ°ä¸åŒçš„éšæœºæ•°ï¼ŒåŒæ—¶ä»–ä»¬åº”è¯¥éƒ½æ˜¯åœ¨ 1 å’Œ 100 ä¹‹é—´çš„ã€‚å¹²å¾—æ¼‚äº®ï¼

## æ¯”è¾ƒçŒœæµ‹ä¸ç§˜å¯†æ•°å­—

ç°åœ¨æœ‰äº†ç”¨æˆ·è¾“å…¥å’Œä¸€ä¸ªéšæœºæ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ¯”è¾ƒä»–ä»¬ã€‚è¿™ä¸ªæ­¥éª¤å¦‚åˆ—è¡¨ 2-4ï¼š

<figure>
<span class="filename">Filename: src/main.rs</span>

```rust,ignore
extern crate rand;

use std::io;
use std::cmp::Ordering;
use rand::Rng;

fn main() {
    println!("Guess the number!");

    let secret_number = rand::thread_rng().gen_range(1, 101);

    println!("The secret number is: {}", secret_number);

    println!("Please input your guess.");

    let mut guess = String::new();

    io::stdin().read_line(&mut guess)
        .expect("Failed to read line");

    println!("You guessed: {}", guess);

    match guess.cmp(&secret_number) {
        Ordering::Less    => println!("Too small!"),
        Ordering::Greater => println!("Too big!"),
        Ordering::Equal   => println!("You win!"),
    }
}
```

<figcaption>

Listing 2-4: Handling the possible return values of comparing two numbers

</figcaption>
</figure>

æ–°ä»£ç çš„ç¬¬ä¸€è¡Œæ˜¯å¦ä¸€ä¸ª`use`ï¼Œä»æ ‡å‡†åº“å¼•å…¥äº†ä¸€ä¸ªå«åš`std::cmp::Ordering`çš„ç±»å‹åˆ°ä½œç”¨åŸŸã€‚`Ordering`æ˜¯å¦ä¸€ä¸ªæšä¸¾ï¼Œåƒ`Result`ä¸€æ ·ï¼Œä¸è¿‡`Ordering`çš„æˆå‘˜æ˜¯`Less`ã€`Greater`å’Œ`Equal`ã€‚è¿™æ˜¯ä½ æ¯”è¾ƒä¸¤ä¸ªå€¼æ—¶å¯èƒ½å‡ºç°ä¸‰ç§ç»“æœã€‚

æ¥ç€åœ¨åº•éƒ¨çš„äº”è¡Œæ–°ä»£ç ä½¿ç”¨äº†`Ordering`ç±»å‹ï¼š

```rust,ignore
match guess.cmp(&secret_number) {
    Ordering::Less    => println!("Too small!"),
    Ordering::Greater => println!("Too big!"),
    Ordering::Equal   => println!("You win!"),
}
```

`cmp`æ–¹æ³•æ¯”è¾ƒä¸¤ä¸ªå€¼å¹¶å¯ä»¥åœ¨ä»»ä½•å¯æ¯”è¾ƒçš„å€¼ä¸Šè°ƒç”¨ã€‚å®ƒè·å–ä¸€ä¸ªä»»ä½•ä½ æƒ³è¦æ¯”è¾ƒçš„å€¼çš„å¼•ç”¨ï¼šè¿™é‡Œæ˜¯æŠŠ`guess`ä¸`secret_number`åšæ¯”è¾ƒã€‚`cmp`è¿”å›ä¸€ä¸ªä½¿ç”¨`use`è¯­å¥å¼•å…¥ä½œç”¨åŸŸçš„`Ordering`æšä¸¾çš„æˆå‘˜ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª[`match`][match]<!-- ignore -->è¡¨è¾¾å¼æ ¹æ®å¯¹`guess`å’Œ`secret_number`ä¸­çš„å€¼è°ƒç”¨`cmp`åè¿”å›çš„å“ªä¸ª`Ordering`æšä¸¾æˆå‘˜æ¥å†³å®šæ¥ä¸‹æ¥å¹²ä»€ä¹ˆã€‚

[match]: ch06-02-match.html

ä¸€ä¸ª`match`è¡¨è¾¾å¼ç”± **åˆ†æ”¯ï¼ˆarmsï¼‰** æ„æˆã€‚ä¸€ä¸ªåˆ†æ”¯åŒ…å«ä¸€ä¸ª **æ¨¡å¼**ï¼ˆ*pattern*ï¼‰å’Œä»£ç ï¼Œè¿™äº›ä»£ç åœ¨`match`è¡¨è¾¾å¼å¼€å¤´ç»™å‡ºçš„å€¼ç¬¦åˆåˆ†æ”¯çš„æ¨¡å¼æ—¶å°†è¢«æ‰§è¡Œã€‚Rust è·å–æä¾›ç»™`match`çš„å€¼å¹¶æŒ¨ä¸ªæ£€æŸ¥æ¯ä¸ªåˆ†æ”¯çš„æ¨¡å¼ã€‚`match`ç»“æ„å’Œæ¨¡å¼æ˜¯ Rust ä¸­éå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œå®ƒå¸®åŠ©ä½ ä½“ç°ä»£ç å¯èƒ½é‡åˆ°çš„å¤šç§æƒ…å½¢å¹¶å¸®åŠ©ä½ å¤„ç†å…¨éƒ¨çš„å¯èƒ½ã€‚è¿™äº›åŠŸèƒ½å°†åˆ†åˆ«åœ¨ç¬¬å…­ç« å’Œç¬¬åä¹ç« è¯¦ç»†ä»‹ç»ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹ä¸€ä¸ªä½¿ç”¨è¿™é‡Œçš„`match`è¡¨è¾¾å¼ä¼šå‘ç”Ÿä»€ä¹ˆçš„ä¾‹å­ã€‚å‡è®¾ç”¨æˆ·çŒœäº† 50ï¼Œè¿™æ—¶éšæœºç”Ÿæˆçš„ç§˜å¯†æ•°å­—æ˜¯ 38ã€‚å½“ä»£ç æ¯”è¾ƒ 50 ä¸ 38 æ—¶ï¼Œ`cmp`æ–¹æ³•ä¼šè¿”å›`Ordering::Greater`ï¼Œå› ä¸º 50 æ¯” 38 è¦å¤§ã€‚`Ordering::Greater`æ˜¯`match`è¡¨è¾¾å¼å¾—åˆ°çš„å€¼ã€‚å®ƒæ£€æŸ¥ç¬¬ä¸€ä¸ªåˆ†æ”¯çš„æ¨¡å¼ï¼Œ`Ordering::Less`ï¼Œä¸è¿‡å€¼`Ordering::Greater`å¹¶ä¸åŒ¹é…`Ordering::Less`ã€‚æ‰€ä»¥å®ƒå¿½ç•¥äº†è¿™ä¸ªåˆ†æ”¯çš„ä»£ç å¹¶ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªåˆ†æ”¯ã€‚ä¸‹ä¸€ä¸ªåˆ†æ”¯çš„æ¨¡å¼ï¼Œ`Ordering::Greater`ï¼Œ**æ­£ç¡®**åŒ¹é…äº†`Ordering::Greater`ï¼è¿™ä¸ªåˆ†æ”¯å…³è”çš„ä»£ç ä¼šè¢«æ‰§è¡Œå¹¶åœ¨å±å¹•æ‰“å°å‡º`Too big!`ã€‚`match`è¡¨è¾¾å¼å°±æ­¤ç»ˆæ­¢ï¼Œå› ä¸ºåœ¨è¿™ä¸ªç‰¹å®šåœºæ™¯ä¸‹æ²¡æœ‰æ£€æŸ¥æœ€åä¸€ä¸ªåˆ†æ”¯çš„å¿…è¦ã€‚

ç„¶è€Œï¼Œåˆ—è¡¨ 2-4 çš„ä»£ç å¹¶ä¸èƒ½ç¼–è¯‘ï¼Œå°è¯•ä¸€ä¸‹ï¼š

```sh
$ cargo build
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
error[E0308]: mismatched types
  --> src/main.rs:23:21
   |
23 |     match guess.cmp(&secret_number) {
   |                     ^^^^^^^^^^^^^^ expected struct `std::string::String`, found integral variable
   |
   = note: expected type `&std::string::String`
   = note:    found type `&{integer}`

error: aborting due to previous error
Could not compile `guessing_game`.
```

é”™è¯¯çš„æ ¸å¿ƒè¡¨æ˜è¿™é‡Œæœ‰**ä¸åŒ¹é…çš„ç±»å‹**ï¼ˆ*mismatched types*ï¼‰ã€‚Rust æ‹¥æœ‰ä¸€ä¸ªé™æ€å¼ºç±»å‹ç³»ç»Ÿã€‚ä¸è¿‡ï¼Œå®ƒä¹Ÿæœ‰ç±»å‹æ¨æ–­ã€‚å½“æˆ‘ä»¬å†™å‡º`let guess = String::new()`æ—¶ï¼ŒRust èƒ½å¤Ÿæ¨æ–­å‡º`guess`åº”è¯¥æ˜¯ä¸€ä¸ª`String`ï¼Œå¹¶ä¸éœ€è¦æˆ‘ä»¬å†™å‡ºç±»å‹ã€‚å¦ä¸€æ–¹é¢ï¼Œ`secret_number`ï¼Œæ˜¯ä¸€ä¸ªæ•°å­—ç±»å‹ã€‚ä¸€äº›æ•°å­—ç±»å‹æ‹¥æœ‰ 1 åˆ° 100 ä¹‹é—´çš„å€¼ï¼š`i32`ï¼Œä¸€ä¸ª 32 ä½çš„æ•°å­—ï¼›`u32`ï¼Œä¸€ä¸ª 32 ä½æ— ç¬¦å·æ•°å­—ï¼›`i64`ï¼Œä¸€ä¸ª 64 ä½æ•°å­—ï¼›ç­‰ç­‰ã€‚Rust é»˜è®¤ä½¿ç”¨`i32`ï¼Œæ‰€ä»¥`secret_number`çš„ç±»å‹å°±æ˜¯å®ƒï¼Œé™¤éå¢åŠ ç±»å‹ä¿¡æ¯æˆ–ä»»ä½•èƒ½è®© Rust æ¨æ–­å‡ºä¸åŒæ•°å€¼ç±»å‹çš„ä¿¡æ¯ã€‚è¿™é‡Œé”™è¯¯çš„åŸå› æ˜¯ Rust ä¸ä¼šæ¯”è¾ƒå­—ç¬¦ä¸²ç±»å‹å’Œæ•°å­—ç±»å‹ã€‚

æœ€ç»ˆæˆ‘ä»¬æƒ³è¦æŠŠç¨‹åºä»è¾“å…¥ä¸­è¯»å–åˆ°çš„`String`è½¬æ¢ä¸ºä¸€ä¸ªçœŸæ­£çš„æ•°å­—ç±»å‹ï¼Œè¿™æ ·å¥½ä¸ç§˜å¯†æ•°å­—å‘æ¯”è¾ƒã€‚å¯ä»¥é€šè¿‡åœ¨`main`å‡½æ•°ä½“ä¸­å¢åŠ å¦‚ä¸‹ä¸¤è¡Œä»£ç æ¥å®ç°ï¼š

<span class="filename">Filename: src/main.rs</span>

```rust,ignore
extern crate rand;

use std::io;
use std::cmp::Ordering;
use rand::Rng;

fn main() {
    println!("Guess the number!");

    let secret_number = rand::thread_rng().gen_range(1, 101);

    println!("The secret number is: {}", secret_number);

    println!("Please input your guess.");

    let mut guess = String::new();

    io::stdin().read_line(&mut guess)
        .expect("Failed to read line");

    let guess: u32 = guess.trim().parse()
        .expect("Please type a number!");

    println!("You guessed: {}", guess);

    match guess.cmp(&secret_number) {
        Ordering::Less    => println!("Too small!"),
        Ordering::Greater => println!("Too big!"),
        Ordering::Equal   => println!("You win!"),
    }
}
```

è¿™ä¸¤è¡Œä»£ç æ˜¯ï¼š

```rust,ignore
let guess: u32 = guess.trim().parse()
    .expect("Please type a number!");
```

è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªå«åš`guess`çš„å˜é‡ã€‚ä¸è¿‡ç­‰ç­‰ï¼Œéš¾é“è¿™ä¸ªç¨‹åºä¸æ˜¯å·²ç»æœ‰äº†ä¸€ä¸ªå«åš`guess`çš„å˜é‡äº†å—ï¼Ÿç¡®å®å¦‚æ­¤ï¼Œä¸è¿‡ Rust å…è®¸æˆ‘ä»¬é€šè¿‡**è¦†ç›–**ï¼ˆ*shadow*ï¼‰ ç”¨ä¸€ä¸ªæ–°å€¼æ¥è¦†ç›–`guess`ä¹‹å‰çš„å€¼ã€‚è¿™ä¸ªåŠŸèƒ½ç»å¸¸ç”¨åœ¨ç±»ä¼¼éœ€è¦æŠŠä¸€ä¸ªå€¼ä»ä¸€ç§ç±»å‹è½¬æ¢åˆ°å¦ä¸€ç§ç±»å‹çš„åœºæ™¯ã€‚shadowing å…è®¸æˆ‘ä»¬å¤ç”¨`guess`å˜é‡çš„åå­—è€Œä¸æ˜¯å¼ºè¿«æˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªä¸åŒå˜é‡ï¼Œæ¯”å¦‚`guess_str`å’Œ`guess`ã€‚ï¼ˆç¬¬ä¸‰ç« ä¼šä»‹ç» shadowing çš„æ›´å¤šç»†èŠ‚ã€‚ï¼‰

`guess`è¢«ç»‘å®šåˆ°`guess.trim().parse()`è¡¨è¾¾å¼ã€‚è¡¨è¾¾å¼ä¸­çš„`guess`å¯¹åº”åŒ…å«è¾“å…¥çš„`String`ç±»å‹çš„åŸå§‹`guess`ã€‚`String`å®ä¾‹çš„`trim`æ–¹æ³•ä¼šæ¶ˆé™¤å­—ç¬¦ä¸²å¼€å¤´å’Œç»“å°¾çš„ç©ºç™½ã€‚`u32`åªèƒ½åŒ…å«æ•°å­—å­—ç¬¦ã€‚ä¸è¿‡ç”¨æˆ·å¿…é¡»è¾“å…¥å›è½¦é”®æ‰èƒ½è®©`read_line`è¿”å›ã€‚å½“ç”¨æˆ·æŒ‰ä¸‹å›è½¦é”®æ—¶ï¼Œä¼šåœ¨å­—ç¬¦ä¸²ä¸­å¢åŠ ä¸€ä¸ªæ¢è¡Œï¼ˆnewlineï¼‰å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·è¾“å…¥ 5 å¹¶å›è½¦ï¼Œ`guess`çœ‹èµ·æ¥åƒè¿™æ ·ï¼š`5\n`ã€‚`\n`ä»£è¡¨â€œæ¢è¡Œâ€ï¼Œå›è½¦é”®ã€‚`trim`æ–¹æ³•æ¶ˆé™¤`\n`ï¼Œåªç•™ä¸‹`5`ã€‚

[å­—ç¬¦ä¸²çš„`parse`æ–¹æ³•][parse]<!-- ignore -->è§£æä¸€ä¸ªå­—ç¬¦ä¸²æˆæŸä¸ªæ•°å­—ã€‚å› ä¸ºè¿™ä¸ªæ–¹æ³•å¯ä»¥è§£æå¤šç§æ•°å­—ç±»å‹ï¼Œéœ€è¦å‘Šè¯‰ Rust æˆ‘ä»¬éœ€è¦çš„å…·ä½“çš„æ•°å­—ç±»å‹ï¼Œè¿™é‡Œé€šè¿‡`let guess: u32`æŒ‡å®šã€‚`guess`åé¢çš„å†’å·ï¼ˆ`:`ï¼‰å‘Šè¯‰ Rust æˆ‘ä»¬æŒ‡æ˜äº†å˜é‡çš„ç±»å‹ã€‚Rust æœ‰ä¸€äº›å†…å»ºçš„æ•°å­—ç±»å‹ï¼›è¿™é‡Œçš„`u32`æ˜¯ä¸€ä¸ªæ— ç¬¦å·çš„ 32 ä½æ•´å‹ã€‚å®ƒæ˜¯ä¸€ä¸ªå¥½çš„è¾ƒå°æ­£æ•´æ•°çš„é»˜è®¤ç±»å‹ã€‚ç¬¬ä¸‰ç« ä¼šè®²åˆ°å…¶ä»–æ•°å­—ç±»å‹ã€‚å¦å¤–ï¼Œä¾‹å­ç¨‹åºä¸­çš„`u32`æ³¨è§£å’Œä¸`secret_number`çš„æ¯”è¾ƒæ„å‘³ç€ Rust ä¼šæ¨æ–­`secret_number`åº”è¯¥æ˜¯ä¹Ÿæ˜¯`u32`ç±»å‹ã€‚ç°åœ¨å¯ä»¥ä½¿ç”¨ç›¸åŒç±»å‹æ¯”è¾ƒä¸¤ä¸ªå€¼äº†ï¼

[parse]: ../std/primitive.str.html#method.parse

`parse`è°ƒç”¨å®¹æ˜“äº§ç”Ÿé”™è¯¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå­—ç¬¦ä¸²åŒ…å«`AğŸ‘%`ï¼Œå°±æ— æ³•å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—ã€‚å› ä¸ºå®ƒå¯èƒ½å¤±è´¥ï¼Œ`parse`æ–¹æ³•è¿”å›ä¸€ä¸ª`Result`ç±»å‹ï¼Œéå¸¸åƒä¹‹å‰åœ¨ XX é¡µâ€œä½¿ç”¨`Result`ç±»å‹æ¥å¤„ç†æ½œåœ¨çš„é”™è¯¯â€éƒ¨åˆ†è®¨è®ºçš„`read_line`æ–¹æ³•ã€‚è¿™é‡Œå†æ¬¡ç±»ä¼¼çš„ä½¿ç”¨`expect`æ–¹æ³•å¤„ç†è¿™ä¸ª`Result`ç±»å‹ã€‚å¦‚æœ`parse`å› ä¸ºä¸èƒ½ä»å­—ç¬¦ä¸²ç”Ÿæˆä¸€ä¸ªæ•°å­—è€Œè¿”å›ä¸€ä¸ª`Err`çš„`Result`æˆå‘˜æ—¶ï¼Œ`expect`ä¼šä½¿æ¸¸æˆå´©æºƒå¹¶æ‰“å°æä¾›ç»™å®ƒçš„ä¿¡æ¯ã€‚å¦‚æœ`parse`èƒ½æˆåŠŸåœ°å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—ï¼Œå®ƒä¼šè¿”å›`Result`çš„`Ok`æˆå‘˜ï¼ŒåŒæ—¶`expect`ä¼šè¿”å›`Ok`ä¸­æˆ‘ä»¬éœ€è¦çš„æ•°å­—ã€‚

ç°åœ¨è®©æˆ‘ä»¬è¿è¡Œç¨‹åºï¼

```sh
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
     Running `target/guessing_game`
Guess the number!
The secret number is: 58
Please input your guess.
  76
You guessed: 76
Too big!
```

æ¼‚äº®ï¼å³ä¾¿æ˜¯åœ¨çŒœæµ‹ä¹‹å‰æ·»åŠ äº†ç©ºæ ¼ï¼Œç¨‹åºä¾ç„¶èƒ½åˆ¤æ–­å‡ºç”¨æˆ·çŒœæµ‹äº† 76ã€‚å¤šè¿è¡Œç¨‹åºå‡ æ¬¡æ¥æ£€éªŒä¸åŒç±»å‹è¾“å…¥çš„ç›¸åº”è¡Œä¸ºï¼šçŒœä¸€ä¸ªæ­£ç¡®çš„æ•°å­—ï¼ŒçŒœä¸€ä¸ªè¿‡å¤§çš„æ•°å­—å’ŒçŒœä¸€ä¸ªè¿‡å°çš„æ•°å­—ã€‚

ç°åœ¨æ¸¸æˆå·²ç»å¤§ä½“ä¸Šèƒ½ç©äº†ï¼Œä¸è¿‡ç”¨æˆ·åªèƒ½çŒœä¸€æ¬¡ã€‚å¢åŠ ä¸€ä¸ªå¾ªç¯æ¥æ”¹å˜å®ƒå§ï¼

## ä½¿ç”¨å¾ªç¯æ¥å…è®¸å¤šæ¬¡çŒœæµ‹

`loop`å…³é”®å­—æä¾›äº†ä¸€ä¸ªæ— é™å¾ªç¯ã€‚å¢åŠ å®ƒåç»™äº†ç”¨æˆ·å¤šæ¬¡çŒœæµ‹çš„æœºä¼šï¼š

<span class="filename">Filename: src/main.rs</span>

```rust,ignore
extern crate rand;

use std::io;
use std::cmp::Ordering;
use rand::Rng;

fn main() {
    println!("Guess the number!");

    let secret_number = rand::thread_rng().gen_range(1, 101);

    println!("The secret number is: {}", secret_number);

    loop {
        println!("Please input your guess.");

        let mut guess = String::new();

        io::stdin().read_line(&mut guess)
            .expect("Failed to read line");

        let guess: u32 = guess.trim().parse()
            .expect("Please type a number!");

        println!("You guessed: {}", guess);

        match guess.cmp(&secret_number) {
            Ordering::Less    => println!("Too small!"),
            Ordering::Greater => println!("Too big!"),
            Ordering::Equal   => println!("You win!"),
        }
    }
}
```

å¦‚ä¸Šæ‰€ç¤ºï¼Œæˆ‘ä»¬å°†æç¤ºç”¨æˆ·çŒœæµ‹ä¹‹åçš„æ‰€æœ‰å†…å®¹æ”¾å…¥äº†å¾ªç¯ã€‚ç¡®ä¿è¿™äº›ä»£ç å¤šç¼©è¿›äº†å››ä¸ªç©ºæ ¼ï¼Œå¹¶å†æ¬¡è¿è¡Œç¨‹åºã€‚æ³¨æ„è¿™é‡Œæœ‰ä¸€ä¸ªæ–°é—®é¢˜ï¼Œå› ä¸ºç¨‹åºå¿ å®åœ°æ‰§è¡Œäº†æˆ‘ä»¬è¦æ±‚å®ƒåšçš„ï¼šæ°¸è¿œåœ°è¯·æ±‚å¦ä¸€ä¸ªçŒœæµ‹ï¼çœ‹èµ·æ¥ç”¨æˆ·æ²¡æ³•é€€å‡ºå•Šï¼

ç”¨æˆ·æ€»æ˜¯å¯ä»¥ä½¿ç”¨`Ctrl-C`å¿«æ·é”®æ¥ç»ˆæ­¢ç¨‹åºã€‚ä¸è¿‡è¿™é‡Œè¿˜æœ‰å¦ä¸€ä¸ªé€ƒç¦»è¿™ä¸ªè´ªå¾—æ— åŒçš„æ€ªç‰©çš„æ–¹æ³•ï¼Œå°±æ˜¯åœ¨ XX é¡µâ€œæ¯”è¾ƒçŒœæµ‹â€éƒ¨åˆ†æåˆ°çš„`parse`ï¼šå¦‚æœç”¨æˆ·è¾“å…¥ä¸€ä¸ªéæ•°å­—å›ç­”ï¼Œç¨‹åºä¼šå´©æºƒã€‚ç”¨æˆ·å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥é€€å‡ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```sh
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
     Running `target/guessing_game`
Guess the number!
The secret number is: 59
Please input your guess.
45
You guessed: 45
Too small!
Please input your guess.
60
You guessed: 60
Too big!
Please input your guess.
59
You guessed: 59
You win!
Please input your guess.
quit
thread 'main' panicked at 'Please type a number!: ParseIntError { kind: InvalidDigit }', src/libcore/result.rs:785
note: Run with `RUST_BACKTRACE=1` for a backtrace.
error: Process didn't exit successfully: `target/debug/guess` (exit code: 101)
```

è¾“å…¥`quit`å°±ä¼šé€€å‡ºç¨‹åºï¼ŒåŒæ—¶å…¶ä»–ä»»ä½•éæ•°å­—è¾“å…¥ä¹Ÿä¸€æ ·ã€‚ç„¶è€Œï¼Œæ¯«ä¸å¤¸å¼ çš„è¯´è¿™æ˜¯ä¸ç†æƒ³çš„ã€‚æˆ‘ä»¬æƒ³è¦å½“çŒœæµ‹æ­£ç¡®çš„æ•°å­—æ—¶æ¸¸æˆèƒ½è‡ªåŠ¨é€€å‡ºã€‚

### çŒœæµ‹æ­£ç¡®åé€€å‡º

è®©æˆ‘ä»¬å¢åŠ ä¸€ä¸ª`break`æ¥åœ¨ç”¨æˆ·èƒœåˆ©æ—¶é€€å‡ºæ¸¸æˆï¼š

<span class="filename">Filename: src/main.rs</span>

```rust,ignore
extern crate rand;

use std::io;
use std::cmp::Ordering;
use rand::Rng;

fn main() {
    println!("Guess the number!");

    let secret_number = rand::thread_rng().gen_range(1, 101);

    println!("The secret number is: {}", secret_number);

    loop {
        println!("Please input your guess.");

        let mut guess = String::new();

        io::stdin().read_line(&mut guess)
            .expect("Failed to read line");

        let guess: u32 = guess.trim().parse()
            .expect("Please type a number!");

        println!("You guessed: {}", guess);

        match guess.cmp(&secret_number) {
            Ordering::Less    => println!("Too small!"),
            Ordering::Greater => println!("Too big!"),
            Ordering::Equal   => {
                println!("You win!");
                break;
            }
        }
    }
}
```

é€šè¿‡åœ¨`You win!`ä¹‹åå¢åŠ ä¸€è¡Œ`break`ï¼Œç¨‹åºåœ¨ç”¨æˆ·çŒœå¯¹äº†ç¥ç§˜æ•°å­—åä¼šé€€å‡ºå¾ªç¯ã€‚é€€å‡ºå¾ªç¯ä¹Ÿå°±æ„å‘³ç€é€€å‡ºç¨‹åºï¼Œå› ä¸ºå¾ªç¯æ˜¯`main`çš„æœ€åä¸€éƒ¨åˆ†ã€‚

### å¤„ç†æ— æ•ˆè¾“å…¥

ä¸ºäº†è¿›ä¸€æ­¥æ”¹å–„æ¸¸æˆæ€§ï¼Œè€Œä¸æ˜¯åœ¨ç”¨æˆ·è¾“å…¥éæ•°å­—æ—¶å´©æºƒï¼Œéœ€è¦è®©æ¸¸æˆå¿½ç•¥éæ•°å­—ä»è€Œç”¨æˆ·å¯ä»¥ç»§ç»­çŒœæµ‹ã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹`guess`ä»`String`è½¬åŒ–ä¸º`u32`é‚£éƒ¨åˆ†ä»£ç æ¥å®ç°ï¼š

```rust,ignore
let guess: u32 = match guess.trim().parse() {
    Ok(num) => num,
    Err(_) => continue,
};
```

ä»`expect`è°ƒç”¨åˆ‡æ¢åˆ°`expect`è¯­å¥æ˜¯å¦‚ä½•ä»é‡åˆ°é”™è¯¯å°±å´©æºƒåˆ°çœŸæ­£å¤„ç†é”™è¯¯çš„å¸¸ç”¨æ‰‹æ®µã€‚è®°ä½`parse`è¿”å›ä¸€ä¸ª`Result`ç±»å‹ï¼Œè€Œ`Result`æ˜¯ä¸€ä¸ªæ‹¥æœ‰`Ok`æˆ–`Err`ä¸¤ä¸ªæˆå‘˜çš„æšä¸¾ã€‚åœ¨è¿™é‡Œä½¿ç”¨`match`è¡¨è¾¾å¼ï¼Œå°±åƒä¹‹å‰å¤„ç†`cmp`æ–¹æ³•è¿”å›çš„`Ordering`ä¸€æ ·ã€‚

å¦‚æœ`parse`èƒ½å¤ŸæˆåŠŸçš„å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªåŒ…å«ç»“æœæ•°å­—`Ok`å€¼ã€‚è¿™ä¸ª`Ok`å€¼ä¼šåŒ¹é…ç¬¬ä¸€ä¸ªåˆ†æ”¯çš„æ¨¡å¼ï¼Œè¿™æ—¶`match`è¡¨è¾¾å¼ä»…ä»…è¿”å›`parse`äº§ç”Ÿçš„`Ok`å€¼ä¹‹ä¸­çš„`num`å€¼ã€‚è¿™ä¸ªæ•°å­—ä¼šæœ€ç»ˆå¦‚æœŸå˜æˆæ–°åˆ›å»ºçš„`guess`å˜é‡ã€‚

å¦‚æœ`parse`*ä¸*èƒ½å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªåŒ…å«æ›´å¤šé”™è¯¯ä¿¡æ¯çš„`Err`å€¼ã€‚`Err`å€¼ä¸èƒ½åŒ¹é…ç¬¬ä¸€ä¸ª`match`åˆ†æ”¯çš„`Ok(num)`æ¨¡å¼ï¼Œä½†æ˜¯ä¼šåŒ¹é…ç¬¬äºŒä¸ªåˆ†æ”¯çš„`Err(_)`æ¨¡å¼ã€‚`_`æ˜¯ä¸€ä¸ªåŒ…ç½—ä¸‡è±¡çš„å€¼ï¼›åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æƒ³è¦åŒ¹é…æ‰€æœ‰`Err`å€¼ï¼Œä¸ç®¡å…¶ä¸­æœ‰ä½•ç§ä¿¡æ¯ã€‚æ‰€ä»¥ç¨‹åºä¼šæ‰§è¡Œç¬¬äºŒä¸ªåˆ†æ”¯çš„ä»£ç ï¼Œ`continue`ï¼Œè¿™æ„å‘³ç€è¿›å…¥`loop`çš„ä¸‹ä¸€æ¬¡å¾ªç¯å¹¶è¯·æ±‚å¦ä¸€ä¸ªçŒœæµ‹ã€‚è¿™æ ·ç¨‹åºå°±æœ‰æ•ˆåœ°å¿½ç•¥äº†`parse`å¯èƒ½é‡åˆ°çš„æ‰€æœ‰é”™è¯¯ï¼

ç°åœ¨ä¸‡äº‹ä¿±å¤‡ï¼ˆåªæ¬ ä¸œé£ï¼‰äº†ã€‚è¿è¡Œ`cargo run`æ¥å°è¯•ä¸€ä¸‹ï¼š

```sh
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
     Running `target/guessing_game`
Guess the number!
The secret number is: 61
Please input your guess.
10
You guessed: 10
Too small!
Please input your guess.
99
You guessed: 99
Too big!
Please input your guess.
foo
Please input your guess.
61
You guessed: 61
You win!
```

å¤ªæ£’äº†ï¼å†æœ‰æœ€åä¸€ä¸ªå°çš„ä¿®æ”¹ï¼Œå°±èƒ½å®ŒæˆçŒœçŒœçœ‹æ¸¸æˆäº†ï¼šè¿˜è®°å¾—ç¨‹åºä¾ç„¶ä¼šæ‰“å°å‡ºç§˜å¯†æ•°å­—ã€‚è¿™åœ¨æµ‹è¯•æ—¶è¿˜å¥½ï¼Œä½†ä¼šæ¯äº†æ¸¸æˆæ€§ã€‚åˆ æ‰æ‰“å°ç§˜å¯†æ•°å­—çš„`println!`ã€‚åˆ—è¡¨ 2-5 ä¸ºæœ€ç»ˆä»£ç ï¼š

<figure>
<span class="filename">Filename: src/main.rs</span>

```rust,ignore
extern crate rand;

use std::io;
use std::cmp::Ordering;
use rand::Rng;

fn main() {
    println!("Guess the number!");

    let secret_number = rand::thread_rng().gen_range(1, 101);

    loop {
        println!("Please input your guess.");

        let mut guess = String::new();

        io::stdin().read_line(&mut guess)
            .expect("Failed to read line");

        let guess: u32 = match guess.trim().parse() {
            Ok(num) => num,
            Err(_) => continue,
        };

        println!("You guessed: {}", guess);

        match guess.cmp(&secret_number) {
            Ordering::Less    => println!("Too small!"),
            Ordering::Greater => println!("Too big!"),
            Ordering::Equal   => {
                println!("You win!");
                break;
            }
        }
    }
}
```

<figcaption>

Listing 2-5: Complete code of the guessing game

</figcaption>
</figure>

## æ€»ç»“ä¸€ä¸‹ï¼Œ

æ­¤æ—¶æ­¤åˆ»ï¼Œä½ é¡ºåˆ©å®Œæˆäº†çŒœçŒœçœ‹æ¸¸æˆï¼æ­å–œï¼

è¿™æ˜¯ä¸€ä¸ªé€šè¿‡åŠ¨æ‰‹å®è·µçš„æ–¹å¼æƒ³ä½ ä»‹ç»è®¸å¤š Rust æ–°çŸ¥è¯†çš„é¡¹ç›®ï¼š`let`ã€`match`ã€æ–¹æ³•ã€å…³è”å‡½æ•°ï¼Œä½¿ç”¨å¤–éƒ¨ crateï¼Œç­‰ç­‰ã€‚æ¥ä¸‹æ¥çš„å‡ ç« ï¼Œæˆ‘ä»¬å°†ä¼šè¯¦ç»†å­¦ä¹ è¿™äº›æ¦‚å¿µã€‚ç¬¬ä¸‰ç« æ¶‰åŠåˆ°å¤§éƒ¨åˆ†ç¼–ç¨‹è¯­è¨€éƒ½æœ‰çš„æ¦‚å¿µï¼Œæ¯”å¦‚å˜é‡ã€æ•°æ®ç±»å‹å’Œå‡½æ•°ï¼Œä»¥åŠå¦‚ä½•åœ¨ Rust ä¸­ä½¿ç”¨ä»–ä»¬ã€‚ç¬¬å››ç« æ¢ç´¢æ‰€æœ‰æƒï¼ˆownershipï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ª Rust åŒå…¶ä»–è¯­è¨€éƒ½ä¸ç›¸åŒçš„åŠŸèƒ½ã€‚ç¬¬äº”ç« è®¨è®ºç»“æ„ä½“å’Œæ–¹æ³•è¯­æ³•ï¼Œè€Œç¬¬å…­ç« ä¾§é‡è§£é‡Šæšä¸¾ã€‚