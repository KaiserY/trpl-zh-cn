# ç¼–å†™ çŒœçŒœçœ‹ æ¸¸æˆ

> [ch02-00-guessing-game-tutorial.md](https://github.com/rust-lang/book/blob/master/src/ch02-00-guessing-game-tutorial.md)
> <br>
> commit c427a676393d001edc82f1a54a3b8026abcf9690

è®©æˆ‘ä»¬ä¸€èµ·åŠ¨æ‰‹å®Œæˆä¸€ä¸ªé¡¹ç›®ï¼Œæ¥å¿«é€Ÿä¸Šæ‰‹ Rustï¼æœ¬ç« å°†ä»‹ç» Rust ä¸­ä¸€äº›å¸¸ç”¨æ¦‚å¿µï¼Œå¹¶é€šè¿‡çœŸå®çš„ç¨‹åºæ¥å±•ç¤ºå¦‚ä½•è¿ç”¨å®ƒä»¬ã€‚ä½ å°†ä¼šå­¦åˆ° `let`ã€`match`ã€æ–¹æ³•ã€å…³è”å‡½æ•°ã€å¤–éƒ¨ crate ç­‰çŸ¥è¯†ï¼åç»­ç« èŠ‚ä¼šæ·±å…¥æ¢è®¨è¿™äº›æ¦‚å¿µçš„ç»†èŠ‚ã€‚åœ¨è¿™ä¸€ç« ï¼Œæˆ‘ä»¬å°†åšåŸºç¡€ç»ƒä¹ ã€‚

æˆ‘ä»¬ä¼šå®ç°ä¸€ä¸ªç»å…¸çš„æ–°æ‰‹ç¼–ç¨‹é—®é¢˜ï¼šçŒœçŒœçœ‹æ¸¸æˆã€‚å®ƒæ˜¯è¿™ä¹ˆå·¥ä½œçš„ï¼šç¨‹åºå°†ä¼šéšæœºç”Ÿæˆä¸€ä¸ª 1 åˆ° 100 ä¹‹é—´çš„éšæœºæ•´æ•°ã€‚æ¥ç€å®ƒä¼šè¯·ç©å®¶çŒœä¸€ä¸ªæ•°å¹¶è¾“å…¥ï¼Œç„¶åæç¤ºçŒœæµ‹æ˜¯å¤§äº†è¿˜æ˜¯å°äº†ã€‚å¦‚æœçŒœå¯¹äº†ï¼Œå®ƒä¼šæ‰“å°ç¥è´ºä¿¡æ¯å¹¶é€€å‡ºã€‚

## å‡†å¤‡ä¸€ä¸ªæ–°é¡¹ç›®

è¦åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼Œè¿›å…¥ç¬¬ä¸€ç« ä¸­åˆ›å»ºçš„ *projects* ç›®å½•ï¼Œä½¿ç”¨ Cargo æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå¦‚ä¸‹ï¼š

```text
$ cargo new guessing_game
$ cd guessing_game
```

ç¬¬ä¸€ä¸ªå‘½ä»¤ï¼Œ`cargo new`ï¼Œå®ƒè·å–é¡¹ç›®çš„åç§°ï¼ˆ`guessing_game`ï¼‰ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚ç¬¬äºŒä¸ªå‘½ä»¤è¿›å…¥åˆ°æ–°åˆ›å»ºçš„é¡¹ç›®ç›®å½•ã€‚

çœ‹çœ‹ç”Ÿæˆçš„ *Cargo.toml* æ–‡ä»¶ï¼š

<span class="filename">æ–‡ä»¶å: Cargo.toml</span>

```toml
[package]
name = "guessing_game"
version = "0.1.0"
authors = ["Your Name <you@example.com>"]
edition = "2018"

[dependencies]
```

å¦‚æœ Cargo ä»ç¯å¢ƒä¸­è·å–çš„å¼€å‘è€…ä¿¡æ¯ä¸æ­£ç¡®ï¼Œä¿®æ”¹è¿™ä¸ªæ–‡ä»¶å¹¶å†æ¬¡ä¿å­˜ã€‚

æ­£å¦‚ç¬¬ä¸€ç« é‚£æ ·ï¼Œ`cargo new` ç”Ÿæˆäº†ä¸€ä¸ª â€œHello, world!â€ ç¨‹åºã€‚æŸ¥çœ‹ *src/main.rs* æ–‡ä»¶ï¼š

<span class="filename">æ–‡ä»¶å: src/main.rs</span>

```rust
fn main() {
    println!("Hello, world!");
}
```

ç°åœ¨ä½¿ç”¨ `cargo run` å‘½ä»¤ï¼Œä¸€æ­¥å®Œæˆ â€œHello, world!â€ ç¨‹åºçš„ç¼–è¯‘å’Œè¿è¡Œï¼š

```text
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 1.50 secs
     Running `target/debug/guessing_game`
Hello, world!
```

å½“ä½ éœ€è¦åœ¨é¡¹ç›®ä¸­å¿«é€Ÿè¿­ä»£æ—¶ï¼Œ`run` å‘½ä»¤å°±èƒ½æ´¾ä¸Šç”¨åœºï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨è¿™ä¸ªæ¸¸æˆé¡¹ç›®ä¸­åšçš„ï¼Œåœ¨ä¸‹ä¸€æ¬¡è¿­ä»£ä¹‹å‰å¿«é€Ÿæµ‹è¯•æ¯ä¸€æ¬¡è¿­ä»£ã€‚

é‡æ–°æ‰“å¼€ *src/main.rs* æ–‡ä»¶ã€‚æˆ‘ä»¬å°†ä¼šåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ç¼–å†™å…¨éƒ¨çš„ä»£ç ã€‚

## å¤„ç†ä¸€æ¬¡çŒœæµ‹

çŒœçŒœçœ‹ç¨‹åºçš„ç¬¬ä¸€éƒ¨åˆ†è¯·æ±‚å’Œå¤„ç†ç”¨æˆ·è¾“å…¥ï¼Œå¹¶æ£€æŸ¥è¾“å…¥æ˜¯å¦ç¬¦åˆé¢„æœŸçš„æ ¼å¼ã€‚é¦–å…ˆï¼Œå…è®¸ç©å®¶è¾“å…¥çŒœæµ‹ã€‚åœ¨ *src/main.rs* ä¸­è¾“å…¥ç¤ºä¾‹ 2-1 ä¸­çš„ä»£ç ã€‚

<span class="filename">æ–‡ä»¶å: src/main.rs</span>

```rust,ignore
use std::io;

fn main() {
    println!("Guess the number!");

    println!("Please input your guess.");

    let mut guess = String::new();

    io::stdin().read_line(&mut guess)
        .expect("Failed to read line");

    println!("You guessed: {}", guess);
}
```

<span class="caption">ç¤ºä¾‹ 2-1ï¼šè·å–ç”¨æˆ·çŒœæµ‹å¹¶æ‰“å°çš„ä»£ç </span>

è¿™äº›ä»£ç åŒ…å«å¾ˆå¤šä¿¡æ¯ï¼Œæˆ‘ä»¬ä¸€è¡Œä¸€è¡Œåœ°è¿‡ä¸€éã€‚ä¸ºäº†è·å–ç”¨æˆ·è¾“å…¥å¹¶æ‰“å°ç»“æœä½œä¸ºè¾“å‡ºï¼Œæˆ‘ä»¬éœ€è¦å°† `io`ï¼ˆè¾“å…¥/è¾“å‡ºï¼‰åº“å¼•å…¥å½“å‰ä½œç”¨åŸŸã€‚`io` åº“æ¥è‡ªäºæ ‡å‡†åº“ï¼ˆä¹Ÿè¢«ç§°ä¸º `std`ï¼‰ï¼š

```rust,ignore
use std::io;
```

é»˜è®¤æƒ…å†µä¸‹ï¼ŒRust å°† [*prelude*][prelude]<!-- ignore --> æ¨¡å—ä¸­å°‘é‡çš„ç±»å‹å¼•å…¥åˆ°æ¯ä¸ªç¨‹åºçš„ä½œç”¨åŸŸä¸­ã€‚å¦‚æœéœ€è¦çš„ç±»å‹ä¸åœ¨ prelude ä¸­ï¼Œä½ å¿…é¡»ä½¿ç”¨ `use` è¯­å¥æ˜¾å¼åœ°å°†å…¶å¼•å…¥ä½œç”¨åŸŸã€‚`std::io` åº“æä¾›å¾ˆå¤šæœ‰ç”¨çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ¥æ”¶ç”¨æˆ·è¾“å…¥çš„åŠŸèƒ½ã€‚

[prelude]: https://doc.rust-lang.org/std/prelude/index.html

å¦‚ç¬¬ä¸€ç« æ‰€æåŠï¼Œ`main` å‡½æ•°æ˜¯ç¨‹åºçš„å…¥å£ç‚¹ï¼š

```rust,ignore
fn main() {
```

`fn` è¯­æ³•å£°æ˜äº†ä¸€ä¸ªæ–°å‡½æ•°ï¼Œ`()` è¡¨æ˜æ²¡æœ‰å‚æ•°ï¼Œ`{` ä½œä¸ºå‡½æ•°ä½“çš„å¼€å§‹ã€‚

ç¬¬ä¸€ç« ä¹ŸæåŠäº† `println!` æ˜¯ä¸€ä¸ªåœ¨å±å¹•ä¸Šæ‰“å°å­—ç¬¦ä¸²çš„å®ï¼š

```rust,ignore
println!("Guess the number!");

println!("Please input your guess.");
```

è¿™äº›ä»£ç ä»…ä»…æ‰“å°æç¤ºï¼Œä»‹ç»æ¸¸æˆçš„å†…å®¹ç„¶åè¯·æ±‚ç”¨æˆ·è¾“å…¥ã€‚

### ä½¿ç”¨å˜é‡å‚¨å­˜å€¼

æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ªå‚¨å­˜ç”¨æˆ·è¾“å…¥çš„åœ°æ–¹ï¼Œåƒè¿™æ ·ï¼š

```rust,ignore
let mut guess = String::new();
```

ç°åœ¨ç¨‹åºå¼€å§‹å˜å¾—æœ‰æ„æ€äº†ï¼è¿™ä¸€å°è¡Œä»£ç å‘ç”Ÿäº†å¾ˆå¤šäº‹ã€‚æ³¨æ„è¿™æ˜¯ä¸€ä¸ª `let` è¯­å¥ï¼Œç”¨æ¥åˆ›å»º **å˜é‡**ï¼ˆ*variable*ï¼‰ã€‚è¿™é‡Œæ˜¯å¦å¤–ä¸€ä¸ªä¾‹å­ï¼š

```rust,ignore
let foo = bar;
```

è¿™è¡Œä»£ç æ–°å»ºäº†ä¸€ä¸ªå«åš `foo` çš„å˜é‡å¹¶æŠŠå®ƒç»‘å®šåˆ°å€¼ `bar` ä¸Šã€‚åœ¨ Rust ä¸­ï¼Œå˜é‡é»˜è®¤æ˜¯ä¸å¯å˜çš„ã€‚æˆ‘ä»¬å°†ä¼šåœ¨ç¬¬ä¸‰ç« çš„ [â€œå˜é‡ä¸å¯å˜æ€§â€][variables-and-mutability] éƒ¨åˆ†è¯¦ç»†è®¨è®ºè¿™ä¸ªæ¦‚å¿µã€‚ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨å˜é‡åå‰ä½¿ç”¨ `mut` æ¥ä½¿ä¸€ä¸ªå˜é‡å¯å˜ï¼š

```rust,ignore
let foo = 5; // ä¸å¯å˜
let mut bar = 5; // å¯å˜
```

> æ³¨æ„ï¼š`//` è¯­æ³•å¼€å§‹ä¸€ä¸ªæ³¨é‡Šï¼ŒæŒç»­åˆ°è¡Œå°¾ã€‚Rust å¿½ç•¥æ³¨é‡Šä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œç¬¬ä¸‰ç« å°†ä¼šè¯¦ç»†ä»‹ç»æ³¨é‡Šã€‚

è®©æˆ‘ä»¬å›åˆ°çŒœçŒœçœ‹ç¨‹åºä¸­ã€‚ç°åœ¨æˆ‘ä»¬çŸ¥é“äº† `let mut guess` ä¼šå¼•å…¥ä¸€ä¸ªå«åš `guess` çš„å¯å˜å˜é‡ã€‚ç­‰å·ï¼ˆ`=`ï¼‰çš„å³è¾¹æ˜¯ `guess` æ‰€ç»‘å®šçš„å€¼ï¼Œå®ƒæ˜¯ `String::new` çš„ç»“æœï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¿”å›ä¸€ä¸ª `String` çš„æ–°å®ä¾‹ã€‚[`String`][string]<!-- ignore --> æ˜¯ä¸€ä¸ªæ ‡å‡†åº“æä¾›çš„å­—ç¬¦ä¸²ç±»å‹ï¼Œå®ƒæ˜¯ UTF-8 ç¼–ç çš„å¯å¢é•¿æ–‡æœ¬å—ã€‚

[string]: https://doc.rust-lang.org/std/string/struct.String.html

`::new` é‚£ä¸€è¡Œçš„ `::` è¯­æ³•è¡¨æ˜ `new` æ˜¯ `String` ç±»å‹çš„ä¸€ä¸ª **å…³è”å‡½æ•°**ï¼ˆ*associated function*ï¼‰ã€‚å…³è”å‡½æ•°æ˜¯é’ˆå¯¹ç±»å‹å®ç°çš„ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ `String`ï¼Œè€Œä¸æ˜¯ `String` çš„æŸä¸ªç‰¹å®šå®ä¾‹ã€‚ä¸€äº›è¯­è¨€ä¸­æŠŠå®ƒç§°ä¸º **é™æ€æ–¹æ³•**ï¼ˆ*static method*ï¼‰ã€‚

`new` å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç©ºå­—ç¬¦ä¸²ï¼Œä½ ä¼šå‘ç°å¾ˆå¤šç±»å‹ä¸Šæœ‰ `new` å‡½æ•°ï¼Œå› ä¸ºå®ƒæ˜¯åˆ›å»ºç±»å‹å®ä¾‹çš„æƒ¯ç”¨å‡½æ•°åã€‚

æ€»ç»“ä¸€ä¸‹ï¼Œ`let mut guess = String::new();` è¿™ä¸€è¡Œåˆ›å»ºäº†ä¸€ä¸ªå¯å˜å˜é‡ï¼Œå½“å‰å®ƒç»‘å®šåˆ°ä¸€ä¸ªæ–°çš„ `String` ç©ºå®ä¾‹ä¸Šã€‚

å›å¿†ä¸€ä¸‹ï¼Œæˆ‘ä»¬åœ¨ç¨‹åºçš„ç¬¬ä¸€è¡Œä½¿ç”¨ `use std::io;` ä»æ ‡å‡†åº“ä¸­å¼•å…¥äº†è¾“å…¥/è¾“å‡ºåŠŸèƒ½ã€‚ç°åœ¨è°ƒç”¨ `io` çš„å…³è”å‡½æ•° `stdin`ï¼š

```rust,ignore
io::stdin().read_line(&mut guess)
    .expect("Failed to read line");
```

å¦‚æœç¨‹åºçš„å¼€å¤´æ²¡æœ‰ `use std::io` è¿™ä¸€è¡Œï¼Œå¯ä»¥æŠŠå‡½æ•°è°ƒç”¨å†™æˆ `std::io::stdin`ã€‚`stdin` å‡½æ•°è¿”å›ä¸€ä¸ª [`std::io::Stdin`][iostdin]<!-- ignore --> çš„å®ä¾‹ï¼Œè¿™ä»£è¡¨ç»ˆç«¯æ ‡å‡†è¾“å…¥å¥æŸ„çš„ç±»å‹ã€‚

[iostdin]: https://doc.rust-lang.org/std/io/struct.Stdin.html

ä»£ç çš„ä¸‹ä¸€éƒ¨åˆ†ï¼Œ`.read_line(&mut guess)`ï¼Œè°ƒç”¨ [`read_line`][read_line]<!-- ignore --> æ–¹æ³•ä»æ ‡å‡†è¾“å…¥å¥æŸ„è·å–ç”¨æˆ·è¾“å…¥ã€‚æˆ‘ä»¬è¿˜å‘ `read_line()` ä¼ é€’äº†ä¸€ä¸ªå‚æ•°ï¼š`&mut guess`ã€‚

[read_line]: https://doc.rust-lang.org/std/io/struct.Stdin.html#method.read_line

`read_line` çš„å·¥ä½œæ˜¯ï¼Œæ— è®ºç”¨æˆ·åœ¨æ ‡å‡†è¾“å…¥ä¸­é”®å…¥ä»€ä¹ˆå†…å®¹ï¼Œéƒ½å°†å…¶å­˜å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œå› æ­¤å®ƒéœ€è¦å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ã€‚è¿™ä¸ªå­—ç¬¦ä¸²å‚æ•°åº”è¯¥æ˜¯å¯å˜çš„ï¼Œä»¥ä¾¿ `read_line` å°†ç”¨æˆ·è¾“å…¥é™„åŠ ä¸Šå»ã€‚

`&` è¡¨ç¤ºè¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª **å¼•ç”¨**ï¼ˆ*reference*ï¼‰ï¼Œå®ƒå…è®¸å¤šå¤„ä»£ç è®¿é—®åŒä¸€å¤„æ•°æ®ï¼Œè€Œæ— éœ€åœ¨å†…å­˜ä¸­å¤šæ¬¡æ‹·è´ã€‚å¼•ç”¨æ˜¯ä¸€ä¸ªå¤æ‚çš„ç‰¹æ€§ï¼ŒRust çš„ä¸€ä¸ªä¸»è¦ä¼˜åŠ¿å°±æ˜¯å®‰å…¨è€Œç®€å•çš„æ“çºµå¼•ç”¨ã€‚å®Œæˆå½“å‰ç¨‹åºå¹¶ä¸éœ€è¦äº†è§£å¦‚æ­¤å¤šç»†èŠ‚ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬åªéœ€çŸ¥é“å®ƒåƒå˜é‡ä¸€æ ·ï¼Œé»˜è®¤æ˜¯ä¸å¯å˜çš„ã€‚å› æ­¤ï¼Œéœ€è¦å†™æˆ `&mut guess` æ¥ä½¿å…¶å¯å˜ï¼Œè€Œä¸æ˜¯ `&guess`ã€‚ï¼ˆç¬¬å››ç« ä¼šæ›´å…¨é¢çš„è§£é‡Šå¼•ç”¨ã€‚ï¼‰

### ä½¿ç”¨ `Result` ç±»å‹æ¥å¤„ç†æ½œåœ¨çš„é”™è¯¯

æˆ‘ä»¬è¿˜æ²¡æœ‰å®Œå…¨åˆ†æå®Œè¿™è¡Œä»£ç ã€‚è™½ç„¶è¿™æ˜¯å•ç‹¬ä¸€è¡Œä»£ç ï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªé€»è¾‘è¡Œï¼ˆè™½ç„¶æ¢è¡Œäº†ä½†ä»æ˜¯ä¸€ä¸ªè¯­å¥ï¼‰çš„ç¬¬ä¸€éƒ¨åˆ†ã€‚ç¬¬äºŒéƒ¨åˆ†æ˜¯è¿™ä¸ªæ–¹æ³•ï¼š

```rust,ignore
.expect("Failed to read line");
```

å½“ä½¿ç”¨ `.foo()` è¯­æ³•è°ƒç”¨æ–¹æ³•æ—¶ï¼Œé€šè¿‡æ¢è¡ŒåŠ ç¼©è¿›æ¥æŠŠé•¿è¡Œæ‹†å¼€æ˜¯æ˜æ™ºçš„ã€‚æˆ‘ä»¬å®Œå…¨å¯ä»¥è¿™æ ·å†™ï¼š

```rust,ignore
io::stdin().read_line(&mut guess).expect("Failed to read line");
```

ä¸è¿‡ï¼Œè¿‡é•¿çš„è¡Œéš¾ä»¥é˜…è¯»ï¼Œæ‰€ä»¥æœ€å¥½æ‹†å¼€æ¥å†™ï¼Œä¸¤ä¸ªæ–¹æ³•è°ƒç”¨å ä¸¤è¡Œã€‚ç°åœ¨æ¥çœ‹çœ‹è¿™è¡Œä»£ç å¹²äº†ä»€ä¹ˆã€‚

ä¹‹å‰æåˆ°äº† `read_line` å°†ç”¨æˆ·è¾“å…¥é™„åŠ åˆ°ä¼ é€’ç»™å®ƒçš„å­—ç¬¦ä¸²ä¸­ï¼Œä¸è¿‡å®ƒä¹Ÿè¿”å›ä¸€ä¸ªå€¼â€”â€”åœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ [`io::Result`][ioresult]<!-- ignore -->ã€‚Rust æ ‡å‡†åº“ä¸­æœ‰å¾ˆå¤šå«åš `Result` çš„ç±»å‹ã€‚ä¸€ä¸ª [`Result`][result]<!-- ignore --> æ³›å‹ä»¥åŠå¯¹åº”å­æ¨¡å—çš„ç‰¹å®šç‰ˆæœ¬ï¼Œæ¯”å¦‚ `io::Result`ã€‚

[ioresult]: https://doc.rust-lang.org/std/io/type.Result.html
[result]: https://doc.rust-lang.org/std/result/enum.Result.html

`Result` ç±»å‹æ˜¯ [*æšä¸¾*ï¼ˆ*enumerations*ï¼‰][enums]<!-- ignore -->ï¼Œé€šå¸¸ä¹Ÿå†™ä½œ *enums*ã€‚æšä¸¾ç±»å‹æŒæœ‰å›ºå®šé›†åˆçš„å€¼ï¼Œè¿™äº›å€¼è¢«ç§°ä¸ºæšä¸¾çš„ **æˆå‘˜**ï¼ˆ*variants*ï¼‰ã€‚ç¬¬å…­ç« å°†ä»‹ç»æšä¸¾çš„æ›´å¤šç»†èŠ‚ã€‚

[enums]: ch06-00-enums.html

`Result` çš„æˆå‘˜æ˜¯ `Ok` å’Œ `Err`ï¼Œ`Ok` æˆå‘˜è¡¨ç¤ºæ“ä½œæˆåŠŸï¼Œå†…éƒ¨åŒ…å«æˆåŠŸæ—¶äº§ç”Ÿçš„å€¼ã€‚`Err` æˆå‘˜åˆ™æ„å‘³ç€æ“ä½œå¤±è´¥ï¼Œå¹¶ä¸”åŒ…å«å¤±è´¥çš„å‰å› åæœã€‚

è¿™äº› `Result` ç±»å‹çš„ä½œç”¨æ˜¯ç¼–ç é”™è¯¯å¤„ç†ä¿¡æ¯ã€‚`Result` ç±»å‹çš„å€¼ï¼Œåƒå…¶ä»–ç±»å‹ä¸€æ ·ï¼Œæ‹¥æœ‰å®šä¹‰äºå…¶ä¸Šçš„æ–¹æ³•ã€‚`io::Result` çš„å®ä¾‹æ‹¥æœ‰ [`expect` æ–¹æ³•][expect]<!-- ignore -->ã€‚å¦‚æœ `io::Result` å®ä¾‹çš„å€¼æ˜¯ `Err`ï¼Œ`expect` ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼Œå¹¶æ˜¾ç¤ºå½“åšå‚æ•°ä¼ é€’ç»™ `expect` çš„ä¿¡æ¯ã€‚å¦‚æœ `read_line` æ–¹æ³•è¿”å› `Err`ï¼Œåˆ™å¯èƒ½æ˜¯æ¥æºäºåº•å±‚æ“ä½œç³»ç»Ÿé”™è¯¯çš„ç»“æœã€‚å¦‚æœ `io::Result` å®ä¾‹çš„å€¼æ˜¯ `Ok`ï¼Œ`expect` ä¼šè·å– `Ok` ä¸­çš„å€¼å¹¶åŸæ ·è¿”å›ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè¿™ä¸ªå€¼æ˜¯ç”¨æˆ·è¾“å…¥åˆ°æ ‡å‡†è¾“å…¥ä¸­çš„å­—èŠ‚æ•°ã€‚

[expect]: https://doc.rust-lang.org/std/result/enum.Result.html#method.expect

å¦‚æœä¸è°ƒç”¨ `expect`ï¼Œç¨‹åºä¹Ÿèƒ½ç¼–è¯‘ï¼Œä¸è¿‡ä¼šå‡ºç°ä¸€ä¸ªè­¦å‘Šï¼š

```text
$ cargo build
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
warning: unused `std::result::Result` which must be used
  --> src/main.rs:10:5
   |
10 |     io::stdin().read_line(&mut guess);
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
   = note: #[warn(unused_must_use)] on by default
```

Rust è­¦å‘Šæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ `read_line` çš„è¿”å›å€¼ `Result`ï¼Œè¯´æ˜æœ‰ä¸€ä¸ªå¯èƒ½çš„é”™è¯¯æ²¡æœ‰å¤„ç†ã€‚

æ¶ˆé™¤è­¦å‘Šçš„æ­£ç¡®åšæ³•æ˜¯å®é™…ç¼–å†™é”™è¯¯å¤„ç†ä»£ç ï¼Œä¸è¿‡ç”±äºæˆ‘ä»¬å°±æ˜¯å¸Œæœ›ç¨‹åºåœ¨å‡ºç°é—®é¢˜æ—¶ç«‹å³å´©æºƒï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨ `expect`ã€‚ç¬¬ä¹ç« ä¼šå­¦ä¹ å¦‚ä½•ä»é”™è¯¯ä¸­æ¢å¤ã€‚

### ä½¿ç”¨ `println!` å ä½ç¬¦æ‰“å°å€¼

é™¤äº†ä½äºç»“å°¾çš„å¤§æ‹¬å·ï¼Œç›®å‰ä¸ºæ­¢å°±åªæœ‰è¿™ä¸€è¡Œä»£ç å€¼å¾—è®¨è®ºä¸€ä¸‹äº†ï¼Œå°±æ˜¯è¿™ä¸€è¡Œï¼š

```rust,ignore
println!("You guessed: {}", guess);
```

è¿™è¡Œä»£ç æ‰“å°å­˜å‚¨ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œé‡Œé¢çš„ `{}` æ˜¯é¢„ç•™åœ¨ç‰¹å®šä½ç½®çš„å ä½ç¬¦ã€‚ä½¿ç”¨ `{}` ä¹Ÿå¯ä»¥æ‰“å°å¤šä¸ªå€¼ï¼šç¬¬ä¸€å¯¹ `{}` ä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¹‹åçš„ç¬¬ä¸€ä¸ªå€¼ï¼Œç¬¬äºŒå¯¹åˆ™ä½¿ç”¨ç¬¬äºŒä¸ªå€¼ï¼Œä¾æ­¤ç±»æ¨ã€‚è°ƒç”¨ä¸€æ¬¡ `println!` æ‰“å°å¤šä¸ªå€¼çœ‹èµ·æ¥åƒè¿™æ ·ï¼š

```rust
let x = 5;
let y = 10;

println!("x = {} and y = {}", x, y);
```

è¿™è¡Œä»£ç ä¼šæ‰“å°å‡º `x = 5 and y = 10`ã€‚

### æµ‹è¯•ç¬¬ä¸€éƒ¨åˆ†ä»£ç 

è®©æˆ‘ä»¬æ¥æµ‹è¯•ä¸‹çŒœçŒœçœ‹æ¸¸æˆçš„ç¬¬ä¸€éƒ¨åˆ†ã€‚ä½¿ç”¨ `cargo run` è¿è¡Œï¼š

```text
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 2.53 secs
     Running `target/debug/guessing_game`
Guess the number!
Please input your guess.
6
You guessed: 6
```

è‡³æ­¤ä¸ºæ­¢ï¼Œæ¸¸æˆçš„ç¬¬ä¸€éƒ¨åˆ†å·²ç»å®Œæˆï¼šæˆ‘ä»¬ä»é”®ç›˜è·å–è¾“å…¥å¹¶æ‰“å°äº†å‡ºæ¥ã€‚

## ç”Ÿæˆä¸€ä¸ªç§˜å¯†æ•°å­—

æ¥ä¸‹æ¥ï¼Œéœ€è¦ç”Ÿæˆä¸€ä¸ªç§˜å¯†æ•°å­—ï¼Œå¥½è®©ç”¨æˆ·æ¥çŒœã€‚ç§˜å¯†æ•°å­—åº”è¯¥æ¯æ¬¡éƒ½ä¸åŒï¼Œè¿™æ ·é‡å¤ç©æ‰ä¸ä¼šä¹å‘³ï¼›èŒƒå›´åº”è¯¥åœ¨ 1 åˆ° 100 ä¹‹é—´ï¼Œè¿™æ ·æ‰ä¸ä¼šå¤ªå›°éš¾ã€‚Rust æ ‡å‡†åº“ä¸­å°šæœªåŒ…å«éšæœºæ•°åŠŸèƒ½ã€‚ç„¶è€Œï¼ŒRust å›¢é˜Ÿè¿˜æ˜¯æä¾›äº†ä¸€ä¸ª [`rand` crate][randcrate]ã€‚

[randcrate]: https://crates.io/crates/rand

### ä½¿ç”¨ crate æ¥å¢åŠ æ›´å¤šåŠŸèƒ½

è®°ä½ï¼Œ*crate* æ˜¯ä¸€ä¸ª Rust ä»£ç åŒ…ã€‚æˆ‘ä»¬æ­£åœ¨æ„å»ºçš„é¡¹ç›®æ˜¯ä¸€ä¸ª **äºŒè¿›åˆ¶ crate**ï¼Œå®ƒç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚ `rand` crate æ˜¯ä¸€ä¸ª **åº“ crate**ï¼Œåº“ crate å¯ä»¥åŒ…å«ä»»æ„èƒ½è¢«å…¶ä»–ç¨‹åºä½¿ç”¨çš„ä»£ç ã€‚

Cargo å¯¹å¤–éƒ¨ crate çš„è¿ç”¨æ˜¯å…¶çœŸæ­£é—ªå…‰çš„åœ°æ–¹ã€‚åœ¨æˆ‘ä»¬ä½¿ç”¨ `rand` ç¼–å†™ä»£ç ä¹‹å‰ï¼Œéœ€è¦ä¿®æ”¹ *Cargo.toml* æ–‡ä»¶ï¼Œå¼•å…¥ä¸€ä¸ª `rand` ä¾èµ–ã€‚ç°åœ¨æ‰“å¼€è¿™ä¸ªæ–‡ä»¶å¹¶åœ¨åº•éƒ¨çš„ `[dependencies]` ç‰‡æ®µæ ‡é¢˜ä¹‹ä¸‹æ·»åŠ ï¼š

<span class="filename">æ–‡ä»¶å: Cargo.toml</span>

```toml
[dependencies]

rand = "0.5.5"
```

åœ¨ *Cargo.toml* æ–‡ä»¶ä¸­ï¼Œæ ‡é¢˜ä»¥åŠä¹‹åçš„å†…å®¹å±åŒä¸€ä¸ªç‰‡æ®µï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ªæ ‡é¢˜æ‰å¼€å§‹æ–°çš„ç‰‡æ®µã€‚`[dependencies]` ç‰‡æ®µå‘Šè¯‰ Cargo æœ¬é¡¹ç›®ä¾èµ–äº†å“ªäº›å¤–éƒ¨ crate åŠå…¶ç‰ˆæœ¬ã€‚æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬ `0.5.5` æ¥æŒ‡å®š `rand` crateã€‚Cargo ç†è§£[è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆSemantic Versioningï¼‰][semver]<!-- ignore -->ï¼ˆæœ‰æ—¶ä¹Ÿç§°ä¸º *SemVer*ï¼‰ï¼Œè¿™æ˜¯ä¸€ç§å®šä¹‰ç‰ˆæœ¬å·çš„æ ‡å‡†ã€‚`0.5.5` äº‹å®ä¸Šæ˜¯ `^0.5.5` çš„ç®€å†™ï¼Œå®ƒè¡¨ç¤º â€œä»»ä½•ä¸ 0.5.5 ç‰ˆæœ¬å…¬æœ‰ API ç›¸å…¼å®¹çš„ç‰ˆæœ¬â€ã€‚

[semver]: http://semver.org

ç°åœ¨ï¼Œä¸ä¿®æ”¹ä»»ä½•ä»£ç ï¼Œæ„å»ºé¡¹ç›®ï¼Œå¦‚ç¤ºä¾‹ 2-2 æ‰€ç¤ºï¼š

```text
$ cargo build
    Updating crates.io index
  Downloaded rand v0.5.5
  Downloaded libc v0.2.62
  Downloaded rand_core v0.2.2
  Downloaded rand_core v0.3.1
  Downloaded rand_core v0.4.2
   Compiling rand_core v0.4.2
   Compiling libc v0.2.62
   Compiling rand_core v0.3.1
   Compiling rand_core v0.2.2
   Compiling rand v0.5.5
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 2.53 s
```

<span class="caption">ç¤ºä¾‹ 2-2: å°† rand crate æ·»åŠ ä¸ºä¾èµ–ä¹‹åè¿è¡Œ `cargo build` çš„è¾“å‡º</span>

å¯èƒ½ä¼šå‡ºç°ä¸åŒçš„ç‰ˆæœ¬å·ï¼ˆå¤šäºäº†è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼Œå®ƒä»¬ä¸ä»£ç æ˜¯å…¼å®¹çš„ï¼ï¼‰ï¼ŒåŒæ—¶æ˜¾ç¤ºé¡ºåºä¹Ÿå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚

ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå¤–éƒ¨ä¾èµ–ï¼ŒCargo ä» *registry* ä¸Šè·å–æ‰€æœ‰åŒ…çš„æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯ï¼Œè¿™æ˜¯ä¸€ä»½æ¥è‡ª [Crates.io][cratesio] çš„æ•°æ®æ‹·è´ã€‚Crates.io æ˜¯ Rust ç”Ÿæ€ç¯å¢ƒä¸­çš„å¼€å‘è€…ä»¬å‘ä»–äººè´¡çŒ® Rust å¼€æºé¡¹ç›®çš„åœ°æ–¹ã€‚

[cratesio]: https://crates.io

åœ¨æ›´æ–°å®Œ registry åï¼ŒCargo æ£€æŸ¥ `[dependencies]` ç‰‡æ®µå¹¶ä¸‹è½½ç¼ºå¤±çš„ crate ã€‚æœ¬ä¾‹ä¸­ï¼Œè™½ç„¶åªå£°æ˜äº† `rand` ä¸€ä¸ªä¾èµ–ï¼Œç„¶è€Œ Cargo è¿˜æ˜¯é¢å¤–è·å–äº† `libc` å’Œ `rand_core` çš„æ‹·è´ï¼Œå› ä¸º `rand` ä¾èµ– `libc` æ¥æ­£å¸¸å·¥ä½œã€‚ä¸‹è½½å®Œæˆåï¼ŒRust ç¼–è¯‘ä¾èµ–ï¼Œç„¶åä½¿ç”¨è¿™äº›ä¾èµ–ç¼–è¯‘é¡¹ç›®ã€‚

å¦‚æœä¸åšä»»ä½•ä¿®æ”¹ï¼Œç«‹åˆ»å†æ¬¡è¿è¡Œ `cargo build`ï¼Œåˆ™ä¸ä¼šçœ‹åˆ°ä»»ä½•é™¤äº† `Finished` è¡Œä¹‹å¤–çš„è¾“å‡ºã€‚Cargo çŸ¥é“å®ƒå·²ç»ä¸‹è½½å¹¶ç¼–è¯‘äº†ä¾èµ–ï¼ŒåŒæ—¶ *Cargo.toml* æ–‡ä»¶ä¹Ÿæ²¡æœ‰å˜åŠ¨ã€‚Cargo è¿˜çŸ¥é“ä»£ç ä¹Ÿæ²¡æœ‰ä»»ä½•ä¿®æ”¹ï¼Œæ‰€ä»¥å®ƒä¸ä¼šé‡æ–°ç¼–è¯‘ä»£ç ã€‚å› ä¸ºæ— äº‹å¯åšï¼Œå®ƒç®€å•çš„é€€å‡ºäº†ã€‚

å¦‚æœæ‰“å¼€ *src/main.rs* æ–‡ä»¶ï¼Œåšä¸€äº›æ— å…³ç´§è¦çš„ä¿®æ”¹ï¼Œä¿å­˜å¹¶å†æ¬¡æ„å»ºï¼Œåˆ™ä¼šå‡ºç°ä¸¤è¡Œè¾“å‡ºï¼š

```text
$ cargo build
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 2.53 secs
```

è¿™ä¸€è¡Œè¡¨ç¤º Cargo åªé’ˆå¯¹ *src/main.rs* æ–‡ä»¶çš„å¾®å°ä¿®æ”¹è€Œæ›´æ–°æ„å»ºã€‚ä¾èµ–æ²¡æœ‰å˜åŒ–ï¼Œæ‰€ä»¥ Cargo çŸ¥é“å®ƒå¯ä»¥å¤ç”¨å·²ç»ä¸ºæ­¤ä¸‹è½½å¹¶ç¼–è¯‘çš„ä»£ç ã€‚å®ƒåªæ˜¯é‡æ–°æ„å»ºäº†éƒ¨åˆ†ï¼ˆé¡¹ç›®ï¼‰ä»£ç ã€‚

#### *Cargo.lock* æ–‡ä»¶ç¡®ä¿æ„å»ºæ˜¯å¯é‡ç°çš„

Cargo æœ‰ä¸€ä¸ªæœºåˆ¶æ¥ç¡®ä¿ä»»ä½•äººåœ¨ä»»ä½•æ—¶å€™é‡æ–°æ„å»ºä»£ç ï¼Œéƒ½ä¼šäº§ç”Ÿç›¸åŒçš„ç»“æœï¼šCargo åªä¼šä½¿ç”¨ä½ æŒ‡å®šçš„ä¾èµ–ç‰ˆæœ¬ï¼Œé™¤éä½ åˆæ‰‹åŠ¨æŒ‡å®šäº†åˆ«çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸‹å‘¨ `rand` crate çš„ `0.5.6` ç‰ˆæœ¬å‡ºæ¥äº†ï¼Œå®ƒä¿®å¤äº†ä¸€ä¸ªé‡è¦çš„ bugï¼ŒåŒæ—¶ä¹Ÿå«æœ‰ä¸€ä¸ªä¼šç ´åä»£ç è¿è¡Œçš„ç¼ºé™·ï¼Œè¿™æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ

è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆæ˜¯ *Cargo.lock* æ–‡ä»¶ã€‚å®ƒåœ¨ç¬¬ä¸€æ¬¡è¿è¡Œ `cargo build` æ—¶åˆ›å»ºï¼Œå¹¶æ”¾åœ¨ *guessing_game* ç›®å½•ã€‚å½“ç¬¬ä¸€æ¬¡æ„å»ºé¡¹ç›®æ—¶ï¼ŒCargo è®¡ç®—å‡ºæ‰€æœ‰ç¬¦åˆè¦æ±‚çš„ä¾èµ–ç‰ˆæœ¬å¹¶å†™å…¥ *Cargo.lock* æ–‡ä»¶ã€‚å½“å°†æ¥æ„å»ºé¡¹ç›®æ—¶ï¼ŒCargo ä¼šå‘ç° *Cargo.lock* å·²å­˜åœ¨å¹¶ä½¿ç”¨å…¶ä¸­æŒ‡å®šçš„ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯å†æ¬¡è®¡ç®—æ‰€æœ‰çš„ç‰ˆæœ¬ã€‚è¿™ä½¿å¾—ä½ æ‹¥æœ‰äº†ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„å¯é‡ç°çš„æ„å»ºã€‚æ¢å¥è¯è¯´ï¼Œé¡¹ç›®ä¼šæŒç»­ä½¿ç”¨ `0.5.5` ç›´åˆ°ä½ æ˜¾å¼å‡çº§ï¼Œå¤šäºæœ‰äº† *Cargo.lock* æ–‡ä»¶ã€‚

#### æ›´æ–° crate åˆ°ä¸€ä¸ªæ–°ç‰ˆæœ¬

å½“ä½  **ç¡®å®** éœ€è¦å‡çº§ crate æ—¶ï¼ŒCargo æä¾›äº†å¦ä¸€ä¸ªå‘½ä»¤ï¼Œ`update`ï¼Œå®ƒä¼šå¿½ç•¥ *Cargo.lock* æ–‡ä»¶ï¼Œå¹¶è®¡ç®—å‡ºæ‰€æœ‰ç¬¦åˆ *Cargo.toml* å£°æ˜çš„æœ€æ–°ç‰ˆæœ¬ã€‚å¦‚æœæˆåŠŸäº†ï¼ŒCargo ä¼šæŠŠè¿™äº›ç‰ˆæœ¬å†™å…¥ *Cargo.lock* æ–‡ä»¶ã€‚

ä¸è¿‡ï¼ŒCargo é»˜è®¤åªä¼šå¯»æ‰¾å¤§äº `0.5.5` è€Œå°äº `0.6.0` çš„ç‰ˆæœ¬ã€‚å¦‚æœ `rand` crate å‘å¸ƒäº†ä¸¤ä¸ªæ–°ç‰ˆæœ¬ï¼Œ`0.5.6` å’Œ `0.6.0`ï¼Œåœ¨è¿è¡Œ `cargo update` æ—¶ä¼šå‡ºç°å¦‚ä¸‹å†…å®¹ï¼š

```text
$ cargo update
    Updating crates.io index
    Updating rand v0.5.5 -> v0.5.6
```

è¿™æ—¶ï¼Œä½ ä¹Ÿä¼šæ³¨æ„åˆ°çš„ *Cargo.lock* æ–‡ä»¶ä¸­çš„å˜åŒ–æ— å¤–ä¹ç°åœ¨ä½¿ç”¨çš„ `rand` crate ç‰ˆæœ¬æ˜¯`0.5.6`

å¦‚æœæƒ³è¦ä½¿ç”¨ `0.6.0` ç‰ˆæœ¬çš„ `rand` æˆ–æ˜¯ä»»ä½• `0.6.x` ç³»åˆ—çš„ç‰ˆæœ¬ï¼Œå¿…é¡»åƒè¿™æ ·æ›´æ–° *Cargo.toml* æ–‡ä»¶ï¼š

```toml
[dependencies]

rand = "0.6.0"
```

ä¸‹ä¸€æ¬¡è¿è¡Œ `cargo build` æ—¶ï¼ŒCargo ä¼šä» registry æ›´æ–°å¯ç”¨çš„ crateï¼Œå¹¶æ ¹æ®ä½ æŒ‡å®šçš„æ–°ç‰ˆæœ¬é‡æ–°è®¡ç®—ã€‚

ç¬¬åå››ç« ä¼šè®²åˆ° [Cargo][doccargo]<!-- ignore --> åŠå…¶[ç”Ÿæ€ç³»ç»Ÿ][doccratesio]<!-- ignore --> çš„æ›´å¤šå†…å®¹ï¼Œä¸è¿‡ç›®å‰ä½ åªéœ€è¦äº†è§£è¿™ä¹ˆå¤šã€‚é€šè¿‡ Cargo å¤ç”¨åº“æ–‡ä»¶éå¸¸å®¹æ˜“ï¼Œå› æ­¤ Rustacean èƒ½å¤Ÿç¼–å†™å‡ºç”±å¾ˆå¤šåŒ…ç»„è£…è€Œæˆçš„æ›´è½»å·§çš„é¡¹ç›®ã€‚

[doccargo]: http://doc.crates.io
[doccratesio]: http://doc.crates.io/crates-io.html

### ç”Ÿæˆä¸€ä¸ªéšæœºæ•°

ä½ å·²ç»æŠŠ `rand` crate æ·»åŠ åˆ° *Cargo.toml* äº†ï¼Œè®©æˆ‘ä»¬å¼€å§‹ä½¿ç”¨ `rand`ã€‚ä¸‹ä¸€æ­¥æ˜¯æ›´æ–° *src/main.rs*ï¼Œå¦‚ç¤ºä¾‹ 2-3 æ‰€ç¤ºã€‚

<span class="filename">æ–‡ä»¶å: src/main.rs</span>

```rust,ignore
use std::io;
use rand::Rng;

fn main() {
    println!("Guess the number!");

    let secret_number = rand::thread_rng().gen_range(1, 101);

    println!("The secret number is: {}", secret_number);

    println!("Please input your guess.");

    let mut guess = String::new();

    io::stdin().read_line(&mut guess)
        .expect("Failed to read line");

    println!("You guessed: {}", guess);
}
```

<span class="caption">ç¤ºä¾‹ 2-3ï¼šæ·»åŠ ç”Ÿæˆéšæœºæ•°çš„ä»£ç </span>

é¦–å…ˆï¼Œæˆ‘ä»¬æ–°å¢äº†ä¸€è¡Œ `use`ï¼š`use rand::Rng`ã€‚`Rng` æ˜¯ä¸€ä¸ª traitï¼Œå®ƒå®šä¹‰äº†éšæœºæ•°ç”Ÿæˆå™¨åº”å®ç°çš„æ–¹æ³•ï¼Œæƒ³ä½¿ç”¨è¿™äº›æ–¹æ³•çš„è¯ï¼Œæ­¤ trait å¿…é¡»åœ¨ä½œç”¨åŸŸä¸­ã€‚ç¬¬åç« ä¼šè¯¦ç»†ä»‹ç» traitã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨ä¸­é—´è¿˜æ–°å¢åŠ äº†ä¸¤è¡Œã€‚`rand::thread_rng` å‡½æ•°æä¾›å®é™…ä½¿ç”¨çš„éšæœºæ•°ç”Ÿæˆå™¨ï¼šå®ƒä½äºå½“å‰æ‰§è¡Œçº¿ç¨‹çš„æœ¬åœ°ç¯å¢ƒä¸­ï¼Œå¹¶ä»æ“ä½œç³»ç»Ÿè·å– seedã€‚æ¥ä¸‹æ¥ï¼Œè°ƒç”¨éšæœºæ•°ç”Ÿæˆå™¨çš„ `gen_range` æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ç”±åˆšæ‰å¼•å…¥åˆ°ä½œç”¨åŸŸçš„ `Rng` trait å®šä¹‰ã€‚`gen_range` æ–¹æ³•è·å–ä¸¤ä¸ªæ•°å­—ä½œä¸ºå‚æ•°ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªèŒƒå›´åœ¨ä¸¤è€…ä¹‹é—´çš„éšæœºæ•°ã€‚å®ƒåŒ…å«ä¸‹é™ä½†ä¸åŒ…å«ä¸Šé™ï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®š `1` å’Œ `101` æ¥è¯·æ±‚ä¸€ä¸ª 1 å’Œ 100 ä¹‹é—´çš„æ•°ã€‚

> æ³¨æ„ï¼šä½ ä¸å¯èƒ½å‡­ç©ºå°±çŸ¥é“åº”è¯¥ use å“ªä¸ª trait ä»¥åŠè¯¥ä» crate ä¸­è°ƒç”¨å“ªä¸ªæ–¹æ³•ã€‚crate çš„ä½¿ç”¨è¯´æ˜ä½äºå…¶æ–‡æ¡£ä¸­ã€‚Cargo æœ‰ä¸€ä¸ªå¾ˆæ£’çš„åŠŸèƒ½æ˜¯ï¼šè¿è¡Œ `cargo doc --open` å‘½ä»¤æ¥æ„å»ºæ‰€æœ‰æœ¬åœ°ä¾èµ–æä¾›çš„æ–‡æ¡£ï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ å¯¹ `rand` crate ä¸­çš„å…¶ä»–åŠŸèƒ½æ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥è¿è¡Œ `cargo doc --open` å¹¶ç‚¹å‡»å·¦ä¾§å¯¼èˆªæ ä¸­çš„ `rand`ã€‚

æ–°å¢åŠ çš„ç¬¬äºŒè¡Œä»£ç æ‰“å°å‡ºäº†ç§˜å¯†æ•°å­—ã€‚è¿™åœ¨å¼€å‘ç¨‹åºæ—¶å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå¯ä»¥æµ‹è¯•å®ƒï¼Œä¸è¿‡åœ¨æœ€ç»ˆç‰ˆæœ¬ä¸­ä¼šåˆ æ‰å®ƒã€‚å¦‚æœæ¸¸æˆä¸€å¼€å§‹å°±æ‰“å°å‡ºç»“æœå°±æ²¡ä»€ä¹ˆå¯ç©çš„äº†ï¼

å°è¯•è¿è¡Œç¨‹åºå‡ æ¬¡ï¼š

```text
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 2.53 secs
     Running `target/debug/guessing_game`
Guess the number!
The secret number is: 7
Please input your guess.
4
You guessed: 4
$ cargo run
     Running `target/debug/guessing_game`
Guess the number!
The secret number is: 83
Please input your guess.
5
You guessed: 5
```

ä½ åº”è¯¥èƒ½å¾—åˆ°ä¸åŒçš„éšæœºæ•°ï¼ŒåŒæ—¶å®ƒä»¬åº”è¯¥éƒ½æ˜¯åœ¨ 1 å’Œ 100 ä¹‹é—´çš„ã€‚å¹²å¾—æ¼‚äº®ï¼

## æ¯”è¾ƒçŒœæµ‹çš„æ•°å­—å’Œç§˜å¯†æ•°å­—

ç°åœ¨æœ‰äº†ç”¨æˆ·è¾“å…¥å’Œä¸€ä¸ªéšæœºæ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ¯”è¾ƒå®ƒä»¬ã€‚è¿™ä¸ªæ­¥éª¤å¦‚ç¤ºä¾‹ 2-4 æ‰€ç¤ºã€‚æ³¨æ„è¿™æ®µä»£ç è¿˜ä¸èƒ½é€šè¿‡ç¼–è¯‘ï¼Œæˆ‘ä»¬ç¨åä¼šè§£é‡Šã€‚

<span class="filename">æ–‡ä»¶å: src/main.rs</span>

```rust,ignore,does_not_compile
use std::io;
use std::cmp::Ordering;
use rand::Rng;

fn main() {

    // ---snip---

    println!("You guessed: {}", guess);

    match guess.cmp(&secret_number) {
        Ordering::Less => println!("Too small!"),
        Ordering::Greater => println!("Too big!"),
        Ordering::Equal => println!("You win!"),
    }
}
```

<span class="caption">ç¤ºä¾‹ 2-4ï¼šå¤„ç†æ¯”è¾ƒä¸¤ä¸ªæ•°å­—å¯èƒ½çš„è¿”å›å€¼</span>

æ–°ä»£ç çš„ç¬¬ä¸€è¡Œæ˜¯å¦ä¸€ä¸ª `use`ï¼Œä»æ ‡å‡†åº“å¼•å…¥äº†ä¸€ä¸ªå«åš `std::cmp::Ordering` çš„ç±»å‹ã€‚åŒ `Result` ä¸€æ ·ï¼Œ `Ordering` ä¹Ÿæ˜¯ä¸€ä¸ªæšä¸¾ï¼Œä¸è¿‡å®ƒçš„æˆå‘˜æ˜¯ `Less`ã€`Greater` å’Œ `Equal`ã€‚è¿™æ˜¯æ¯”è¾ƒä¸¤ä¸ªå€¼æ—¶å¯èƒ½å‡ºç°çš„ä¸‰ç§ç»“æœã€‚

æ¥ç€ï¼Œåº•éƒ¨çš„äº”è¡Œæ–°ä»£ç ä½¿ç”¨äº† `Ordering` ç±»å‹ï¼Œ`cmp` æ–¹æ³•ç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªå€¼å¹¶å¯ä»¥åœ¨ä»»ä½•å¯æ¯”è¾ƒçš„å€¼ä¸Šè°ƒç”¨ã€‚å®ƒè·å–ä¸€ä¸ªè¢«æ¯”è¾ƒå€¼çš„å¼•ç”¨ï¼šè¿™é‡Œæ˜¯æŠŠ `guess` ä¸ `secret_number` åšæ¯”è¾ƒã€‚ ç„¶åå®ƒä¼šè¿”å›ä¸€ä¸ªåˆšæ‰é€šè¿‡ `use` å¼•å…¥ä½œç”¨åŸŸçš„ `Ordering` æšä¸¾çš„æˆå‘˜ã€‚ä½¿ç”¨ä¸€ä¸ª [`match`][match]<!-- ignore --> è¡¨è¾¾å¼ï¼Œæ ¹æ®å¯¹ `guess` å’Œ `secret_number` è°ƒç”¨ `cmp` è¿”å›çš„ `Ordering` æˆå‘˜æ¥å†³å®šæ¥ä¸‹æ¥åšä»€ä¹ˆã€‚

[match]: ch06-02-match.html

ä¸€ä¸ª `match` è¡¨è¾¾å¼ç”± **åˆ†æ”¯ï¼ˆarmsï¼‰** æ„æˆã€‚ä¸€ä¸ªåˆ†æ”¯åŒ…å«ä¸€ä¸ª **æ¨¡å¼**ï¼ˆ*pattern*ï¼‰å’Œè¡¨è¾¾å¼å¼€å¤´çš„å€¼ä¸åˆ†æ”¯æ¨¡å¼ç›¸åŒ¹é…æ—¶åº”è¯¥æ‰§è¡Œçš„ä»£ç ã€‚Rust è·å–æä¾›ç»™ `match` çš„å€¼å¹¶æŒ¨ä¸ªæ£€æŸ¥æ¯ä¸ªåˆ†æ”¯çš„æ¨¡å¼ã€‚`match` ç»“æ„å’Œæ¨¡å¼æ˜¯ Rust ä¸­å¼ºå¤§çš„åŠŸèƒ½ï¼Œå®ƒä½“ç°äº†ä»£ç å¯èƒ½é‡åˆ°çš„å¤šç§æƒ…å½¢ï¼Œå¹¶å¸®åŠ©ä½ ç¡®ä¿æ²¡æœ‰é—æ¼å¤„ç†ã€‚è¿™äº›åŠŸèƒ½å°†åˆ†åˆ«åœ¨ç¬¬å…­ç« å’Œç¬¬åå…«ç« è¯¦ç»†ä»‹ç»ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹ä½¿ç”¨ `match` è¡¨è¾¾å¼çš„ä¾‹å­ã€‚å‡è®¾ç”¨æˆ·çŒœäº† 50ï¼Œè¿™æ—¶éšæœºç”Ÿæˆçš„ç§˜å¯†æ•°å­—æ˜¯ 38ã€‚æ¯”è¾ƒ 50 ä¸ 38 æ—¶ï¼Œå› ä¸º 50 æ¯” 38 è¦å¤§ï¼Œ`cmp` æ–¹æ³•ä¼šè¿”å› `Ordering::Greater`ã€‚`Ordering::Greater` æ˜¯ `match` è¡¨è¾¾å¼å¾—åˆ°çš„å€¼ã€‚å®ƒæ£€æŸ¥ç¬¬ä¸€ä¸ªåˆ†æ”¯çš„æ¨¡å¼ï¼Œ`Ordering::Less` ä¸ `Ordering::Greater`å¹¶ä¸åŒ¹é…ï¼Œæ‰€ä»¥å®ƒå¿½ç•¥äº†è¿™ä¸ªåˆ†æ”¯çš„ä»£ç å¹¶æ¥åˆ°ä¸‹ä¸€ä¸ªåˆ†æ”¯ã€‚ä¸‹ä¸€ä¸ªåˆ†æ”¯çš„æ¨¡å¼æ˜¯ `Ordering::Greater`ï¼Œ**æ­£ç¡®** åŒ¹é…ï¼è¿™ä¸ªåˆ†æ”¯å…³è”çš„ä»£ç è¢«æ‰§è¡Œï¼Œåœ¨å±å¹•æ‰“å°å‡º `Too big!`ã€‚`match` è¡¨è¾¾å¼å°±æ­¤ç»ˆæ­¢ï¼Œå› ä¸ºè¯¥åœºæ™¯ä¸‹æ²¡æœ‰æ£€æŸ¥æœ€åä¸€ä¸ªåˆ†æ”¯çš„å¿…è¦ã€‚

ç„¶è€Œï¼Œç¤ºä¾‹ 2-4 çš„ä»£ç å¹¶ä¸èƒ½ç¼–è¯‘ï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹ï¼š

```text
$ cargo build
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
error[E0308]: mismatched types
  --> src/main.rs:23:21
   |
23 |     match guess.cmp(&secret_number) {
   |                     ^^^^^^^^^^^^^^ expected struct `std::string::String`, found integer
   |
   = note: expected type `&std::string::String`
   = note:    found type `&{integer}`

error: aborting due to previous error
Could not compile `guessing_game`.
```

é”™è¯¯çš„æ ¸å¿ƒè¡¨æ˜è¿™é‡Œæœ‰ **ä¸åŒ¹é…çš„ç±»å‹**ï¼ˆ*mismatched types*ï¼‰ã€‚Rust æœ‰ä¸€ä¸ªé™æ€å¼ºç±»å‹ç³»ç»Ÿï¼ŒåŒæ—¶ä¹Ÿæœ‰ç±»å‹æ¨æ–­ã€‚å½“æˆ‘ä»¬å†™å‡º `let guess = String::new()` æ—¶ï¼ŒRust æ¨æ–­å‡º `guess` åº”è¯¥æ˜¯ `String` ç±»å‹ï¼Œå¹¶ä¸éœ€è¦æˆ‘ä»¬å†™å‡ºç±»å‹ã€‚å¦ä¸€æ–¹é¢ï¼Œ`secret_number`ï¼Œæ˜¯æ•°å­—ç±»å‹ã€‚å‡ ä¸ªæ•°å­—ç±»å‹æ‹¥æœ‰ 1 åˆ° 100 ä¹‹é—´çš„å€¼ï¼š32 ä½æ•°å­— `i32`ï¼›32 ä½æ— ç¬¦å·æ•°å­— `u32`ï¼›64 ä½æ•°å­— `i64` ç­‰ç­‰ã€‚Rust é»˜è®¤ä½¿ç”¨ `i32`ï¼Œæ‰€ä»¥å®ƒæ˜¯ `secret_number` çš„ç±»å‹ï¼Œé™¤éå¢åŠ ç±»å‹ä¿¡æ¯ï¼Œæˆ–ä»»ä½•èƒ½è®© Rust æ¨æ–­å‡ºä¸åŒæ•°å€¼ç±»å‹çš„ä¿¡æ¯ã€‚è¿™é‡Œé”™è¯¯çš„åŸå› åœ¨äº Rust ä¸ä¼šæ¯”è¾ƒå­—ç¬¦ä¸²ç±»å‹å’Œæ•°å­—ç±»å‹ã€‚

æ‰€ä»¥æˆ‘ä»¬å¿…é¡»æŠŠä»è¾“å…¥ä¸­è¯»å–åˆ°çš„ `String` è½¬æ¢ä¸ºä¸€ä¸ªçœŸæ­£çš„æ•°å­—ç±»å‹ï¼Œæ‰å¥½ä¸ç§˜å¯†æ•°å­—è¿›è¡Œæ¯”è¾ƒã€‚è¿™å¯ä»¥é€šè¿‡åœ¨ `main` å‡½æ•°ä½“ä¸­å¢åŠ å¦‚ä¸‹ä¸¤è¡Œä»£ç æ¥å®ç°ï¼š

<span class="filename">æ–‡ä»¶å: src/main.rs</span>

```rust,ignore
// --snip--

    let mut guess = String::new();

    io::stdin().read_line(&mut guess)
        .expect("Failed to read line");

    let guess: u32 = guess.trim().parse()
        .expect("Please type a number!");

    println!("You guessed: {}", guess);

    match guess.cmp(&secret_number) {
        Ordering::Less => println!("Too small!"),
        Ordering::Greater => println!("Too big!"),
        Ordering::Equal => println!("You win!"),
    }
}
```

è¿™ä¸¤è¡Œæ–°ä»£ç æ˜¯ï¼š

```rust,ignore
let guess: u32 = guess.trim().parse()
    .expect("Please type a number!");
```

è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªå«åš `guess` çš„å˜é‡ã€‚ä¸è¿‡ç­‰ç­‰ï¼Œä¸æ˜¯å·²ç»æœ‰äº†ä¸€ä¸ªå«åš `guess` çš„å˜é‡äº†å—ï¼Ÿç¡®å®å¦‚æ­¤ï¼Œä¸è¿‡ Rust å…è®¸ç”¨ä¸€ä¸ªæ–°å€¼æ¥ **éšè—** ï¼ˆ*shadow*ï¼‰ `guess` ä¹‹å‰çš„å€¼ã€‚è¿™ä¸ªåŠŸèƒ½å¸¸ç”¨åœ¨éœ€è¦è½¬æ¢å€¼ç±»å‹ä¹‹ç±»çš„åœºæ™¯ã€‚å®ƒå…è®¸æˆ‘ä»¬å¤ç”¨ `guess` å˜é‡çš„åå­—ï¼Œè€Œä¸æ˜¯è¢«è¿«åˆ›å»ºä¸¤ä¸ªä¸åŒå˜é‡ï¼Œè¯¸å¦‚ `guess_str` å’Œ `guess` ä¹‹ç±»ã€‚ï¼ˆç¬¬ä¸‰ç« ä¼šä»‹ç» shadowing çš„æ›´å¤šç»†èŠ‚ã€‚ï¼‰

æˆ‘ä»¬å°† `guess` ç»‘å®šåˆ° `guess.trim().parse()` è¡¨è¾¾å¼ä¸Šã€‚è¡¨è¾¾å¼ä¸­çš„ `guess` æ˜¯åŒ…å«è¾“å…¥çš„åŸå§‹ `String` ç±»å‹ã€‚`String` å®ä¾‹çš„ `trim` æ–¹æ³•ä¼šå»é™¤å­—ç¬¦ä¸²å¼€å¤´å’Œç»“å°¾çš„ç©ºç™½å­—ç¬¦ã€‚`u32` åªèƒ½ç”±æ•°å­—å­—ç¬¦è½¬æ¢ï¼Œä¸è¿‡ç”¨æˆ·å¿…é¡»è¾“å…¥ <span class="keystroke">enter</span> é”®æ‰èƒ½è®© `read_line` è¿”å›ï¼Œç„¶è€Œç”¨æˆ·æŒ‰ä¸‹ <span class="keystroke">enter</span> é”®æ—¶ï¼Œä¼šåœ¨å­—ç¬¦ä¸²ä¸­å¢åŠ ä¸€ä¸ªæ¢è¡Œï¼ˆnewlineï¼‰ç¬¦ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·è¾“å…¥ <span class="keystroke">5</span> å¹¶æŒ‰ä¸‹ <span class="keystroke">enter</span>ï¼Œ`guess` çœ‹èµ·æ¥åƒè¿™æ ·ï¼š`5\n`ã€‚`\n` ä»£è¡¨ â€œæ¢è¡Œâ€ï¼Œå›è½¦é”®ã€‚`trim` æ–¹æ³•æ¶ˆé™¤ `\n`ï¼Œåªç•™ä¸‹ `5`ã€‚

[å­—ç¬¦ä¸²çš„ `parse` æ–¹æ³•][parse]<!-- ignore --> å°†å­—ç¬¦ä¸²è§£ææˆæ•°å­—ã€‚å› ä¸ºè¿™ä¸ªæ–¹æ³•å¯ä»¥è§£æå¤šç§æ•°å­—ç±»å‹ï¼Œå› æ­¤éœ€è¦å‘Šè¯‰ Rust å…·ä½“çš„æ•°å­—ç±»å‹ï¼Œè¿™é‡Œé€šè¿‡ `let guess: u32` æŒ‡å®šã€‚`guess` åé¢çš„å†’å·ï¼ˆ`:`ï¼‰å‘Šè¯‰ Rust æˆ‘ä»¬æŒ‡å®šäº†å˜é‡çš„ç±»å‹ã€‚Rust æœ‰ä¸€äº›å†…å»ºçš„æ•°å­—ç±»å‹ï¼›`u32` æ˜¯ä¸€ä¸ªæ— ç¬¦å·çš„ 32 ä½æ•´å‹ã€‚å¯¹äºä¸å¤§çš„æ­£æ•´æ•°æ¥è¯´ï¼Œå®ƒæ˜¯ä¸é”™çš„ç±»å‹ï¼Œç¬¬ä¸‰ç« è¿˜ä¼šè®²åˆ°å…¶ä»–æ•°å­—ç±»å‹ã€‚å¦å¤–ï¼Œç¨‹åºä¸­çš„ `u32` æ³¨è§£ä»¥åŠä¸ `secret_number` çš„æ¯”è¾ƒï¼Œæ„å‘³ç€ Rust ä¼šæ¨æ–­å‡º `secret_number` ä¹Ÿæ˜¯ `u32` ç±»å‹ã€‚ç°åœ¨å¯ä»¥ä½¿ç”¨ç›¸åŒç±»å‹æ¯”è¾ƒä¸¤ä¸ªå€¼äº†ï¼

[parse]: https://doc.rust-lang.org/std/primitive.str.html#method.parse

`parse` è°ƒç”¨å¾ˆå®¹æ˜“äº§ç”Ÿé”™è¯¯ã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²ä¸­åŒ…å« `AğŸ‘%`ï¼Œå°±æ— æ³•å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—ã€‚å› æ­¤ï¼Œ`parse` æ–¹æ³•è¿”å›ä¸€ä¸ª `Result` ç±»å‹ã€‚åƒä¹‹å‰ [â€œä½¿ç”¨ `Result` ç±»å‹æ¥å¤„ç†æ½œåœ¨çš„é”™è¯¯â€](#handling-potential-failure-with-the-result-type) è®¨è®ºçš„ `read_line` æ–¹æ³•é‚£æ ·ï¼Œå†æ¬¡æŒ‰éƒ¨å°±ç­çš„ç”¨ `expect` æ–¹æ³•å¤„ç†å³å¯ã€‚å¦‚æœ `parse` ä¸èƒ½ä»å­—ç¬¦ä¸²ç”Ÿæˆä¸€ä¸ªæ•°å­—ï¼Œè¿”å›ä¸€ä¸ª `Result` çš„ `Err` æˆå‘˜æ—¶ï¼Œ`expect` ä¼šä½¿æ¸¸æˆå´©æºƒå¹¶æ‰“å°é™„å¸¦çš„ä¿¡æ¯ã€‚å¦‚æœ `parse` æˆåŠŸåœ°å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—ï¼Œå®ƒä¼šè¿”å› `Result` çš„ `Ok` æˆå‘˜ï¼Œç„¶å `expect` ä¼šè¿”å› `Ok` å€¼ä¸­çš„æ•°å­—ã€‚

ç°åœ¨è®©æˆ‘ä»¬è¿è¡Œç¨‹åºï¼

```text
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 0.43 secs
     Running `target/debug/guessing_game`
Guess the number!
The secret number is: 58
Please input your guess.
  76
You guessed: 76
Too big!
```

æ¼‚äº®ï¼å³ä¾¿æ˜¯åœ¨çŒœæµ‹ä¹‹å‰æ·»åŠ äº†ç©ºæ ¼ï¼Œç¨‹åºä¾ç„¶èƒ½åˆ¤æ–­å‡ºç”¨æˆ·çŒœæµ‹äº† 76ã€‚å¤šè¿è¡Œç¨‹åºå‡ æ¬¡ï¼Œè¾“å…¥ä¸åŒçš„æ•°å­—æ¥æ£€éªŒä¸åŒçš„è¡Œä¸ºï¼šçŒœä¸€ä¸ªæ­£ç¡®çš„æ•°å­—ï¼ŒçŒœä¸€ä¸ªè¿‡å¤§çš„æ•°å­—å’ŒçŒœä¸€ä¸ªè¿‡å°çš„æ•°å­—ã€‚

ç°åœ¨æ¸¸æˆå·²ç»å¤§ä½“ä¸Šèƒ½ç©äº†ï¼Œä¸è¿‡ç”¨æˆ·åªèƒ½çŒœä¸€æ¬¡ã€‚å¢åŠ ä¸€ä¸ªå¾ªç¯æ¥æ”¹å˜å®ƒå§ï¼

## ä½¿ç”¨å¾ªç¯æ¥å…è®¸å¤šæ¬¡çŒœæµ‹

`loop` å…³é”®å­—åˆ›å»ºäº†ä¸€ä¸ªæ— é™å¾ªç¯ã€‚å°†å…¶åŠ å…¥åï¼Œç”¨æˆ·å¯ä»¥åå¤çŒœæµ‹ï¼š

<span class="filename">æ–‡ä»¶å: src/main.rs</span>

```rust,ignore
// --snip--

    println!("The secret number is: {}", secret_number);

    loop {
        println!("Please input your guess.");

        // --snip--

        match guess.cmp(&secret_number) {
            Ordering::Less => println!("Too small!"),
            Ordering::Greater => println!("Too big!"),
            Ordering::Equal => println!("You win!"),
        }
    }
}
```

å¦‚ä¸Šæ‰€ç¤ºï¼Œæˆ‘ä»¬å°†æç¤ºç”¨æˆ·çŒœæµ‹ä¹‹åçš„æ‰€æœ‰å†…å®¹æ”¾å…¥äº†å¾ªç¯ã€‚ç¡®ä¿ loop å¾ªç¯ä¸­çš„ä»£ç å¤šç¼©è¿›å››ä¸ªç©ºæ ¼ï¼Œå†æ¬¡è¿è¡Œç¨‹åºã€‚æ³¨æ„è¿™é‡Œæœ‰ä¸€ä¸ªæ–°é—®é¢˜ï¼Œå› ä¸ºç¨‹åºå¿ å®åœ°æ‰§è¡Œäº†æˆ‘ä»¬çš„è¦æ±‚ï¼šæ°¸è¿œåœ°è¯·æ±‚å¦ä¸€ä¸ªçŒœæµ‹ï¼Œç”¨æˆ·å¥½åƒæ— æ³•é€€å‡ºå•Šï¼

ç”¨æˆ·æ€»èƒ½ä½¿ç”¨ <span class="keystroke">ctrl-c</span> ç»ˆæ­¢ç¨‹åºã€‚ä¸è¿‡è¿˜æœ‰å¦ä¸€ä¸ªæ–¹æ³•è·³å‡ºæ— é™å¾ªç¯ï¼Œå°±æ˜¯ [â€œæ¯”è¾ƒçŒœæµ‹ä¸ç§˜å¯†æ•°å­—â€](#comparing-the-guess-to-the-secret-number) éƒ¨åˆ†æåˆ°çš„ `parse`ï¼šå¦‚æœç”¨æˆ·è¾“å…¥çš„ç­”æ¡ˆä¸æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œç¨‹åºä¼šå´©æºƒã€‚ç”¨æˆ·å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥é€€å‡ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```text
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 1.50 secs
     Running `target/debug/guessing_game`
Guess the number!
The secret number is: 59
Please input your guess.
45
You guessed: 45
Too small!
Please input your guess.
60
You guessed: 60
Too big!
Please input your guess.
59
You guessed: 59
You win!
Please input your guess.
quit
thread 'main' panicked at 'Please type a number!: ParseIntError { kind: InvalidDigit }', src/libcore/result.rs:785
note: Run with `RUST_BACKTRACE=1` for a backtrace.
error: Process didn't exit successfully: `target/debug/guess` (exit code: 101)
```

è¾“å…¥ `quit` ç¡®å®é€€å‡ºäº†ç¨‹åºï¼ŒåŒæ—¶å…¶ä»–ä»»ä½•éæ•°å­—è¾“å…¥ä¹Ÿä¸€æ ·ã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸ç†æƒ³ï¼Œæˆ‘ä»¬æƒ³è¦å½“çŒœæµ‹æ­£ç¡®çš„æ•°å­—æ—¶æ¸¸æˆèƒ½è‡ªåŠ¨é€€å‡ºã€‚

### çŒœæµ‹æ­£ç¡®åé€€å‡º

è®©æˆ‘ä»¬å¢åŠ ä¸€ä¸ª `break` è¯­å¥ï¼Œåœ¨ç”¨æˆ·çŒœå¯¹æ—¶é€€å‡ºæ¸¸æˆï¼š

<span class="filename">æ–‡ä»¶å: src/main.rs</span>

```rust,ignore
// --snip--

        match guess.cmp(&secret_number) {
            Ordering::Less => println!("Too small!"),
            Ordering::Greater => println!("Too big!"),
            Ordering::Equal => {
                println!("You win!");
                break;
            }
        }
    }
}
```

é€šè¿‡åœ¨ `You win!` ä¹‹åå¢åŠ ä¸€è¡Œ `break`ï¼Œç”¨æˆ·çŒœå¯¹äº†ç¥ç§˜æ•°å­—åä¼šé€€å‡ºå¾ªç¯ã€‚é€€å‡ºå¾ªç¯ä¹Ÿæ„å‘³ç€é€€å‡ºç¨‹åºï¼Œå› ä¸ºå¾ªç¯æ˜¯ `main` çš„æœ€åä¸€éƒ¨åˆ†ã€‚

### å¤„ç†æ— æ•ˆè¾“å…¥

ä¸ºäº†è¿›ä¸€æ­¥æ”¹å–„æ¸¸æˆæ€§ï¼Œä¸è¦åœ¨ç”¨æˆ·è¾“å…¥éæ•°å­—æ—¶å´©æºƒï¼Œéœ€è¦å¿½ç•¥éæ•°å­—ï¼Œè®©ç”¨æˆ·å¯ä»¥ç»§ç»­çŒœæµ‹ã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹ `guess` å°† `String` è½¬åŒ–ä¸º `u32` é‚£éƒ¨åˆ†ä»£ç æ¥å®ç°ï¼Œå¦‚ç¤ºä¾‹ 2-5 æ‰€ç¤ºï¼š

<span class="filename">æ–‡ä»¶å: src/main.rs</span>

```rust,ignore
// --snip--

io::stdin().read_line(&mut guess)
    .expect("Failed to read line");

let guess: u32 = match guess.trim().parse() {
    Ok(num) => num,
    Err(_) => continue,
};

println!("You guessed: {}", guess);

// --snip--
```

<span class="caption">ç¤ºä¾‹ 2-5: å¿½ç•¥éæ•°å­—çš„çŒœæµ‹å¹¶é‡æ–°è¯·æ±‚æ•°å­—è€Œä¸æ˜¯è®©ç¨‹åºå´©æºƒ</span>

å°† `expect` è°ƒç”¨æ¢æˆ `match` è¯­å¥ï¼Œæ˜¯ä»é‡åˆ°é”™è¯¯å°±å´©æºƒè½¬æ¢åˆ°çœŸæ­£å¤„ç†é”™è¯¯çš„æƒ¯ç”¨æ–¹æ³•ã€‚é¡»çŸ¥ `parse` è¿”å›ä¸€ä¸ª `Result` ç±»å‹ï¼Œè€Œ `Result` æ˜¯ä¸€ä¸ªæ‹¥æœ‰ `Ok` æˆ– `Err` æˆå‘˜çš„æšä¸¾ã€‚è¿™é‡Œä½¿ç”¨çš„ `match` è¡¨è¾¾å¼ï¼Œå’Œä¹‹å‰å¤„ç† `cmp` æ–¹æ³•è¿”å› `Ordering` æ—¶ç”¨çš„ä¸€æ ·ã€‚

å¦‚æœ `parse` èƒ½å¤ŸæˆåŠŸçš„å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªåŒ…å«ç»“æœæ•°å­—çš„ `Ok`ã€‚è¿™ä¸ª `Ok` å€¼ä¸ `match` ç¬¬ä¸€ä¸ªåˆ†æ”¯çš„æ¨¡å¼ç›¸åŒ¹é…ï¼Œè¯¥åˆ†æ”¯å¯¹åº”çš„åŠ¨ä½œè¿”å› `Ok` å€¼ä¸­çš„æ•°å­— `num`ï¼Œæœ€åå¦‚æ„¿å˜æˆæ–°åˆ›å»ºçš„ `guess` å˜é‡ã€‚

å¦‚æœ `parse` *ä¸* èƒ½å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªåŒ…å«æ›´å¤šé”™è¯¯ä¿¡æ¯çš„ `Err`ã€‚`Err` å€¼ä¸èƒ½åŒ¹é…ç¬¬ä¸€ä¸ª `match` åˆ†æ”¯çš„ `Ok(num)` æ¨¡å¼ï¼Œä½†æ˜¯ä¼šåŒ¹é…ç¬¬äºŒä¸ªåˆ†æ”¯çš„ `Err(_)` æ¨¡å¼ï¼š`_` æ˜¯ä¸€ä¸ªé€šé…ç¬¦å€¼ï¼Œæœ¬ä¾‹ä¸­ç”¨æ¥åŒ¹é…æ‰€æœ‰ `Err` å€¼ï¼Œä¸ç®¡å…¶ä¸­æœ‰ä½•ç§ä¿¡æ¯ã€‚æ‰€ä»¥ç¨‹åºä¼šæ‰§è¡Œç¬¬äºŒä¸ªåˆ†æ”¯çš„åŠ¨ä½œï¼Œ`continue` æ„å‘³ç€è¿›å…¥ `loop` çš„ä¸‹ä¸€æ¬¡å¾ªç¯ï¼Œè¯·æ±‚å¦ä¸€ä¸ªçŒœæµ‹ã€‚è¿™æ ·ç¨‹åºå°±æœ‰æ•ˆçš„å¿½ç•¥äº† `parse` å¯èƒ½é‡åˆ°çš„æ‰€æœ‰é”™è¯¯ï¼

ç°åœ¨ä¸‡äº‹ä¿±å¤‡ï¼Œåªéœ€è¿è¡Œ `cargo run`ï¼š

```text
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
     Running `target/debug/guessing_game`
Guess the number!
The secret number is: 61
Please input your guess.
10
You guessed: 10
Too small!
Please input your guess.
99
You guessed: 99
Too big!
Please input your guess.
foo
Please input your guess.
61
You guessed: 61
You win!
```

å¤ªæ£’äº†ï¼å†æœ‰æœ€åä¸€ä¸ªå°çš„ä¿®æ”¹ï¼Œå°±èƒ½å®ŒæˆçŒœçŒœçœ‹æ¸¸æˆäº†ï¼šè¿˜è®°å¾—ç¨‹åºä¾ç„¶ä¼šæ‰“å°å‡ºç§˜å¯†æ•°å­—ã€‚åœ¨æµ‹è¯•æ—¶è¿˜å¥½ï¼Œä½†æ­£å¼å‘å¸ƒæ—¶ä¼šæ¯äº†æ¸¸æˆã€‚åˆ æ‰æ‰“å°ç§˜å¯†æ•°å­—çš„ `println!`ã€‚ç¤ºä¾‹ 2-6 ä¸ºæœ€ç»ˆä»£ç ï¼š

<span class="filename">æ–‡ä»¶å: src/main.rs</span>

```rust,ignore
use std::io;
use std::cmp::Ordering;
use rand::Rng;

fn main() {
    println!("Guess the number!");

    let secret_number = rand::thread_rng().gen_range(1, 101);

    loop {
        println!("Please input your guess.");

        let mut guess = String::new();

        io::stdin().read_line(&mut guess)
            .expect("Failed to read line");

        let guess: u32 = match guess.trim().parse() {
            Ok(num) => num,
            Err(_) => continue,
        };

        println!("You guessed: {}", guess);

        match guess.cmp(&secret_number) {
            Ordering::Less => println!("Too small!"),
            Ordering::Greater => println!("Too big!"),
            Ordering::Equal => {
                println!("You win!");
                break;
            }
        }
    }
}
```

<span class="caption">ç¤ºä¾‹ 2-6ï¼šçŒœçŒœçœ‹æ¸¸æˆçš„å®Œæ•´ä»£ç </span>

## æ€»ç»“

æ­¤æ—¶æ­¤åˆ»ï¼Œä½ é¡ºåˆ©å®Œæˆäº†çŒœçŒœçœ‹æ¸¸æˆã€‚æ­å–œï¼

æœ¬é¡¹ç›®é€šè¿‡åŠ¨æ‰‹å®è·µï¼Œå‘ä½ ä»‹ç»äº† Rust æ–°æ¦‚å¿µï¼š`let`ã€`match`ã€æ–¹æ³•ã€å…³è”å‡½æ•°ã€ä½¿ç”¨å¤–éƒ¨ crate ç­‰ç­‰ï¼Œæ¥ä¸‹æ¥çš„å‡ ç« ï¼Œä½ ä¼šç»§ç»­æ·±å…¥å­¦ä¹ è¿™äº›æ¦‚å¿µã€‚ç¬¬ä¸‰ç« ä»‹ç»å¤§éƒ¨åˆ†ç¼–ç¨‹è¯­è¨€éƒ½æœ‰çš„æ¦‚å¿µï¼Œæ¯”å¦‚å˜é‡ã€æ•°æ®ç±»å‹å’Œå‡½æ•°ï¼Œä»¥åŠå¦‚ä½•åœ¨ Rust ä¸­ä½¿ç”¨å®ƒä»¬ã€‚ç¬¬å››ç« æ¢ç´¢æ‰€æœ‰æƒï¼ˆownershipï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ª Rust åŒå…¶ä»–è¯­è¨€å¤§ä¸ç›¸åŒçš„åŠŸèƒ½ã€‚ç¬¬äº”ç« è®¨è®ºç»“æ„ä½“å’Œæ–¹æ³•çš„è¯­æ³•ï¼Œè€Œç¬¬å…­ç« ä¾§é‡è§£é‡Šæšä¸¾ã€‚

[variables-and-mutability]:
ch03-01-variables-and-mutability.html#variables-and-mutability