# å†™ä¸ªçŒœæ•°å­—æ¸¸æˆ

> [ch02-00-guessing-game-tutorial.md](https://github.com/rust-lang/book/blob/main/src/ch02-00-guessing-game-tutorial.md)
> <br>
> commit 11ca3d508b0a28b03f7d9f16c88726088fafd87e

è®©æˆ‘ä»¬ä¸€èµ·åŠ¨æ‰‹å®Œæˆä¸€ä¸ªé¡¹ç›®æ¥å¿«é€Ÿä¸Šæ‰‹ Rustï¼æœ¬ç« å°†ä»‹ç»ä¸€äº› Rust ä¸­å¸¸è§çš„æ¦‚å¿µï¼Œå¹¶é€šè¿‡çœŸå®çš„ç¨‹åºæ¥å±•ç¤ºå¦‚ä½•è¿ç”¨å®ƒä»¬ã€‚ä½ å°†ä¼šå­¦åˆ° `let`ã€`match`ã€æ–¹æ³•ï¼ˆmethodsï¼‰ã€å…³è”å‡½æ•°ï¼ˆassociated functionsï¼‰ã€å¤–éƒ¨ crate ç­‰çŸ¥è¯†ï¼åç»­ç« èŠ‚ä¼šæ·±å…¥æ¢è®¨è¿™äº›æ¦‚å¿µçš„ç»†èŠ‚ã€‚åœ¨è¿™ä¸€ç« ï¼Œæˆ‘ä»¬å°†ä¸»è¦ç»ƒä¹ åŸºç¡€å†…å®¹ã€‚

æˆ‘ä»¬ä¼šå®ç°ä¸€ä¸ªç»å…¸çš„æ–°æ‰‹ç¼–ç¨‹é—®é¢˜ï¼šçŒœæ•°å­—æ¸¸æˆã€‚æ¸¸æˆçš„è§„åˆ™å¦‚ä¸‹ï¼šç¨‹åºå°†ä¼šç”Ÿæˆä¸€ä¸ª 1 åˆ° 100 ä¹‹é—´çš„éšæœºæ•´æ•°ã€‚ç„¶åæç¤ºç©å®¶è¾“å…¥ä¸€ä¸ªçŒœæµ‹å€¼ã€‚è¾“å…¥åï¼Œç¨‹åºä¼šæŒ‡ç¤ºè¯¥çŒœæµ‹æ˜¯å¤ªä½è¿˜æ˜¯å¤ªé«˜ã€‚å¦‚æœçŒœå¯¹äº†ï¼Œæ¸¸æˆä¼šæ‰“å°ç¥è´ºä¿¡æ¯å¹¶é€€å‡ºã€‚

## å‡†å¤‡ä¸€ä¸ªæ–°é¡¹ç›®

è¦åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼Œè¿›å…¥ç¬¬ä¸€ç« ä¸­åˆ›å»ºçš„ _projects_ ç›®å½•ï¼Œä½¿ç”¨ Cargo æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå¦‚ä¸‹ï¼š

```console
$ cargo new guessing_game
$ cd guessing_game
```

ç¬¬ä¸€ä¸ªå‘½ä»¤ï¼Œ`cargo new`ï¼Œå®ƒè·å–é¡¹ç›®çš„åç§°ï¼ˆ`guessing_game`ï¼‰ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚ç¬¬äºŒä¸ªå‘½ä»¤è¿›å…¥åˆ°æ–°åˆ›å»ºçš„é¡¹ç›®ç›®å½•ã€‚

çœ‹çœ‹ç”Ÿæˆçš„ _Cargo.toml_ æ–‡ä»¶ï¼š

<span class="filename">æ–‡ä»¶åï¼šCargo.toml</span>

```toml
{{#include ../listings/ch02-guessing-game-tutorial/no-listing-01-cargo-new/Cargo.toml}}
```

æ­£å¦‚ç¬¬ä¸€ç« é‚£æ ·ï¼Œ`cargo new` ç”Ÿæˆäº†ä¸€ä¸ª â€œHello, world!â€ ç¨‹åºã€‚æŸ¥çœ‹ _src/main.rs_ æ–‡ä»¶ï¼š

<span class="filename">æ–‡ä»¶åï¼šsrc/main.rs</span>

```rust
{{#rustdoc_include ../listings/ch02-guessing-game-tutorial/no-listing-01-cargo-new/src/main.rs}}
```

ç°åœ¨ä½¿ç”¨ `cargo run` å‘½ä»¤ï¼Œä¸€æ­¥å®Œæˆ â€œHello, world!â€ ç¨‹åºçš„ç¼–è¯‘å’Œè¿è¡Œï¼š

```console
{{#include ../listings/ch02-guessing-game-tutorial/no-listing-01-cargo-new/output.txt}}
```

å½“ä½ éœ€è¦åœ¨é¡¹ç›®ä¸­å¿«é€Ÿè¿­ä»£æ—¶ï¼Œ`run` å‘½ä»¤å°±èƒ½æ´¾ä¸Šç”¨åœºï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨è¿™ä¸ªæ¸¸æˆé¡¹ç›®ä¸­åšçš„ï¼Œåœ¨ä¸‹ä¸€æ¬¡è¿­ä»£ä¹‹å‰å¿«é€Ÿæµ‹è¯•æ¯ä¸€æ¬¡è¿­ä»£ã€‚

é‡æ–°æ‰“å¼€ _src/main.rs_ æ–‡ä»¶ã€‚æˆ‘ä»¬å°†ä¼šåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ç¼–å†™å…¨éƒ¨çš„ä»£ç ã€‚

## å¤„ç†ä¸€æ¬¡çŒœæµ‹

çŒœæ•°å­—ç¨‹åºçš„ç¬¬ä¸€éƒ¨åˆ†è¯·æ±‚å’Œå¤„ç†ç”¨æˆ·è¾“å…¥ï¼Œå¹¶æ£€æŸ¥è¾“å…¥æ˜¯å¦ç¬¦åˆé¢„æœŸçš„æ ¼å¼ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä¼šå…è®¸ç©å®¶è¾“å…¥ä¸€ä¸ªçŒœæµ‹ã€‚åœ¨ _src/main.rs_ ä¸­è¾“å…¥ç¤ºä¾‹ 2-1 ä¸­çš„ä»£ç ã€‚

<figure class="listing">

<span class="file-name">æ–‡ä»¶åï¼šsrc/main.rs</span>

```rust,ignore
{{#rustdoc_include ../listings/ch02-guessing-game-tutorial/listing-02-01/src/main.rs:all}}
```

<figcaption>ç¤ºä¾‹ 2-1ï¼šè·å–ç”¨æˆ·çŒœæµ‹å¹¶æ‰“å°çš„ä»£ç </figcaption>

</figure>

è¿™äº›ä»£ç åŒ…å«å¾ˆå¤šä¿¡æ¯ï¼Œæˆ‘ä»¬ä¸€è¡Œä¸€è¡Œåœ°è¿‡ä¸€éã€‚ä¸ºäº†è·å–ç”¨æˆ·è¾“å…¥å¹¶æ‰“å°ç»“æœä½œä¸ºè¾“å‡ºï¼Œæˆ‘ä»¬éœ€è¦å°† `io` è¾“å…¥/è¾“å‡ºåº“å¼•å…¥å½“å‰ä½œç”¨åŸŸã€‚`io` åº“æ¥è‡ªäºæ ‡å‡†åº“ï¼Œä¹Ÿè¢«ç§°ä¸º `std`ï¼š

```rust,ignore
{{#rustdoc_include ../listings/ch02-guessing-game-tutorial/listing-02-01/src/main.rs:io}}
```

é»˜è®¤æƒ…å†µä¸‹ï¼ŒRust è®¾å®šäº†è‹¥å¹²ä¸ªä¼šè‡ªåŠ¨å¯¼å…¥åˆ°æ¯ä¸ªç¨‹åºä½œç”¨åŸŸä¸­çš„æ ‡å‡†åº“å†…å®¹ï¼Œè¿™ç»„å†…å®¹è¢«ç§°ä¸º *é¢„å¯¼å…¥ï¼ˆpreludeï¼‰* å†…å®¹ã€‚ä½ å¯ä»¥åœ¨[æ ‡å‡†åº“æ–‡æ¡£][prelude]ä¸­æŸ¥çœ‹é¢„å¯¼å…¥çš„æ‰€æœ‰å†…å®¹ã€‚

å¦‚æœä½ éœ€è¦çš„ç±»å‹ä¸åœ¨é¢„å¯¼å…¥å†…å®¹ä¸­ï¼Œå°±å¿…é¡»ä½¿ç”¨ `use` è¯­å¥æ˜¾å¼åœ°å°†å…¶å¼•å…¥ä½œç”¨åŸŸã€‚`std::io` åº“æä¾›å¾ˆå¤šæœ‰ç”¨çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ¥æ”¶ç”¨æˆ·è¾“å…¥çš„åŠŸèƒ½ã€‚

å¦‚ç¬¬ä¸€ç« æ‰€æåŠï¼Œ`main` å‡½æ•°æ˜¯ç¨‹åºçš„å…¥å£ç‚¹ï¼š

```rust,ignore
{{#rustdoc_include ../listings/ch02-guessing-game-tutorial/listing-02-01/src/main.rs:main}}
```

`fn` è¯­æ³•å£°æ˜äº†ä¸€ä¸ªæ–°å‡½æ•°ï¼Œå°æ‹¬å· `()` è¡¨æ˜æ²¡æœ‰å‚æ•°ï¼Œå¤§æ‹¬å· `{` ä½œä¸ºå‡½æ•°ä½“çš„å¼€å§‹ã€‚

ç¬¬ä¸€ç« ä¹ŸæåŠäº† `println!` æ˜¯ä¸€ä¸ªåœ¨å±å¹•ä¸Šæ‰“å°å­—ç¬¦ä¸²çš„å®ï¼š

```rust,ignore
{{#rustdoc_include ../listings/ch02-guessing-game-tutorial/listing-02-01/src/main.rs:print}}
```

è¿™äº›ä»£ç ä»…ä»…æ‰“å°æç¤ºï¼Œä»‹ç»æ¸¸æˆçš„å†…å®¹ç„¶åè¯·æ±‚ç”¨æˆ·è¾“å…¥ã€‚

### ä½¿ç”¨å˜é‡å‚¨å­˜å€¼

æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ª **å˜é‡**ï¼ˆ_variable_ï¼‰æ¥å‚¨å­˜ç”¨æˆ·è¾“å…¥ï¼Œåƒè¿™æ ·ï¼š

```rust,ignore
{{#rustdoc_include ../listings/ch02-guessing-game-tutorial/listing-02-01/src/main.rs:string}}
```

ç°åœ¨ç¨‹åºå¼€å§‹å˜å¾—æœ‰æ„æ€äº†ï¼è¿™ä¸€å°è¡Œä»£ç å‘ç”Ÿäº†å¾ˆå¤šäº‹ã€‚æˆ‘ä»¬ä½¿ç”¨ `let` è¯­å¥æ¥åˆ›å»ºå˜é‡ã€‚è¿™é‡Œæ˜¯å¦å¤–ä¸€ä¸ªä¾‹å­ï¼š

```rust,ignore
let apples = 5;
```

è¿™è¡Œä»£ç æ–°å»ºäº†ä¸€ä¸ªå«åš `apples` çš„å˜é‡å¹¶æŠŠå®ƒç»‘å®šåˆ°å€¼ `5` ä¸Šã€‚åœ¨ Rust ä¸­ï¼Œå˜é‡é»˜è®¤æ˜¯ä¸å¯å˜çš„ï¼Œè¿™æ„å‘³ç€ä¸€æ—¦æˆ‘ä»¬ç»™å˜é‡èµ‹å€¼ï¼Œè¿™ä¸ªå€¼å°±ä¸å†å¯ä»¥ä¿®æ”¹äº†ã€‚æˆ‘ä»¬å°†ä¼šåœ¨ç¬¬ä¸‰ç« çš„ [â€œå˜é‡ä¸å¯å˜æ€§â€][variables-and-mutability] éƒ¨åˆ†è¯¦ç»†è®¨è®ºè¿™ä¸ªæ¦‚å¿µã€‚ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨å˜é‡åå‰ä½¿ç”¨ `mut` æ¥ä½¿ä¸€ä¸ªå˜é‡å¯å˜ï¼š

```rust,ignore
let apples = 5; // ä¸å¯å˜
let mut bananas = 5; // å¯å˜
```

> æ³¨æ„ï¼š`//` è¯­æ³•å¼€å§‹ä¸€ä¸ªæ³¨é‡Šï¼ŒæŒç»­åˆ°è¡Œå°¾ã€‚Rust å¿½ç•¥æ³¨é‡Šä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œ[ç¬¬ä¸‰ç« ][comments]å°†ä¼šè¯¦ç»†ä»‹ç»æ³¨é‡Šã€‚

å›åˆ°çŒœæ•°å­—ç¨‹åºä¸­ã€‚ç°åœ¨æˆ‘ä»¬çŸ¥é“äº† `let mut guess` ä¼šå¼•å…¥ä¸€ä¸ªå«åš `guess` çš„å¯å˜å˜é‡ã€‚ç­‰å·ï¼ˆ`=`ï¼‰å‘Šè¯‰ Rust æˆ‘ä»¬ç°åœ¨æƒ³å°†æŸä¸ªå€¼ç»‘å®šåœ¨å˜é‡ä¸Šã€‚ç­‰å·çš„å³è¾¹æ˜¯ `guess` æ‰€ç»‘å®šçš„å€¼ï¼Œå®ƒæ˜¯ `String::new` çš„ç»“æœï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¿”å›ä¸€ä¸ª `String` çš„æ–°å®ä¾‹ã€‚[`String`][string]<!-- ignore --> æ˜¯ä¸€ä¸ªæ ‡å‡†åº“æä¾›çš„å­—ç¬¦ä¸²ç±»å‹ï¼Œå®ƒæ˜¯ UTF-8 ç¼–ç çš„å¯å¢é•¿æ–‡æœ¬å—ã€‚

`::new` é‚£ä¸€è¡Œçš„ `::` è¯­æ³•è¡¨æ˜ `new` æ˜¯ `String` ç±»å‹çš„ä¸€ä¸ª **å…³è”å‡½æ•°**ï¼ˆ_associated function_ï¼‰ã€‚å…³è”å‡½æ•°æ˜¯é’ˆå¯¹æŸä¸ªç±»å‹å®ç°çš„å‡½æ•°ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ `String`ã€‚è¿™ä¸ª `new` å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç©ºå­—ç¬¦ä¸²ã€‚ä½ ä¼šå‘ç°è®¸å¤šç±»å‹ä¸Šéƒ½æœ‰ä¸€ä¸ª `new` å‡½æ•°ï¼Œå› ä¸ºè¿™æ˜¯ä¸ºæŸç§ç±»å‹åˆ›å»ºæ–°å€¼çš„å¸¸ç”¨å‡½æ•°åã€‚

æ€»çš„æ¥è¯´ï¼Œ`let mut guess = String::new();` è¿™ä¸€è¡Œåˆ›å»ºäº†ä¸€ä¸ªå¯å˜å˜é‡ï¼Œå½“å‰å®ƒç»‘å®šåˆ°ä¸€ä¸ªæ–°çš„ `String` ç©ºå®ä¾‹ä¸Šã€‚

### æ¥æ”¶ç”¨æˆ·è¾“å…¥

å›å¿†ä¸€ä¸‹ï¼Œæˆ‘ä»¬åœ¨ç¨‹åºçš„ç¬¬ä¸€è¡Œä½¿ç”¨ `use std::io;` ä»æ ‡å‡†åº“ä¸­å¼•å…¥äº†è¾“å…¥/è¾“å‡ºåŠŸèƒ½ã€‚ç°åœ¨è°ƒç”¨ `io` åº“ä¸­çš„å‡½æ•° `stdin`ï¼Œè¿™å…è®¸æˆ‘ä»¬å¤„ç†ç”¨æˆ·è¾“å…¥ï¼š

```rust,ignore
{{#rustdoc_include ../listings/ch02-guessing-game-tutorial/listing-02-01/src/main.rs:read}}
```

å¦‚æœç¨‹åºçš„å¼€å¤´æ²¡æœ‰ä½¿ç”¨ `use std::io;` å¼•å…¥ `io` åº“ï¼Œæˆ‘ä»¬ä»å¯ä»¥é€šè¿‡æŠŠå‡½æ•°è°ƒç”¨å†™æˆ `std::io::stdin` æ¥ä½¿ç”¨è¯¥å‡½æ•°ã€‚`stdin` å‡½æ•°è¿”å›ä¸€ä¸ª [`std::io::Stdin`][iostdin]<!-- ignore --> çš„å®ä¾‹ï¼Œè¿™æ˜¯ä¸€ç§ä»£è¡¨ç»ˆç«¯æ ‡å‡†è¾“å…¥å¥æŸ„çš„ç±»å‹ã€‚

æ¥ä¸‹æ¥ï¼Œä»£ç ä¸­çš„ `.read_line(&mut guess)` è°ƒç”¨äº†æ ‡å‡†è¾“å…¥å¥æŸ„ä¸Šçš„ [`read_line`][read_line]<!-- ignore --> æ–¹æ³•ï¼Œä»¥è·å–ç”¨æˆ·è¾“å…¥ã€‚æˆ‘ä»¬è¿˜å°† `&mut guess` ä½œä¸ºå‚æ•°ä¼ é€’ç»™ `read_line` å‡½æ•°ï¼Œè®©å…¶å°†ç”¨æˆ·è¾“å…¥å‚¨å­˜åˆ°è¿™ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚`read_line` çš„å·¥ä½œæ˜¯ï¼Œæ— è®ºç”¨æˆ·åœ¨æ ‡å‡†è¾“å…¥ä¸­é”®å…¥ä»€ä¹ˆå†…å®¹ï¼Œéƒ½å°†å…¶è¿½åŠ ï¼ˆä¸ä¼šè¦†ç›–å…¶åŸæœ‰å†…å®¹ï¼‰åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œå› æ­¤å®ƒéœ€è¦å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ã€‚è¿™ä¸ªå­—ç¬¦ä¸²å‚æ•°åº”è¯¥æ˜¯å¯å˜çš„ï¼Œä»¥ä¾¿ `read_line` å°†ç”¨æˆ·è¾“å…¥é™„åŠ ä¸Šå»ã€‚

`&` è¡¨ç¤ºè¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª **å¼•ç”¨**ï¼ˆ_reference_ï¼‰ï¼Œå®ƒå…è®¸å¤šå¤„ä»£ç è®¿é—®åŒä¸€å¤„æ•°æ®ï¼Œè€Œæ— éœ€åœ¨å†…å­˜ä¸­å¤šæ¬¡æ‹·è´ã€‚å¼•ç”¨æ˜¯ä¸€ä¸ªå¤æ‚çš„ç‰¹æ€§ï¼ŒRust çš„ä¸€ä¸ªä¸»è¦ä¼˜åŠ¿å°±æ˜¯å®‰å…¨è€Œç®€å•çš„æ“çºµå¼•ç”¨ã€‚å®Œæˆå½“å‰ç¨‹åºå¹¶ä¸éœ€è¦äº†è§£å¦‚æ­¤å¤šç»†èŠ‚ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬åªéœ€çŸ¥é“å®ƒåƒå˜é‡ä¸€æ ·ï¼Œé»˜è®¤æ˜¯ä¸å¯å˜çš„ã€‚å› æ­¤ï¼Œéœ€è¦å†™æˆ `&mut guess` æ¥ä½¿å…¶å¯å˜ï¼Œè€Œä¸æ˜¯ `&guess`ã€‚ï¼ˆç¬¬å››ç« ä¼šæ›´å…¨é¢çš„è§£é‡Šå¼•ç”¨ã€‚ï¼‰

### ä½¿ç”¨ `Result` ç±»å‹æ¥å¤„ç†æ½œåœ¨çš„é”™è¯¯

æˆ‘ä»¬è¿˜æ²¡æœ‰å®Œå…¨åˆ†æå®Œè¿™è¡Œä»£ç ã€‚è™½ç„¶æˆ‘ä»¬å·²ç»è®²åˆ°äº†ç¬¬ä¸‰è¡Œä»£ç ï¼Œä½†è¦æ³¨æ„ï¼šå®ƒä»æ˜¯é€»è¾‘è¡Œï¼ˆè™½ç„¶æ¢è¡Œäº†ä½†ä»æ˜¯è¯­å¥ï¼‰çš„ä¸€éƒ¨åˆ†ã€‚åä¸€éƒ¨åˆ†æ˜¯è¿™ä¸ªæ–¹æ³•ï¼ˆmethodï¼‰ï¼š

```rust,ignore
{{#rustdoc_include ../listings/ch02-guessing-game-tutorial/listing-02-01/src/main.rs:expect}}
```

æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ä»£ç è¿™æ ·å†™ï¼š

```rust,ignore
io::stdin().read_line(&mut guess).expect("Failed to read line");
```

ä¸è¿‡ï¼Œè¿‡é•¿çš„ä»£ç è¡Œéš¾ä»¥é˜…è¯»ï¼Œæ‰€ä»¥æœ€å¥½æ‹†å¼€æ¥å†™ã€‚é€šå¸¸æ¥è¯´ï¼Œå½“ä½¿ç”¨ `.method_name()` è¯­æ³•è°ƒç”¨æ–¹æ³•æ—¶å¼•å…¥æ¢è¡Œç¬¦å’Œç©ºæ ¼å°†é•¿çš„ä»£ç è¡Œæ‹†å¼€æ˜¯æ˜æ™ºçš„ã€‚ç°åœ¨æ¥çœ‹çœ‹è¿™è¡Œä»£ç å¹²äº†ä»€ä¹ˆã€‚

ä¹‹å‰æåˆ°äº† `read_line` ä¼šå°†ç”¨æˆ·è¾“å…¥é™„åŠ åˆ°ä¼ é€’ç»™å®ƒçš„å­—ç¬¦ä¸²ä¸­ï¼Œä¸è¿‡å®ƒä¹Ÿä¼šè¿”å›ä¸€ä¸ªç±»å‹ä¸º `Result` çš„å€¼ã€‚
[`Result`][result]<!-- ignore --> æ˜¯ä¸€ç§[*æšä¸¾ç±»å‹*][enums]<!-- ignore -->ï¼Œé€šå¸¸ä¹Ÿå†™ä½œ *enum*ã€‚æšä¸¾ç±»å‹å˜é‡çš„å€¼å¯ä»¥æ˜¯å¤šç§å¯èƒ½çŠ¶æ€ä¸­çš„ä¸€ä¸ªã€‚æˆ‘ä»¬æŠŠæ¯ç§å¯èƒ½çš„çŠ¶æ€ç§°ä¸ºä¸€ç§ *æšä¸¾æˆå‘˜ï¼ˆvariantï¼‰*ã€‚

[ç¬¬å…­ç« ][enums]å°†ä»‹ç»æšä¸¾çš„æ›´å¤šç»†èŠ‚ã€‚è¿™é‡Œçš„ `Result` ç±»å‹å°†ç”¨æ¥ç¼–ç é”™è¯¯å¤„ç†çš„ä¿¡æ¯ã€‚

`Result` çš„æˆå‘˜æ˜¯ `Ok` å’Œ `Err`ï¼Œ`Ok` æˆå‘˜è¡¨ç¤ºæ“ä½œæˆåŠŸï¼Œå†…éƒ¨åŒ…å«æˆåŠŸæ—¶äº§ç”Ÿçš„å€¼ã€‚`Err` æˆå‘˜åˆ™æ„å‘³ç€æ“ä½œå¤±è´¥ï¼Œå¹¶ä¸” `Err` ä¸­åŒ…å«æœ‰å…³æ“ä½œå¤±è´¥çš„åŸå› æˆ–æ–¹å¼çš„ä¿¡æ¯ã€‚

è¿™äº› `Result` ç±»å‹çš„ä½œç”¨æ˜¯ç¼–ç é”™è¯¯å¤„ç†ä¿¡æ¯ã€‚`Result` ç±»å‹çš„å€¼ï¼Œåƒå…¶ä»–ç±»å‹ä¸€æ ·ï¼Œæ‹¥æœ‰å®šä¹‰äºå…¶å®ä¾‹ä¸Šçš„æ–¹æ³•ã€‚`Result` çš„å®ä¾‹æ‹¥æœ‰ [`expect` æ–¹æ³•][expect]<!-- ignore -->ã€‚å¦‚æœ `io::Result` å®ä¾‹çš„å€¼æ˜¯ `Err`ï¼Œ`expect` ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼Œå¹¶è¾“å‡ºå½“åšå‚æ•°ä¼ é€’ç»™ `expect` çš„ä¿¡æ¯ã€‚æ‰€ä»¥å½“ `read_line` æ–¹æ³•è¿”å› `Err`ï¼Œåˆ™å¯èƒ½æ˜¯æ¥æºäºåº•å±‚æ“ä½œç³»ç»Ÿé”™è¯¯çš„ç»“æœã€‚å¦‚æœ `Result` å®ä¾‹çš„å€¼æ˜¯ `Ok`ï¼Œ`expect` ä¼šè·å– `Ok` ä¸­çš„å€¼å¹¶åŸæ ·è¿”å›ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè¿™ä¸ªå€¼æ˜¯ç”¨æˆ·è¾“å…¥åˆ°æ ‡å‡†è¾“å…¥ä¸­çš„å­—èŠ‚æ•°ã€‚

å¦‚æœä¸è°ƒç”¨ `expect`ï¼Œç¨‹åºä¹Ÿèƒ½ç¼–è¯‘ï¼Œä¸è¿‡ä¼šå‡ºç°ä¸€ä¸ªè­¦å‘Šï¼š

```console
{{#include ../listings/ch02-guessing-game-tutorial/no-listing-02-without-expect/output.txt}}
```

Rust è­¦å‘Šæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ `read_line` çš„è¿”å›å€¼ `Result`ï¼Œè¯´æ˜æœ‰ä¸€ä¸ªå¯èƒ½çš„é”™è¯¯æ²¡æœ‰å¤„ç†ã€‚

æ¶ˆé™¤è­¦å‘Šçš„æ­£ç¡®åšæ³•æ˜¯å®é™…å»ç¼–å†™é”™è¯¯å¤„ç†ä»£ç ï¼Œä¸è¿‡ç”±äºæˆ‘ä»¬å°±æ˜¯å¸Œæœ›ç¨‹åºåœ¨å‡ºç°é—®é¢˜æ—¶ç«‹å³å´©æºƒï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨ `expect`ã€‚[ç¬¬ä¹ç« ][recover] ä¼šå­¦ä¹ å¦‚ä½•ä»é”™è¯¯ä¸­æ¢å¤ã€‚

### ä½¿ç”¨ `println!` å ä½ç¬¦æ‰“å°å€¼

é™¤äº†ä½äºç»“å°¾çš„å³èŠ±æ‹¬å·ï¼Œç›®å‰ä¸ºæ­¢å°±åªæœ‰è¿™ä¸€è¡Œä»£ç å€¼å¾—è®¨è®ºä¸€ä¸‹äº†ï¼Œå°±æ˜¯è¿™ä¸€è¡Œï¼š

```rust,ignore
{{#rustdoc_include ../listings/ch02-guessing-game-tutorial/listing-02-01/src/main.rs:print_guess}}
```

è¿™è¡Œä»£ç ç°åœ¨æ‰“å°äº†å­˜å‚¨ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²ã€‚`{}` è¿™å¯¹å¤§æ‹¬å·æ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼šæŠŠ `{}` æƒ³è±¡æˆå°èŸ¹é’³ï¼Œå¯ä»¥å¤¹ä½åˆé€‚çš„å€¼ã€‚å½“æ‰“å°å˜é‡çš„å€¼æ—¶ï¼Œå˜é‡åå¯ä»¥å†™è¿›å¤§æ‹¬å·ä¸­ã€‚å½“æ‰“å°è¡¨è¾¾å¼çš„æ‰§è¡Œç»“æœæ—¶ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼ˆformat stringï¼‰ä¸­å¤§æ‹¬å·ä¸­ç•™ç©ºï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²åè·Ÿé€—å·åˆ†éš”çš„éœ€è¦æ‰“å°çš„è¡¨è¾¾å¼åˆ—è¡¨ï¼Œå…¶é¡ºåºä¸æ¯ä¸€ä¸ªç©ºå¤§æ‹¬å·å ä½ç¬¦çš„é¡ºåºä¸€è‡´ã€‚åœ¨ä¸€ä¸ª `println!` è°ƒç”¨ä¸­æ‰“å°å˜é‡å’Œè¡¨è¾¾å¼çš„å€¼çœ‹èµ·æ¥åƒè¿™æ ·ï¼š

```rust
let x = 5;
let y = 10;

println!("x = {x} and y + 2 = {}", y + 2);
```

è¿™è¡Œä»£ç ä¼šæ‰“å°å‡º `x = 5 and y + 2 = 12`ã€‚

### æµ‹è¯•ç¬¬ä¸€éƒ¨åˆ†ä»£ç 

è®©æˆ‘ä»¬æ¥æµ‹è¯•ä¸‹çŒœæ•°å­—æ¸¸æˆçš„ç¬¬ä¸€éƒ¨åˆ†ã€‚ä½¿ç”¨ `cargo run` è¿è¡Œï¼š

```console
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 6.44s
     Running `target/debug/guessing_game`
Guess the number!
Please input your guess.
6
You guessed: 6
```

è‡³æ­¤ä¸ºæ­¢ï¼Œæ¸¸æˆçš„ç¬¬ä¸€éƒ¨åˆ†å·²ç»å®Œæˆï¼šæˆ‘ä»¬ä»é”®ç›˜è·å–è¾“å…¥å¹¶æ‰“å°äº†å‡ºæ¥ã€‚

## ç”Ÿæˆä¸€ä¸ªç§˜å¯†æ•°å­—

æ¥ä¸‹æ¥ï¼Œéœ€è¦ç”Ÿæˆä¸€ä¸ªç§˜å¯†æ•°å­—ï¼Œå¥½è®©ç”¨æˆ·æ¥çŒœã€‚ç§˜å¯†æ•°å­—åº”è¯¥æ¯æ¬¡éƒ½ä¸åŒï¼Œè¿™æ ·é‡å¤ç©æ‰ä¸ä¼šä¹å‘³ï¼›èŒƒå›´åº”è¯¥åœ¨ 1 åˆ° 100 ä¹‹é—´ï¼Œè¿™æ ·æ‰ä¸ä¼šå¤ªå›°éš¾ã€‚Rust æ ‡å‡†åº“ä¸­å°šæœªåŒ…å«éšæœºæ•°åŠŸèƒ½ã€‚ç„¶è€Œï¼ŒRust å›¢é˜Ÿè¿˜æ˜¯æä¾›äº†ä¸€ä¸ªåŒ…å«ä¸Šè¿°åŠŸèƒ½çš„ [`rand` crate][randcrate]ã€‚

### ä½¿ç”¨ crate æ¥å¢åŠ æ›´å¤šåŠŸèƒ½

è®°ä½ï¼Œcrate æ˜¯ä¸€ç»„ Rust æºä»£ç æ–‡ä»¶ã€‚æˆ‘ä»¬æ­£åœ¨æ„å»ºçš„é¡¹ç›®æ˜¯ä¸€ä¸ª *äºŒè¿›åˆ¶ crate*ï¼Œå®ƒç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚ `rand` crate æ˜¯ä¸€ä¸ª *åº“ crate*ï¼Œåº“ crate å¯ä»¥åŒ…å«ä»»æ„èƒ½è¢«å…¶ä»–ç¨‹åºä½¿ç”¨çš„ä»£ç ï¼Œä½†æ˜¯æ— æ³•ç‹¬ç«‹æ‰§è¡Œã€‚

Cargo å¯¹å¤–éƒ¨ crate çš„è¿ç”¨æ˜¯å…¶çœŸæ­£çš„äº®ç‚¹æ‰€åœ¨ã€‚åœ¨æˆ‘ä»¬ä½¿ç”¨ `rand` ç¼–å†™ä»£ç ä¹‹å‰ï¼Œéœ€è¦ä¿®æ”¹ *Cargo.toml* æ–‡ä»¶ï¼Œå¼•å…¥ä¸€ä¸ª `rand` ä¾èµ–ã€‚ç°åœ¨æ‰“å¼€è¿™ä¸ªæ–‡ä»¶å¹¶å°†ä¸‹é¢è¿™ä¸€è¡Œæ·»åŠ åˆ° `[dependencies]` ç‰‡æ®µæ ‡é¢˜ä¹‹ä¸‹ã€‚åœ¨å½“å‰ç‰ˆæœ¬ä¸‹ï¼Œè¯·ç¡®ä¿æŒ‰ç…§æˆ‘ä»¬è¿™é‡Œçš„æ–¹å¼æŒ‡å®š `rand`ï¼Œå¦åˆ™æœ¬æ•™ç¨‹ä¸­çš„ç¤ºä¾‹ä»£ç å¯èƒ½æ— æ³•å·¥ä½œã€‚

<span class="filename">æ–‡ä»¶åï¼šCargo.toml</span>

```toml
{{#include ../listings/ch02-guessing-game-tutorial/listing-02-02/Cargo.toml:8:}}
```

åœ¨ _Cargo.toml_ æ–‡ä»¶ä¸­ï¼Œæ ‡é¢˜ä»¥åŠä¹‹åçš„å†…å®¹å±åŒä¸€ä¸ªç‰‡æ®µï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ªæ ‡é¢˜æ‰å¼€å§‹æ–°çš„ç‰‡æ®µã€‚`[dependencies]` ç‰‡æ®µå‘Šè¯‰ Cargo æœ¬é¡¹ç›®ä¾èµ–äº†å“ªäº›å¤–éƒ¨ crate åŠå…¶ç‰ˆæœ¬ã€‚æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬ `0.8.5` æ¥æŒ‡å®š `rand` crateã€‚Cargo ç†è§£ [è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆSemantic Versioningï¼‰][semver]<!-- ignore -->ï¼ˆæœ‰æ—¶ä¹Ÿç§°ä¸º _SemVer_ï¼‰ï¼Œè¿™æ˜¯ä¸€ç§å®šä¹‰ç‰ˆæœ¬å·çš„æ ‡å‡†ã€‚`0.8.5` äº‹å®ä¸Šæ˜¯ `^0.8.5` çš„ç®€å†™ï¼Œå®ƒè¡¨ç¤ºä»»ä½•è‡³å°‘æ˜¯ `0.8.5` ä½†å°äº `0.9.0` çš„ç‰ˆæœ¬ã€‚

Cargo è®¤ä¸ºè¿™äº›ç‰ˆæœ¬ä¸ `0.8.5` ç‰ˆæœ¬çš„å…¬æœ‰ API ç›¸å…¼å®¹ï¼Œè¿™æ ·çš„ç‰ˆæœ¬æŒ‡å®šç¡®ä¿äº†æˆ‘ä»¬å¯ä»¥è·å–èƒ½ä½¿æœ¬ç« ä»£ç ç¼–è¯‘çš„æœ€æ–°çš„è¡¥ä¸ï¼ˆpatchï¼‰ç‰ˆæœ¬ã€‚ä»»ä½•å¤§äºç­‰äº `0.9.0` çš„ç‰ˆæœ¬ä¸èƒ½ä¿è¯å’Œæ¥ä¸‹æ¥çš„ç¤ºä¾‹é‡‡ç”¨äº†ç›¸åŒçš„ APIã€‚

ç°åœ¨ï¼Œä¸ä¿®æ”¹ä»»ä½•ä»£ç ï¼Œæ„å»ºé¡¹ç›®ï¼Œå¦‚ç¤ºä¾‹ 2-2 æ‰€ç¤ºã€‚

<figure class="listing">

```console
$ cargo build
    Updating crates.io index
  Downloaded rand v0.8.5
  Downloaded libc v0.2.127
  Downloaded getrandom v0.2.7
  Downloaded cfg-if v1.0.0
  Downloaded ppv-lite86 v0.2.16
  Downloaded rand_chacha v0.3.1
  Downloaded rand_core v0.6.3
   Compiling libc v0.2.127
   Compiling getrandom v0.2.7
   Compiling cfg-if v1.0.0
   Compiling ppv-lite86 v0.2.16
   Compiling rand_core v0.6.3
   Compiling rand_chacha v0.3.1
   Compiling rand v0.8.5
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 2.53s
```

<figcaption>ç¤ºä¾‹ 2-2ï¼šå°† rand crate æ·»åŠ ä¸ºä¾èµ–ä¹‹åè¿è¡Œ `cargo build` çš„è¾“å‡º</figcaption>

</figure>

å¯èƒ½ä¼šå‡ºç°ä¸åŒçš„ç‰ˆæœ¬å·ï¼ˆå¤šäºäº†è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼Œå®ƒä»¬ä¸ä»£ç æ˜¯å…¼å®¹çš„ï¼ï¼‰ï¼Œå¹¶ä¸”æ˜¾ç¤ºçš„è¡Œæ•°å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼ˆå–å†³äºæ“ä½œç³»ç»Ÿï¼‰ï¼Œè¡Œçš„é¡ºåºä¹Ÿå¯èƒ½ä¼šä¸åŒã€‚

ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå¤–éƒ¨ä¾èµ–ï¼ŒCargo ä» _registry_ ä¸Šè·å–æ‰€æœ‰åŒ…çš„æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯ï¼Œè¿™æ˜¯ä¸€ä»½æ¥è‡ª [Crates.io][cratesio] çš„æ•°æ®å‰¯æœ¬ã€‚Crates.io æ˜¯ Rust ç”Ÿæ€ç³»ç»Ÿä¸­ï¼Œäººä»¬å‘å¸ƒå…¶å¼€æº Rust é¡¹ç›®çš„å¹³å°ï¼Œä¾›ä»–äººä½¿ç”¨ã€‚

åœ¨æ›´æ–°å®Œ _registry_ åï¼ŒCargo æ£€æŸ¥ `[dependencies]` ç‰‡æ®µå¹¶ä¸‹è½½åˆ—è¡¨ä¸­åŒ…å«ä½†è¿˜æœªä¸‹è½½çš„ cratesã€‚æœ¬ä¾‹ä¸­ï¼Œè™½ç„¶åªå£°æ˜äº† `rand` ä¸€ä¸ªä¾èµ–ï¼Œç„¶è€Œ Cargo è¿˜æ˜¯é¢å¤–è·å–äº† `rand` æ‰€éœ€è¦çš„å…¶ä»– cratesï¼Œå› ä¸º `rand` ä¾èµ–å®ƒä»¬æ¥æ­£å¸¸å·¥ä½œã€‚ä¸‹è½½å®Œæˆåï¼ŒRust ç¼–è¯‘ä¾èµ–ï¼Œç„¶åä½¿ç”¨è¿™äº›ä¾èµ–ç¼–è¯‘é¡¹ç›®ã€‚

å¦‚æœä¸åšä»»ä½•ä¿®æ”¹ï¼Œç«‹åˆ»å†æ¬¡è¿è¡Œ `cargo build`ï¼Œåˆ™ä¸ä¼šçœ‹åˆ°ä»»ä½•é™¤äº† `Finished` è¡Œä¹‹å¤–çš„è¾“å‡ºã€‚Cargo çŸ¥é“å®ƒå·²ç»ä¸‹è½½å¹¶ç¼–è¯‘äº†ä¾èµ–ï¼ŒåŒæ—¶ _Cargo.toml_ æ–‡ä»¶ä¹Ÿæ²¡æœ‰å˜åŠ¨ã€‚Cargo è¿˜çŸ¥é“ä»£ç ä¹Ÿæ²¡æœ‰ä»»ä½•ä¿®æ”¹ï¼Œæ‰€ä»¥å®ƒä¸ä¼šé‡æ–°ç¼–è¯‘ä»£ç ã€‚å› ä¸ºæ— äº‹å¯åšï¼Œå®ƒä¼šç®€å•åœ°é€€å‡ºã€‚

å¦‚æœæ‰“å¼€ _src/main.rs_ æ–‡ä»¶ï¼Œåšä¸€äº›æ— å…³ç´§è¦çš„ä¿®æ”¹ï¼Œä¿å­˜å¹¶å†æ¬¡æ„å»ºï¼Œåˆ™ä¼šå‡ºç°ä¸¤è¡Œè¾“å‡ºï¼š

```console
$ cargo build
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 2.53 secs
```

è¿™ä¸€è¡Œè¡¨ç¤º Cargo åªé’ˆå¯¹ _src/main.rs_ æ–‡ä»¶çš„å¾®å°ä¿®æ”¹è€Œæ›´æ–°æ„å»ºã€‚ä¾èµ–æ²¡æœ‰å˜åŒ–ï¼Œæ‰€ä»¥ Cargo çŸ¥é“å®ƒå¯ä»¥å¤ç”¨å·²ç»ä¸ºæ­¤ä¸‹è½½å¹¶ç¼–è¯‘çš„ä»£ç ã€‚å®ƒåªæ˜¯é‡æ–°æ„å»ºäº†éƒ¨åˆ†ï¼ˆé¡¹ç›®ï¼‰ä»£ç ã€‚

#### _Cargo.lock_ æ–‡ä»¶ç¡®ä¿æ„å»ºæ˜¯å¯é‡ç°çš„

Cargo æœ‰ä¸€ä¸ªæœºåˆ¶ï¼Œç¡®ä¿æ— è®ºæ˜¯ä½ è¿˜æ˜¯å…¶ä»–äººåœ¨ä»»ä½•æ—¶å€™é‡æ–°æ„å»ºä»£ç ï¼Œéƒ½ä¼šç”Ÿæˆç›¸åŒçš„æ„å»ºäº§ç‰©ï¼šCargo åªä¼šä½¿ç”¨ä½ æŒ‡å®šçš„ä¾èµ–ç‰ˆæœ¬ï¼Œé™¤éä½ æ˜ç¡®æŒ‡å®šå…¶ä»–ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸‹å‘¨ `rand` crate çš„ `0.8.6` ç‰ˆæœ¬å‡ºæ¥äº†ï¼Œè¯¥ç‰ˆæœ¬åŒ…å«äº†ä¸€ä¸ªé‡è¦çš„ bug ä¿®å¤ï¼Œä½†åŒæ—¶ä¹Ÿå¼•å…¥äº†ä¸€ä¸ªä¼šç ´åä½ ä»£ç çš„å›å½’é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRust åœ¨ä½ ç¬¬ä¸€æ¬¡è¿è¡Œ `cargo build` æ—¶åˆ›å»ºäº† *Cargo.lock* æ–‡ä»¶ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨ *guessing_game* ç›®å½•æ‰¾åˆ°å®ƒã€‚

å½“ç¬¬ä¸€æ¬¡æ„å»ºé¡¹ç›®æ—¶ï¼ŒCargo è®¡ç®—å‡ºæ‰€æœ‰ç¬¦åˆè¦æ±‚çš„ä¾èµ–ç‰ˆæœ¬å¹¶å†™å…¥ *Cargo.lock* æ–‡ä»¶ã€‚å½“å°†æ¥æ„å»ºé¡¹ç›®æ—¶ï¼ŒCargo ä¼šå‘ç° *Cargo.lock* å·²å­˜åœ¨å¹¶ä½¿ç”¨å…¶ä¸­æŒ‡å®šçš„ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯å†æ¬¡è®¡ç®—æ‰€æœ‰çš„ç‰ˆæœ¬ã€‚è¿™ä½¿å¾—ä½ æ‹¥æœ‰äº†ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„å¯é‡ç°çš„æ„å»ºã€‚æ¢å¥è¯è¯´ï¼Œé¡¹ç›®ä¼šæŒç»­ä½¿ç”¨ `0.8.5` ç›´åˆ°ä½ æ˜¾å¼å‡çº§ï¼Œå¤šäºæœ‰äº† *Cargo.lock* æ–‡ä»¶ã€‚ç”±äº *Cargo.lock* æ–‡ä»¶å¯¹äºâ€œå¯é‡å¤æ„å»ºâ€éå¸¸é‡è¦ï¼Œå› æ­¤å®ƒé€šå¸¸ä¼šå’Œé¡¹ç›®ä¸­çš„å…¶ä½™ä»£ç ä¸€æ ·çº³å…¥åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ã€‚

#### æ›´æ–° crate åˆ°ä¸€ä¸ªæ–°ç‰ˆæœ¬

å½“ä½  **ç¡®å®** éœ€è¦å‡çº§ crate æ—¶ï¼ŒCargo æä¾›äº†è¿™æ ·ä¸€ä¸ªå‘½ä»¤ï¼Œ`update`ï¼Œå®ƒä¼šå¿½ç•¥ *Cargo.lock* æ–‡ä»¶ï¼Œå¹¶è®¡ç®—å‡ºæ‰€æœ‰ç¬¦åˆ *Cargo.toml* å£°æ˜çš„æœ€æ–°ç‰ˆæœ¬ã€‚Cargo æ¥ä¸‹æ¥ä¼šæŠŠè¿™äº›ç‰ˆæœ¬å†™å…¥ *Cargo.lock* æ–‡ä»¶ã€‚ä¸è¿‡ï¼ŒCargo é»˜è®¤åªä¼šå¯»æ‰¾å¤§äº `0.8.5` è€Œå°äº `0.9.0` çš„ç‰ˆæœ¬ã€‚å¦‚æœ `rand` crate å‘å¸ƒäº†ä¸¤ä¸ªæ–°ç‰ˆæœ¬ï¼Œ`0.8.6` å’Œ `0.9.0`ï¼Œåœ¨è¿è¡Œ `cargo update` æ—¶ä¼šå‡ºç°å¦‚ä¸‹å†…å®¹ï¼š

```console
$ cargo update
    Updating crates.io index
    Updating rand v0.8.5 -> v0.8.6
```

Cargo å¿½ç•¥äº† `0.9.0` ç‰ˆæœ¬ã€‚è¿™æ—¶ï¼Œä½ ä¹Ÿä¼šæ³¨æ„åˆ°çš„ *Cargo.lock* æ–‡ä»¶ä¸­çš„å˜åŒ–æ— å¤–ä¹ç°åœ¨ä½¿ç”¨çš„ `rand` crate ç‰ˆæœ¬æ˜¯`0.8.6` ã€‚å¦‚æœæƒ³è¦ä½¿ç”¨ `0.9.0` ç‰ˆæœ¬çš„ `rand` æˆ–æ˜¯ä»»ä½• `0.9.x` ç³»åˆ—çš„ç‰ˆæœ¬ï¼Œå¿…é¡»åƒè¿™æ ·æ›´æ–° *Cargo.toml* æ–‡ä»¶ï¼š

```toml
[dependencies]
rand = "0.9.0"
```

ä¸‹ä¸€æ¬¡è¿è¡Œ `cargo build` æ—¶ï¼ŒCargo ä¼šæ›´æ–°å¯ç”¨ crate çš„ registryï¼Œå¹¶æ ¹æ®ä½ æŒ‡å®šçš„æ–°ç‰ˆæœ¬é‡æ–°è¯„ä¼° `rand` çš„è¦æ±‚ã€‚

ç¬¬åå››ç« ä¼šè®²åˆ° [Cargo][doccargo]<!-- ignore --> åŠå…¶[ç”Ÿæ€ç³»ç»Ÿ][doccratesio]<!-- ignore --> çš„æ›´å¤šå†…å®¹ï¼Œä¸è¿‡ç›®å‰ä½ åªéœ€è¦äº†è§£è¿™ä¹ˆå¤šã€‚é€šè¿‡ Cargo å¤ç”¨åº“æ–‡ä»¶éå¸¸å®¹æ˜“ï¼Œå› æ­¤ Rustacean èƒ½å¤Ÿç¼–å†™å‡ºç”±å¾ˆå¤šåŒ…ç»„è£…è€Œæˆçš„æ›´è½»å·§çš„é¡¹ç›®ã€‚

### ç”Ÿæˆä¸€ä¸ªéšæœºæ•°

è®©æˆ‘ä»¬å¼€å§‹ä½¿ç”¨ `rand` æ¥ç”Ÿæˆä¸€ä¸ªçŒœæ•°å­—éšæœºæ•°ã€‚ä¸‹ä¸€æ­¥æ˜¯æ›´æ–° *src/main.rs*ï¼Œå¦‚ç¤ºä¾‹ 2-3 æ‰€ç¤ºã€‚

<figure class="listing">

<span class="file-name">æ–‡ä»¶åï¼šsrc/main.rs</span>

```rust,ignore
{{#rustdoc_include ../listings/ch02-guessing-game-tutorial/listing-02-03/src/main.rs:all}}
```

<figcaption>ç¤ºä¾‹ 2-3ï¼šæ·»åŠ ç”Ÿæˆéšæœºæ•°çš„ä»£ç </figcaption>

</figure>

é¦–å…ˆï¼Œæˆ‘ä»¬æ–°å¢äº†ä¸€è¡Œ `use rand::Rng;`ã€‚`Rng` æ˜¯ä¸€ä¸ª traitï¼Œå®ƒå®šä¹‰äº†éšæœºæ•°ç”Ÿæˆå™¨åº”å®ç°çš„æ–¹æ³•ï¼Œæƒ³ä½¿ç”¨è¿™äº›æ–¹æ³•çš„è¯ï¼Œæ­¤ trait å¿…é¡»åœ¨ä½œç”¨åŸŸä¸­ã€‚ç¬¬åç« ä¼šè¯¦ç»†ä»‹ç» traitã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨ä¸­é—´è¿˜æ–°å¢åŠ äº†ä¸¤è¡Œã€‚ç¬¬ä¸€è¡Œè°ƒç”¨äº† `rand::thread_rng` å‡½æ•°æä¾›å®é™…ä½¿ç”¨çš„éšæœºæ•°ç”Ÿæˆå™¨ï¼šå®ƒä½äºå½“å‰æ‰§è¡Œçº¿ç¨‹çš„æœ¬åœ°ç¯å¢ƒä¸­ï¼Œå¹¶ä»æ“ä½œç³»ç»Ÿè·å– seedã€‚æ¥ç€è°ƒç”¨éšæœºæ•°ç”Ÿæˆå™¨çš„ `gen_range` æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ç”± `use rand::Rng` è¯­å¥å¼•å…¥åˆ°ä½œç”¨åŸŸçš„ `Rng` trait å®šä¹‰ã€‚`gen_range` æ–¹æ³•è·å–ä¸€ä¸ªèŒƒå›´è¡¨è¾¾å¼ï¼ˆrange expressionï¼‰ä½œä¸ºå‚æ•°ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªåœ¨æ­¤èŒƒå›´ä¹‹é—´çš„éšæœºæ•°ã€‚è¿™é‡Œä½¿ç”¨çš„è¿™ç±»èŒƒå›´è¡¨è¾¾å¼ä½¿ç”¨äº† `start..=end` è¿™æ ·çš„å½¢å¼ï¼Œä¹Ÿå°±æ˜¯è¯´åŒ…å«äº†ä¸Šä¸‹ç«¯ç‚¹ï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®š `1..=100` æ¥è¯·æ±‚ä¸€ä¸ª 1 å’Œ 100 ä¹‹é—´çš„æ•°ã€‚

> æ³¨æ„ï¼šä½ ä¸å¯èƒ½å‡­ç©ºå°±çŸ¥é“åº”è¯¥ use å“ªä¸ª trait ä»¥åŠè¯¥ä» crate ä¸­è°ƒç”¨å“ªä¸ªæ–¹æ³•ï¼Œå› æ­¤æ¯ä¸ª crate æœ‰ä½¿ç”¨è¯´æ˜æ–‡æ¡£ã€‚Cargo æœ‰ä¸€ä¸ªå¾ˆæ£’çš„åŠŸèƒ½æ˜¯ï¼šè¿è¡Œ `cargo doc --open` å‘½ä»¤æ¥æ„å»ºæ‰€æœ‰æœ¬åœ°ä¾èµ–æä¾›çš„æ–‡æ¡£ï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ å¯¹ `rand` crate ä¸­çš„å…¶ä»–åŠŸèƒ½æ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥è¿è¡Œ `cargo doc --open` å¹¶ç‚¹å‡»å·¦ä¾§å¯¼èˆªæ ä¸­çš„ `rand`ã€‚

æ–°å¢åŠ çš„ç¬¬äºŒè¡Œä»£ç æ‰“å°å‡ºäº†ç§˜å¯†æ•°å­—ã€‚è¿™åœ¨å¼€å‘ç¨‹åºæ—¶å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå¯ä»¥æµ‹è¯•å®ƒï¼Œä¸è¿‡åœ¨æœ€ç»ˆç‰ˆæœ¬ä¸­ä¼šåˆ æ‰å®ƒã€‚å¦‚æœæ¸¸æˆä¸€å¼€å§‹å°±æ‰“å°å‡ºç»“æœå°±æ²¡ä»€ä¹ˆå¯ç©çš„äº†ï¼

å°è¯•è¿è¡Œç¨‹åºå‡ æ¬¡ï¼š

```console
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 2.53s
     Running `target/debug/guessing_game`
Guess the number!
The secret number is: 7
Please input your guess.
4
You guessed: 4

$ cargo run
    Finished dev [unoptimized + debuginfo] target(s) in 0.02s
     Running `target/debug/guessing_game`
Guess the number!
The secret number is: 83
Please input your guess.
5
You guessed: 5
```

ä½ åº”è¯¥èƒ½å¾—åˆ°ä¸åŒçš„éšæœºæ•°ï¼ŒåŒæ—¶å®ƒä»¬åº”è¯¥éƒ½æ˜¯åœ¨ 1 å’Œ 100 ä¹‹é—´çš„ã€‚å¹²å¾—æ¼‚äº®ï¼

## æ¯”è¾ƒçŒœæµ‹çš„æ•°å­—å’Œç§˜å¯†æ•°å­—

ç°åœ¨æœ‰äº†ç”¨æˆ·è¾“å…¥å’Œä¸€ä¸ªéšæœºæ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ¯”è¾ƒå®ƒä»¬ã€‚è¿™ä¸ªæ­¥éª¤å¦‚ç¤ºä¾‹ 2-4 æ‰€ç¤ºã€‚æ³¨æ„è¿™æ®µä»£ç è¿˜ä¸èƒ½é€šè¿‡ç¼–è¯‘ï¼Œæˆ‘ä»¬ç¨åä¼šè§£é‡Šã€‚

<figure class="listing">

<span class="file-name">æ–‡ä»¶åï¼šsrc/main.rs</span>

```rust,ignore,does_not_compile
{{#rustdoc_include ../listings/ch02-guessing-game-tutorial/listing-02-04/src/main.rs:here}}
```

<figcaption>ç¤ºä¾‹ 2-4ï¼šå¤„ç†æ¯”è¾ƒä¸¤ä¸ªæ•°å­—å¯èƒ½çš„è¿”å›å€¼</figcaption>

</figure>

é¦–å…ˆæˆ‘ä»¬å¢åŠ äº†å¦ä¸€ä¸ª `use` å£°æ˜ï¼Œä»æ ‡å‡†åº“å¼•å…¥äº†ä¸€ä¸ªå«åš `std::cmp::Ordering` çš„ç±»å‹åˆ°ä½œç”¨åŸŸä¸­ã€‚ `Ordering` ä¹Ÿæ˜¯ä¸€ä¸ªæšä¸¾ï¼Œä¸è¿‡å®ƒçš„æˆå‘˜æ˜¯ `Less`ã€`Greater` å’Œ `Equal`ã€‚è¿™æ˜¯æ¯”è¾ƒä¸¤ä¸ªå€¼æ—¶å¯èƒ½å‡ºç°çš„ä¸‰ç§ç»“æœã€‚

æ¥ç€ï¼Œåº•éƒ¨çš„äº”è¡Œæ–°ä»£ç ä½¿ç”¨äº† `Ordering` ç±»å‹ï¼Œ`cmp` æ–¹æ³•ç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªå€¼å¹¶å¯ä»¥åœ¨ä»»ä½•å¯æ¯”è¾ƒçš„å€¼ä¸Šè°ƒç”¨ã€‚å®ƒè·å–ä¸€ä¸ªè¢«æ¯”è¾ƒå€¼çš„å¼•ç”¨ï¼šè¿™é‡Œæ˜¯æŠŠ `guess` ä¸ `secret_number` åšæ¯”è¾ƒã€‚ç„¶åå®ƒä¼šè¿”å›ä¸€ä¸ªåˆšæ‰é€šè¿‡ `use` å¼•å…¥ä½œç”¨åŸŸçš„ `Ordering` æšä¸¾çš„æˆå‘˜ã€‚ä½¿ç”¨ä¸€ä¸ª [`match`][match]<!-- ignore --> è¡¨è¾¾å¼ï¼Œæ ¹æ®å¯¹ `guess` å’Œ `secret_number` è°ƒç”¨ `cmp` è¿”å›çš„ `Ordering` æˆå‘˜æ¥å†³å®šæ¥ä¸‹æ¥åšä»€ä¹ˆã€‚

ä¸€ä¸ª `match` è¡¨è¾¾å¼ç”± **åˆ†æ”¯ï¼ˆarmsï¼‰** æ„æˆã€‚ä¸€ä¸ªåˆ†æ”¯åŒ…å«ä¸€ä¸ª **æ¨¡å¼**ï¼ˆ*pattern*ï¼‰å’Œè¡¨è¾¾å¼å¼€å¤´çš„å€¼ä¸åˆ†æ”¯æ¨¡å¼ç›¸åŒ¹é…æ—¶åº”è¯¥æ‰§è¡Œçš„ä»£ç ã€‚Rust è·å–æä¾›ç»™ `match` çš„å€¼å¹¶æŒ¨ä¸ªæ£€æŸ¥æ¯ä¸ªåˆ†æ”¯çš„æ¨¡å¼ã€‚`match` ç»“æ„å’Œæ¨¡å¼æ˜¯ Rust ä¸­å¼ºå¤§çš„åŠŸèƒ½ï¼Œå®ƒä½“ç°äº†ä»£ç å¯èƒ½é‡åˆ°çš„å¤šç§æƒ…å½¢ï¼Œå¹¶å¸®åŠ©ä½ ç¡®ä¿æ²¡æœ‰é—æ¼å¤„ç†ã€‚è¿™äº›åŠŸèƒ½å°†åˆ†åˆ«åœ¨ç¬¬å…­ç« å’Œç¬¬åä¹ç« è¯¦ç»†ä»‹ç»ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹ä½¿ç”¨ `match` è¡¨è¾¾å¼çš„ä¾‹å­ã€‚å‡è®¾ç”¨æˆ·çŒœäº† 50ï¼Œè¿™æ—¶éšæœºç”Ÿæˆçš„ç§˜å¯†æ•°å­—æ˜¯ 38ã€‚

æ¯”è¾ƒ 50 ä¸ 38 æ—¶ï¼Œå› ä¸º 50 æ¯” 38 è¦å¤§ï¼Œ`cmp` æ–¹æ³•ä¼šè¿”å› `Ordering::Greater`ã€‚`Ordering::Greater` æ˜¯ `match` è¡¨è¾¾å¼å¾—åˆ°çš„å€¼ã€‚å®ƒæ£€æŸ¥ç¬¬ä¸€ä¸ªåˆ†æ”¯çš„æ¨¡å¼ï¼Œ`Ordering::Less` ä¸ `Ordering::Greater`å¹¶ä¸åŒ¹é…ï¼Œæ‰€ä»¥å®ƒå¿½ç•¥äº†è¿™ä¸ªåˆ†æ”¯çš„ä»£ç å¹¶æ¥åˆ°ä¸‹ä¸€ä¸ªåˆ†æ”¯ã€‚ä¸‹ä¸€ä¸ªåˆ†æ”¯çš„æ¨¡å¼æ˜¯ `Ordering::Greater`ï¼Œ**æ­£ç¡®** åŒ¹é…ï¼è¿™ä¸ªåˆ†æ”¯å…³è”çš„ä»£ç è¢«æ‰§è¡Œï¼Œåœ¨å±å¹•æ‰“å°å‡º `Too big!`ã€‚`match` è¡¨è¾¾å¼ä¼šåœ¨ç¬¬ä¸€æ¬¡æˆåŠŸåŒ¹é…åç»ˆæ­¢ï¼Œå› ä¸ºè¯¥åœºæ™¯ä¸‹æ²¡æœ‰æ£€æŸ¥æœ€åä¸€ä¸ªåˆ†æ”¯çš„å¿…è¦ã€‚

ç„¶è€Œï¼Œç¤ºä¾‹ 2-4 çš„ä»£ç ç›®å‰å¹¶ä¸èƒ½ç¼–è¯‘ï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹ï¼š

```console
{{#include ../listings/ch02-guessing-game-tutorial/listing-02-04/output.txt}}
```

é”™è¯¯çš„æ ¸å¿ƒè¡¨æ˜è¿™é‡Œæœ‰ **ä¸åŒ¹é…çš„ç±»å‹**ï¼ˆ_mismatched types_ï¼‰ã€‚Rust æœ‰ä¸€ä¸ªé™æ€å¼ºç±»å‹ç³»ç»Ÿï¼ŒåŒæ—¶ä¹Ÿæœ‰ç±»å‹æ¨æ–­ã€‚å½“æˆ‘ä»¬å†™å‡º `let guess = String::new()` æ—¶ï¼ŒRust æ¨æ–­å‡º `guess` åº”è¯¥æ˜¯ `String` ç±»å‹ï¼Œå¹¶ä¸éœ€è¦æˆ‘ä»¬å†™å‡ºç±»å‹ã€‚å¦ä¸€æ–¹é¢ï¼Œ`secret_number`ï¼Œæ˜¯æ•°å­—ç±»å‹ã€‚å‡ ä¸ªæ•°å­—ç±»å‹æ‹¥æœ‰ 1 åˆ° 100 ä¹‹é—´çš„å€¼ï¼š32 ä½æ•°å­— `i32`ï¼›32 ä½æ— ç¬¦å·æ•°å­— `u32`ï¼›64 ä½æ•°å­— `i64` ç­‰ç­‰ã€‚Rust é»˜è®¤ä½¿ç”¨ `i32`ï¼Œæ‰€ä»¥å®ƒæ˜¯ `secret_number` çš„ç±»å‹ï¼Œé™¤éå¢åŠ ç±»å‹ä¿¡æ¯ï¼Œæˆ–ä»»ä½•èƒ½è®© Rust æ¨æ–­å‡ºä¸åŒæ•°å€¼ç±»å‹çš„ä¿¡æ¯ã€‚è¿™é‡Œé”™è¯¯çš„åŸå› åœ¨äº Rust ä¸ä¼šæ¯”è¾ƒå­—ç¬¦ä¸²ç±»å‹å’Œæ•°å­—ç±»å‹ã€‚

æ‰€ä»¥æˆ‘ä»¬å¿…é¡»æŠŠä»è¾“å…¥ä¸­è¯»å–åˆ°çš„ `String` è½¬æ¢ä¸ºä¸€ä¸ªçœŸæ­£çš„æ•°å­—ç±»å‹ï¼Œæ‰å¥½ä¸ç§˜å¯†æ•°å­—è¿›è¡Œæ¯”è¾ƒã€‚è¿™å¯ä»¥é€šè¿‡åœ¨ `main` å‡½æ•°ä½“ä¸­å¢åŠ å¦‚ä¸‹ä»£ç æ¥å®ç°ï¼š

<span class="filename">æ–‡ä»¶åï¼šsrc/main.rs</span>

```rust,ignore
{{#rustdoc_include ../listings/ch02-guessing-game-tutorial/no-listing-03-convert-string-to-number/src/main.rs:here}}
```

è¿™è¡Œæ–°ä»£ç æ˜¯ï¼š

```rust,ignore
let guess: u32 = guess.trim().parse().expect("Please type a number!");
```

è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªå«åš `guess` çš„å˜é‡ã€‚ä¸è¿‡ç­‰ç­‰ï¼Œä¸æ˜¯å·²ç»æœ‰äº†ä¸€ä¸ªå«åš `guess` çš„å˜é‡äº†å—ï¼Ÿç¡®å®å¦‚æ­¤ï¼Œä¸è¿‡ Rust å…è®¸ç”¨ä¸€ä¸ªæ–°å€¼æ¥ **éšè—** ï¼ˆ_Shadowing_ï¼‰ `guess` ä¹‹å‰çš„å€¼ã€‚è¿™ä¸ªåŠŸèƒ½å¸¸ç”¨åœ¨éœ€è¦è½¬æ¢å€¼ç±»å‹ä¹‹ç±»çš„åœºæ™¯ã€‚å®ƒå…è®¸æˆ‘ä»¬å¤ç”¨ `guess` å˜é‡çš„åå­—ï¼Œè€Œä¸æ˜¯è¢«è¿«åˆ›å»ºä¸¤ä¸ªä¸åŒå˜é‡ï¼Œè¯¸å¦‚ `guess_str` å’Œ `guess` ä¹‹ç±»ã€‚[ç¬¬ä¸‰ç« ][shadowing]ä¼šä»‹ç» shadowing çš„æ›´å¤šç»†èŠ‚ï¼Œç°åœ¨åªéœ€çŸ¥é“è¿™ä¸ªåŠŸèƒ½ç»å¸¸ç”¨äºå°†ä¸€ä¸ªç±»å‹çš„å€¼è½¬æ¢ä¸ºå¦ä¸€ä¸ªç±»å‹çš„å€¼ã€‚

æˆ‘ä»¬å°†è¿™ä¸ªæ–°å˜é‡ç»‘å®šåˆ° `guess.trim().parse()` è¡¨è¾¾å¼ä¸Šã€‚è¡¨è¾¾å¼ä¸­çš„ `guess` æŒ‡çš„æ˜¯åŒ…å«è¾“å…¥çš„å­—ç¬¦ä¸²ç±»å‹ `guess` å˜é‡ã€‚`String` å®ä¾‹çš„ `trim` æ–¹æ³•ä¼šå»é™¤å­—ç¬¦ä¸²å¼€å¤´å’Œç»“å°¾çš„ç©ºç™½å­—ç¬¦ï¼Œæˆ‘ä»¬å¿…é¡»æ‰§è¡Œæ­¤æ–¹æ³•æ‰èƒ½å°†å­—ç¬¦ä¸²ä¸ `u32` æ¯”è¾ƒï¼Œå› ä¸º `u32` åªèƒ½åŒ…å«æ•°å€¼å‹æ•°æ®ã€‚ç”¨æˆ·å¿…é¡»è¾“å…¥ <span class="keystroke">enter</span> é”®æ‰èƒ½è®© `read_line` è¿”å›å¹¶è¾“å…¥ä»–ä»¬çš„çŒœæƒ³ï¼Œè¿™å°†ä¼šåœ¨å­—ç¬¦ä¸²ä¸­å¢åŠ ä¸€ä¸ªæ¢è¡Œï¼ˆnewlineï¼‰ç¬¦ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·è¾“å…¥ <span class="keystroke">5</span> å¹¶æŒ‰ä¸‹ <span class="keystroke">enter</span>ï¼ˆåœ¨ Windows ä¸Šï¼ŒæŒ‰ä¸‹ <span class="keystroke">enter</span> é”®ä¼šå¾—åˆ°ä¸€ä¸ªå›è½¦ç¬¦å’Œä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œ`\r\n`ï¼‰ï¼Œ`guess` çœ‹èµ·æ¥åƒè¿™æ ·ï¼š`5\n` æˆ–è€… `5\r\n`ã€‚`\n` ä»£è¡¨ â€œæ¢è¡Œâ€ï¼Œå›è½¦é”®ï¼›`\r` ä»£è¡¨ â€œå›è½¦â€ï¼Œå›è½¦é”®ã€‚`trim` æ–¹æ³•ä¼šæ¶ˆé™¤ `\n` æˆ–è€… `\r\n`ï¼Œåªç•™ä¸‹ `5`ã€‚

[å­—ç¬¦ä¸²çš„ `parse` æ–¹æ³•][parse]<!-- ignore --> å°†å­—ç¬¦ä¸²è½¬æ¢æˆå…¶ä»–ç±»å‹ã€‚è¿™é‡Œç”¨å®ƒæ¥æŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å€¼ã€‚æˆ‘ä»¬éœ€è¦å‘Šè¯‰ Rust å…·ä½“çš„æ•°å­—ç±»å‹ï¼Œè¿™é‡Œé€šè¿‡ `let guess: u32` æŒ‡å®šã€‚`guess` åé¢çš„å†’å·ï¼ˆ`:`ï¼‰å‘Šè¯‰ Rust æˆ‘ä»¬æŒ‡å®šäº†å˜é‡çš„ç±»å‹ã€‚Rust æœ‰ä¸€äº›å†…å»ºçš„æ•°å­—ç±»å‹ï¼›`u32` æ˜¯ä¸€ä¸ªæ— ç¬¦å·çš„ 32 ä½æ•´å‹ã€‚å¯¹äºä¸å¤§çš„æ­£æ•´æ•°æ¥è¯´ï¼Œå®ƒæ˜¯ä¸é”™çš„é»˜è®¤ç±»å‹ï¼Œ[ç¬¬ä¸‰ç« ][integers]è¿˜ä¼šè®²åˆ°å…¶ä»–æ•°å­—ç±»å‹ã€‚

å¦å¤–ï¼Œç¨‹åºä¸­çš„ `u32` æ³¨è§£ä»¥åŠä¸ `secret_number` çš„æ¯”è¾ƒï¼Œæ„å‘³ç€ Rust ä¼šæ¨æ–­å‡º `secret_number` ä¹Ÿæ˜¯ `u32` ç±»å‹ã€‚ç°åœ¨å¯ä»¥ä½¿ç”¨ç›¸åŒç±»å‹æ¯”è¾ƒä¸¤ä¸ªå€¼äº†ï¼

`parse` æ–¹æ³•åªæœ‰åœ¨å­—ç¬¦é€»è¾‘ä¸Šå¯ä»¥è½¬æ¢ä¸ºæ•°å­—çš„æ—¶å€™æ‰èƒ½å·¥ä½œæ‰€ä»¥éå¸¸å®¹æ˜“å‡ºé”™ã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²ä¸­åŒ…å« `AğŸ‘%`ï¼Œå°±æ— æ³•å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—ã€‚å› æ­¤ï¼Œ`parse` æ–¹æ³•è¿”å›ä¸€ä¸ª `Result` ç±»å‹ã€‚åƒä¹‹å‰ [â€œä½¿ç”¨ `Result` ç±»å‹æ¥å¤„ç†æ½œåœ¨çš„é”™è¯¯â€](#ä½¿ç”¨-result-ç±»å‹æ¥å¤„ç†æ½œåœ¨çš„é”™è¯¯) è®¨è®ºçš„ `read_line` æ–¹æ³•é‚£æ ·ï¼Œå†æ¬¡æŒ‰éƒ¨å°±ç­çš„ç”¨ `expect` æ–¹æ³•å¤„ç†å³å¯ã€‚å¦‚æœ `parse` ä¸èƒ½ä»å­—ç¬¦ä¸²ç”Ÿæˆä¸€ä¸ªæ•°å­—ï¼Œè¿”å›ä¸€ä¸ª `Result` çš„ `Err` æˆå‘˜æ—¶ï¼Œ`expect` ä¼šä½¿æ¸¸æˆå´©æºƒå¹¶æ‰“å°é™„å¸¦çš„ä¿¡æ¯ã€‚å¦‚æœ `parse` æˆåŠŸåœ°å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—ï¼Œå®ƒä¼šè¿”å› `Result` çš„ `Ok` æˆå‘˜ï¼Œç„¶å `expect` ä¼šè¿”å› `Ok` å€¼ä¸­çš„æ•°å­—ã€‚

ç°åœ¨è®©æˆ‘ä»¬è¿è¡Œç¨‹åºï¼

```console
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 0.43s
     Running `target/debug/guessing_game`
Guess the number!
The secret number is: 58
Please input your guess.
  76
You guessed: 76
Too big!
```

æ¼‚äº®ï¼å³ä¾¿æ˜¯åœ¨çŒœæµ‹ä¹‹å‰æ·»åŠ äº†ç©ºæ ¼ï¼Œç¨‹åºä¾ç„¶èƒ½åˆ¤æ–­å‡ºç”¨æˆ·çŒœæµ‹äº† 76ã€‚å¤šè¿è¡Œç¨‹åºå‡ æ¬¡ï¼Œè¾“å…¥ä¸åŒçš„æ•°å­—æ¥æ£€éªŒä¸åŒçš„è¡Œä¸ºï¼šçŒœä¸€ä¸ªæ­£ç¡®çš„æ•°å­—ï¼ŒçŒœä¸€ä¸ªè¿‡å¤§çš„æ•°å­—å’ŒçŒœä¸€ä¸ªè¿‡å°çš„æ•°å­—ã€‚

ç°åœ¨æ¸¸æˆå·²ç»å¤§ä½“ä¸Šèƒ½ç©äº†ï¼Œä¸è¿‡ç”¨æˆ·åªèƒ½çŒœä¸€æ¬¡ã€‚å¢åŠ ä¸€ä¸ªå¾ªç¯æ¥æ”¹å˜å®ƒå§ï¼

## ä½¿ç”¨å¾ªç¯æ¥å…è®¸å¤šæ¬¡çŒœæµ‹

`loop` å…³é”®å­—åˆ›å»ºäº†ä¸€ä¸ªæ— é™å¾ªç¯ã€‚æˆ‘ä»¬ä¼šå¢åŠ å¾ªç¯æ¥ç»™ç”¨æˆ·æ›´å¤šæœºä¼šçŒœæ•°å­—ï¼š

<span class="filename">æ–‡ä»¶åï¼šsrc/main.rs</span>

```rust,ignore
{{#rustdoc_include ../listings/ch02-guessing-game-tutorial/no-listing-04-looping/src/main.rs:here}}
```

å¦‚ä¸Šæ‰€ç¤ºï¼Œæˆ‘ä»¬å°†æç¤ºç”¨æˆ·çŒœæµ‹ä¹‹åçš„æ‰€æœ‰å†…å®¹ç§»åŠ¨åˆ°äº†å¾ªç¯ä¸­ã€‚ç¡®ä¿ loop å¾ªç¯ä¸­çš„ä»£ç å¤šç¼©è¿›å››ä¸ªç©ºæ ¼ï¼Œå†æ¬¡è¿è¡Œç¨‹åºã€‚æ³¨æ„è¿™é‡Œæœ‰ä¸€ä¸ªæ–°é—®é¢˜ï¼Œå› ä¸ºç¨‹åºå¿ å®åœ°æ‰§è¡Œäº†æˆ‘ä»¬çš„è¦æ±‚ï¼šæ°¸è¿œåœ°è¯·æ±‚å¦ä¸€ä¸ªçŒœæµ‹ï¼Œç”¨æˆ·å¥½åƒæ— æ³•é€€å‡ºå•Šï¼

ç”¨æˆ·æ€»èƒ½ä½¿ç”¨ <span class="keystroke">ctrl-c</span> ç»ˆæ­¢ç¨‹åºã€‚ä¸è¿‡è¿˜æœ‰å¦ä¸€ä¸ªæ–¹æ³•è·³å‡ºæ— é™å¾ªç¯ï¼Œå°±æ˜¯ [â€œæ¯”è¾ƒçŒœæµ‹ä¸ç§˜å¯†æ•°å­—â€](#æ¯”è¾ƒçŒœæµ‹çš„æ•°å­—å’Œç§˜å¯†æ•°å­—) éƒ¨åˆ†æåˆ°çš„ `parse`ï¼šå¦‚æœç”¨æˆ·è¾“å…¥çš„ç­”æ¡ˆä¸æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œç¨‹åºä¼šå´©æºƒã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥é€€å‡ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```console
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 1.50s
     Running `target/debug/guessing_game`
Guess the number!
The secret number is: 59
Please input your guess.
45
You guessed: 45
Too small!
Please input your guess.
60
You guessed: 60
Too big!
Please input your guess.
59
You guessed: 59
You win!
Please input your guess.
quit
thread 'main' panicked at 'Please type a number!: ParseIntError { kind: InvalidDigit }', src/main.rs:28:47
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
```

è¾“å…¥ `quit` å°†ä¼šé€€å‡ºç¨‹åºï¼ŒåŒæ—¶ä½ ä¼šæ³¨æ„åˆ°å…¶ä»–ä»»ä½•éæ•°å­—è¾“å…¥ä¹Ÿä¸€æ ·ã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸ç†æƒ³ï¼Œæˆ‘ä»¬æƒ³è¦å½“çŒœæµ‹æ­£ç¡®çš„æ•°å­—æ—¶æ¸¸æˆåœæ­¢ã€‚

### çŒœæµ‹æ­£ç¡®åé€€å‡º

è®©æˆ‘ä»¬å¢åŠ ä¸€ä¸ª `break` è¯­å¥ï¼Œåœ¨ç”¨æˆ·çŒœå¯¹æ—¶é€€å‡ºæ¸¸æˆï¼š

<span class="filename">æ–‡ä»¶åï¼šsrc/main.rs</span>

```rust,ignore
{{#rustdoc_include ../listings/ch02-guessing-game-tutorial/no-listing-05-quitting/src/main.rs:here}}
```

é€šè¿‡åœ¨ `You win!` ä¹‹åå¢åŠ ä¸€è¡Œ `break`ï¼Œç”¨æˆ·çŒœå¯¹äº†ç¥ç§˜æ•°å­—åä¼šé€€å‡ºå¾ªç¯ã€‚é€€å‡ºå¾ªç¯ä¹Ÿæ„å‘³ç€é€€å‡ºç¨‹åºï¼Œå› ä¸ºå¾ªç¯æ˜¯ `main` çš„æœ€åä¸€éƒ¨åˆ†ã€‚

### å¤„ç†æ— æ•ˆè¾“å…¥

ä¸ºäº†è¿›ä¸€æ­¥æ”¹å–„æ¸¸æˆæ€§ï¼Œä¸è¦åœ¨ç”¨æˆ·è¾“å…¥éæ•°å­—æ—¶å´©æºƒï¼Œéœ€è¦å¿½ç•¥éæ•°å­—ï¼Œè®©ç”¨æˆ·å¯ä»¥ç»§ç»­çŒœæµ‹ã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹ `guess` å°† `String` è½¬åŒ–ä¸º `u32` é‚£éƒ¨åˆ†ä»£ç æ¥å®ç°ï¼Œå¦‚ç¤ºä¾‹ 2-5 æ‰€ç¤ºï¼š

<figure class="listing">

<span class="file-name">æ–‡ä»¶åï¼šsrc/main.rs</span>

```rust,ignore
{{#rustdoc_include ../listings/ch02-guessing-game-tutorial/listing-02-05/src/main.rs:here}}
```

<figcaption>ç¤ºä¾‹ 2-5ï¼šå¿½ç•¥éæ•°å­—çš„çŒœæµ‹å¹¶é‡æ–°è¯·æ±‚æ•°å­—è€Œä¸æ˜¯è®©ç¨‹åºå´©æºƒ</figcaption>

</figure>

æˆ‘ä»¬å°† `expect` è°ƒç”¨æ¢æˆ `match` è¯­å¥ï¼Œä»¥ä»é‡åˆ°é”™è¯¯å°±å´©æºƒè½¬æ¢ä¸ºå¤„ç†é”™è¯¯ã€‚é¡»çŸ¥ `parse` è¿”å›ä¸€ä¸ª `Result` ç±»å‹ï¼Œè€Œ `Result` æ˜¯ä¸€ä¸ªæ‹¥æœ‰ `Ok` æˆ– `Err` æˆå‘˜çš„æšä¸¾ã€‚è¿™é‡Œä½¿ç”¨çš„ `match` è¡¨è¾¾å¼ï¼Œå’Œä¹‹å‰å¤„ç† `cmp` æ–¹æ³•è¿”å› `Ordering` æ—¶ç”¨çš„ä¸€æ ·ã€‚

å¦‚æœ `parse` èƒ½å¤ŸæˆåŠŸçš„å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªåŒ…å«ç»“æœæ•°å­—çš„ `Ok`ã€‚è¿™ä¸ª `Ok` å€¼ä¸ `match` ç¬¬ä¸€ä¸ªåˆ†æ”¯çš„æ¨¡å¼ç›¸åŒ¹é…ï¼Œè¯¥åˆ†æ”¯å¯¹åº”çš„åŠ¨ä½œè¿”å› `Ok` å€¼ä¸­çš„æ•°å­— `num`ï¼Œæœ€åå¦‚æ„¿å˜æˆæ–°åˆ›å»ºçš„ `guess` å˜é‡ã€‚

å¦‚æœ `parse` **ä¸**èƒ½å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªåŒ…å«æ›´å¤šé”™è¯¯ä¿¡æ¯çš„ `Err`ã€‚`Err` å€¼ä¸èƒ½åŒ¹é…ç¬¬ä¸€ä¸ª `match` åˆ†æ”¯çš„ `Ok(num)` æ¨¡å¼ï¼Œä½†æ˜¯ä¼šåŒ¹é…ç¬¬äºŒä¸ªåˆ†æ”¯çš„ `Err(_)` æ¨¡å¼ï¼š`_` æ˜¯ä¸€ä¸ªé€šé…ç¬¦å€¼ï¼Œæœ¬ä¾‹ä¸­ç”¨æ¥åŒ¹é…æ‰€æœ‰ `Err` å€¼ï¼Œä¸ç®¡å…¶ä¸­æœ‰ä½•ç§ä¿¡æ¯ã€‚æ‰€ä»¥ç¨‹åºä¼šæ‰§è¡Œç¬¬äºŒä¸ªåˆ†æ”¯çš„åŠ¨ä½œï¼Œ`continue` æ„å‘³ç€è¿›å…¥ `loop` çš„ä¸‹ä¸€æ¬¡å¾ªç¯ï¼Œè¯·æ±‚å¦ä¸€ä¸ªçŒœæµ‹ã€‚è¿™æ ·ç¨‹åºå°±æœ‰æ•ˆçš„å¿½ç•¥äº† `parse` å¯èƒ½é‡åˆ°çš„æ‰€æœ‰é”™è¯¯ï¼

ç°åœ¨ç¨‹åºä¸­çš„ä¸€åˆ‡éƒ½åº”è¯¥å¦‚é¢„æœŸèˆ¬å·¥ä½œäº†ã€‚è®©æˆ‘ä»¬è¯•è¯•å§ï¼š

```console
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 4.45s
     Running `target/debug/guessing_game`
Guess the number!
The secret number is: 61
Please input your guess.
10
You guessed: 10
Too small!
Please input your guess.
99
You guessed: 99
Too big!
Please input your guess.
foo
Please input your guess.
61
You guessed: 61
You win!
```

å¤ªæ£’äº†ï¼å†æœ‰æœ€åä¸€ä¸ªå°çš„ä¿®æ”¹ï¼Œå°±èƒ½å®ŒæˆçŒœæ•°å­—æ¸¸æˆäº†ï¼šè¿˜è®°å¾—ç¨‹åºä¾ç„¶ä¼šæ‰“å°å‡ºç§˜å¯†æ•°å­—ã€‚åœ¨æµ‹è¯•æ—¶è¿˜å¥½ï¼Œä½†æ­£å¼å‘å¸ƒæ—¶ä¼šæ¯äº†æ¸¸æˆã€‚åˆ æ‰æ‰“å°ç§˜å¯†æ•°å­—çš„ `println!`ã€‚ç¤ºä¾‹ 2-6 ä¸ºæœ€ç»ˆä»£ç ï¼š

<figure class="listing">

<span class="file-name">æ–‡ä»¶åï¼šsrc/main.rs</span>

```rust,ignore
{{#rustdoc_include ../listings/ch02-guessing-game-tutorial/listing-02-06/src/main.rs}}
```

<figcaption>ç¤ºä¾‹ 2-6ï¼šçŒœæ•°å­—æ¸¸æˆçš„å®Œæ•´ä»£ç </figcaption>

</figure>

æ­¤æ—¶æ­¤åˆ»ï¼Œä½ é¡ºåˆ©å®Œæˆäº†çŒœæ•°å­—æ¸¸æˆã€‚æ­å–œï¼

## æ€»ç»“

æœ¬é¡¹ç›®é€šè¿‡åŠ¨æ‰‹å®è·µï¼Œå‘ä½ ä»‹ç»äº† Rust æ–°æ¦‚å¿µï¼š`let`ã€`match`ã€å‡½æ•°ã€ä½¿ç”¨å¤–éƒ¨ crate ç­‰ç­‰ï¼Œæ¥ä¸‹æ¥çš„å‡ ç« ï¼Œä½ ä¼šç»§ç»­æ·±å…¥å­¦ä¹ è¿™äº›æ¦‚å¿µã€‚ç¬¬ä¸‰ç« ä»‹ç»å¤§éƒ¨åˆ†ç¼–ç¨‹è¯­è¨€éƒ½æœ‰çš„æ¦‚å¿µï¼Œæ¯”å¦‚å˜é‡ã€æ•°æ®ç±»å‹å’Œå‡½æ•°ï¼Œä»¥åŠå¦‚ä½•åœ¨ Rust ä¸­ä½¿ç”¨å®ƒä»¬ã€‚ç¬¬å››ç« æ¢ç´¢æ‰€æœ‰æƒï¼ˆownershipï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ª Rust åŒå…¶ä»–è¯­è¨€å¤§ä¸ç›¸åŒçš„åŠŸèƒ½ã€‚ç¬¬äº”ç« è®¨è®ºç»“æ„ä½“å’Œæ–¹æ³•çš„è¯­æ³•ï¼Œè€Œç¬¬å…­ç« ä¾§é‡è§£é‡Šæšä¸¾ã€‚

[prelude]: https://doc.rust-lang.org/std/prelude/index.html
[variables-and-mutability]: ch03-01-variables-and-mutability.html#å˜é‡å’Œå¯å˜æ€§
[comments]: ch03-04-comments.html
[string]: https://doc.rust-lang.org/std/string/struct.String.html
[iostdin]: https://doc.rust-lang.org/std/io/struct.Stdin.html
[read_line]: https://doc.rust-lang.org/std/io/struct.Stdin.html#method.read_line
[result]: https://doc.rust-lang.org/std/result/enum.Result.html
[enums]: ch06-00-enums.html
[expect]: https://doc.rust-lang.org/std/result/enum.Result.html#method.expect
[recover]: ch09-02-recoverable-errors-with-result.html
[randcrate]: https://crates.io/crates/rand
[semver]: http://semver.org
[cratesio]: https://crates.io/
[doccargo]: http://doc.crates.io
[doccratesio]: http://doc.crates.io/crates-io.html
[match]: ch06-02-match.html
[shadowing]: ch03-01-variables-and-mutability.html#éšè—
[parse]: https://doc.rust-lang.org/std/primitive.str.html#method.parse
[integers]: ch03-02-data-types.html#æ•´å‹
